{
  "system": "ActivityManagementPlatform",
  "version": "1.0",
  "generatedAt": "2026-02-13T00:00:00.000Z",
  "inputs": {
    "specPath": "StateTranstionDiagram/spec.md",
    "transitionPath": "StateTranstionDiagram/transition.md"
  },
  "spec": {
    "raw": "# 任務 Spec：社團活動管理平台（Activity Management Platform）\nActivity Management Platform\n\n---\n\n## 1. 產品目標（Product Goal）\n本平台提供社團成員與幹部（管理員）一個一致、可追溯且具權限控管的活動管理與報名系統，讓使用者能夠：\n- 瀏覽即將舉辦的活動（僅顯示對一般使用者公開的活動）\n- 報名活動 / 取消報名活動\n- 查看自己的報名狀態、活動是否可報名、可用名額與名額上限\n- 管理員可建立與管理活動並查看報名狀況、匯出名單\n\n系統必須具備以下共通能力：\n- 使用者登入與身分驗證（Email + 密碼）\n- 角色權限控管（Guest / Member / Admin；其中 Member 與 Admin 互斥且不可自行切換）\n- 活動狀態管理（State Machine）與合法轉換規則\n- 名額控管與一致性（避免超賣、避免重複報名、避免重複提交）\n- 前後端資料一致性（交易/原子操作；UI 顯示與後端實際狀態一致）\n- 全站錯誤處理（401/403/404/5xx）與可理解提示\n- 時區一致（系統預設時區 + 所有時間顯示以該時區呈現）\n- 重要操作稽核（Audit Log）可追溯 who/when/what\n\n成功指標（可驗收）：\n- 使用者可清楚看到活動是否可報名、是否已報名、是否額滿、是否已截止/已結束/已關閉，以及目前報名人數/名額。\n- 管理員可快速建立活動、發佈、查看名單與即時報名狀況，並能關閉報名或下架。\n\n---\n\n## 2. 使用者角色定義（Roles）\n\n### 2.1 訪客（Guest，未登入）\n- 權限\n  - 可瀏覽活動列表（僅顯示 `published`、`full`）\n  - 可查看活動詳情（僅限 `published`、`full`）\n- 可執行行為\n  - 在列表/詳情頁閱讀活動資訊\n  - 進入登入/註冊頁\n- 限制\n  - 不可報名/取消報名\n  - 嘗試報名/取消報名時：\n    - 前端：導向登入頁，並保留原活動回跳（returnTo）\n    - 後端：回傳 `401 Unauthorized`\n\n### 2.2 一般使用者（Member）\n- 權限\n  - 具備 Guest 全部可見能力\n  - 可報名活動（僅限符合規則的活動）\n  - 可取消已報名活動（需符合取消規則）\n  - 可查看「我的活動」：僅列出自己已報名的活動\n- 可執行行為\n  - 對 `published` 活動進行報名\n  - 在 `deadline` 前取消報名（且活動未結束）\n  - 查看自己已報名活動清單與狀態\n- 限制\n  - 同一使用者對同一活動只能同時存在「一筆有效報名」（不得重複報名）\n  - 活動狀態非 `published` 時不可報名（`full`、`closed`、`draft`、`archived` 均不可報名）\n  - 活動已截止（`now >= deadline`）或活動已結束（`now >= date`）時不可報名\n  - 取消報名僅能在截止前且活動未結束時進行（`now < deadline` 且 `now < date`）\n\n### 2.3 管理員（Admin）\n- 權限\n  - 具備 Member 全部權限\n  - 可建立 / 編輯活動\n  - 可將活動從草稿發佈（`draft -> published`）\n  - 可手動關閉報名（`published/full -> closed`）\n  - 可下架活動（`closed/draft -> archived`）\n  - 可查看活動報名名單（姓名 / Email / 報名時間）\n  - 可匯出報名名單為 CSV\n- 可執行行為\n  - 在管理後台建立草稿、調整活動資訊與名額\n  - 發佈活動、關閉報名、下架活動\n  - 觀看報名名單並匯出\n- 限制\n  - 角色互斥：同一帳號不可同時是 Member 與 Admin\n  - 角色由系統設定，不可自行切換\n\n> 角色互斥與不可切換是系統層級規則：前端不提供任何「切換角色」入口；後端以 user.role 做權限判斷。\n\n---\n\n## 3. 使用者流程（User Flow）\n\n### 3.1 訪客/一般使用者流程（Guest/Member）\n1. 訪客進入活動列表頁（僅看到 `published`、`full`）\n2. 訪客查看活動詳情\n3. 訪客嘗試報名時導向登入頁（保留 returnTo 回跳至該活動詳情）\n4. Member 登入後回到原本活動詳情\n5. Member 在符合規則時報名活動\n6. Member 進入「我的活動」頁查看已報名活動\n7. Member 在報名截止前且活動未結束時可取消報名\n\n補充 UI 流程要求：\n- 列表與詳情頁需顯示「可報名 / 已報名 / 額滿 / 已截止 / 已結束 / 已關閉」等可理解狀態，且與後端規則一致。\n- 操作（報名/取消/管理操作）需有 loading 與錯誤提示；成功後需立即反映最新名額與狀態。\n- 防重複提交：報名/取消重送請求結果一致（UI 在送出期間需禁用按鈕並顯示進度）。\n\n### 3.2 管理員流程（Admin）\n1. Admin 登入系統\n2. 進入管理後台活動列表\n3. 建立活動（草稿）\n4. 設定活動資訊與名額\n5. 發佈活動\n6. 查看即時報名狀況與名單\n7. 視需要關閉報名或下架活動\n8. 必要時匯出報名名單 CSV\n\n### 3.3 例外流程與錯誤處理\n- 未登入使用者嘗試報名/取消 -> 前端導向登入；後端回 `401 Unauthorized`\n- 權限不足嘗試進入管理頁或呼叫管理 API -> `403 Forbidden`\n- 活動不存在（列表外透過網址/ID 存取）-> `404 Not Found`\n- 活動已截止或已結束 -> 禁止報名 / 禁止取消（回 `400 Bad Request` 或 `409 Conflict`，並提供可顯示訊息）\n- 活動非 `published` -> 禁止報名（回 `409 Conflict` 或 `400 Bad Request`，並提供可顯示訊息）\n- 活動為 `closed`：禁止新報名；已報名者仍可在 `deadline` 前取消，但取消後名額不再對外開放（活動仍維持 `closed`）\n\n---\n\n## 4. 功能需求（Functional Requirements）\n\n### 4.1 帳號與認證（Auth）\n- 使用 Email + 密碼註冊/登入\n- 密碼需使用安全雜湊（bcrypt 或 argon2）儲存，不可明文\n- 登入成功後，需發放可驗證身分的 Session 或 Token（後續請求可被伺服器驗證）\n- 未登入不可報名/取消報名\n- 需具備登出功能（登出後憑證失效）\n- 需具備基本安全要求：\n  - Email 唯一\n  - 登入失敗不洩漏帳號是否存在（訊息一致）\n- Session/Token 驗證必須套用於所有需要登入的頁面與 API\n\n### 4.2 角色權限控管（RBAC）\n- 系統內角色固定為 `member` 或 `admin`，且互斥\n- 管理員頁面與管理 API 僅允許 Admin\n- Member 不得透過前端繞過或直接呼叫管理 API\n- 權限回應規則：\n  - 未登入：401\n  - 已登入但角色不符：403\n\n### 4.3 活動管理（Activity）\n\n#### 4.3.1 活動欄位與驗證\n- `title`：必填，短字串（需有最大長度限制）\n- `description`：必填，多行文字\n- `date`：活動開始時間（必填）\n- `location`：必填\n- `deadline`：報名截止時間（必填）\n- `capacity`：名額上限，正整數（必填）\n- `status`：活動狀態（見狀態機）\n- `created_by`：建立者（Admin）\n- `created_at` / `updated_at`\n\n核心資料規則：\n- `date` 必須晚於 `deadline`\n- `capacity` 必須為正整數\n\n#### 4.3.2 活動狀態（State Machine）\n狀態 enum：\n- `draft`：草稿，僅管理員可見\n- `published`：已發佈，可報名（若未額滿且未截止且未結束）\n- `full`：額滿（系統自動）\n- `closed`：報名關閉（管理員手動）\n- `archived`：已下架（管理員手動）\n\n合法狀態轉換：\n- 管理員：`draft -> published`\n- 系統自動：`published -> full`（當有效報名數達 `capacity`）\n- 系統自動：`full -> published`（取消後釋放名額且活動未達額滿；僅在活動未被管理員關閉時適用）\n- 管理員：`published -> closed`\n- 管理員：`full -> closed`\n- 管理員：`closed -> archived`\n- 管理員：`draft -> archived`\n\n非法轉換必須拒絕（回 400 或 409 並提供可顯示訊息）：\n- `archived` 不可再被發佈或關閉\n- 非 Admin 不可執行任何狀態變更\n\n顯示與可見性規則：\n- 活動列表（Guest/Member）僅顯示 `published`、`full`\n- 活動詳情（Guest/Member）僅允許存取 `published`、`full`；若以 ID 存取 `draft/closed/archived` 視為不存在（回 404）\n- 管理後台（Admin）可見所有狀態\n\n`status=full` 時的業務規則：\n- 不可再報名\n- 取消報名後若釋放名額且活動未被關閉，狀態需回到 `published`\n\n`status=closed` 的業務規則（本系統採用）：\n- 禁止新報名\n- 已報名者仍可在 `deadline` 前取消（且 `now < date`）\n- 取消後名額需釋放（有效報名數下降），但活動狀態維持 `closed` 且不重新開放給新報名者（因此不會因取消而回到 `published`）\n\n`status=archived` 的業務規則：\n- 不可報名/取消\n- 不出現在一般列表\n\n#### 4.3.3 名額與人數顯示規則\n- 「目前報名人數」定義為該活動有效報名數（`canceled_at is null` 的 Registration 數量）\n- 顯示格式：`{registered_count} / {capacity}`\n- 若採用 `registered_count` 快取欄位：必須在報名/取消交易內同步更新，確保列表與詳情一致\n\n### 4.4 報名系統（Registration）\n\n#### 4.4.1 基本規則\n- 同一使用者對同一活動只能有一筆有效報名（不可重複報名）\n- 活動狀態非 `published` 時不可報名\n- 報名截止後（`now >= deadline`）不可報名與取消\n- 活動已結束（`now >= date`）不可報名與取消\n- 取消報名僅允許：`now < deadline` 且 `now < date` 且該使用者目前存在有效報名\n\n#### 4.4.2 額滿與狀態連動\n- 報名人數達上限時：\n  - 系統自動切換活動狀態為 `full`\n  - 不可再報名\n- 取消報名後：\n  - 名額需即時釋放（有效報名數下降）\n  - 若活動先前為 `full` 且釋放後未額滿，且活動狀態不是 `closed`，狀態需回到 `published`\n- `closed` 狀態下：\n  - 禁止新報名\n  - 已報名者仍可在 `deadline` 前取消\n  - 取消後不再開放新名額（狀態不回到 `published`，仍維持 `closed`）\n\n#### 4.4.3 一致性要求（避免超賣與防重複）\n- 報名動作必須使用交易或原子操作，確保同一時間多個使用者報名不會超過 `capacity`\n- 必須具備資料庫層級的唯一性限制：`(user_id, activity_id)` unique\n- 報名/取消需具備防重複提交（idempotent）能力：\n  - 同一使用者針對同一活動的「報名」重送請求，結果應一致：\n    - 已成功報名則回成功且不新增第二筆\n  - 同一使用者針對同一活動的「取消」重送請求，結果應一致：\n    - 已取消則回成功且不重複修改\n- UI 必須防止重複點擊：\n  - 送出期間按鈕 disabled\n  - 顯示 loading\n  - 完成後立即刷新活動狀態與名額顯示\n\n### 4.5 活動列表頁（Activity List）\n顯示範圍：\n- `published`\n- `full`\n\n每筆活動需顯示：\n- 活動名稱（title）\n- 日期（date）\n- 地點（location）\n- 目前報名人數 / 名額上限\n- 報名狀態（依登入與報名狀態顯示）：\n  - 訪客：可報名（需登入）/ 額滿\n  - Member：可報名 / 已報名 / 額滿\n\n列表需具備 UI 狀態：loading / empty / error。\n\n### 4.6 活動詳情頁（Activity Detail）\n- 顯示完整活動資訊（title/description/date/location/deadline/capacity/status/目前報名人數）\n- 依使用者狀態顯示互動：\n  - 訪客：顯示「請登入以報名」並提供導向登入（帶 returnTo）\n  - Member：\n    - 未報名且可報名：顯示報名按鈕\n    - 已報名且可取消：顯示取消報名按鈕\n    - 額滿：顯示已額滿提示與不可操作\n    - 已截止/已結束/已關閉：顯示原因與不可操作\n\n詳情頁需具備 UI 狀態：loading / error / not found。\n\n### 4.7 我的活動頁（My Activities）\n- 僅顯示使用者已報名（有效報名）的活動\n- 依活動日期排序（由近到遠）\n- 顯示活動狀態：\n  - 即將開始（`now < date`）\n  - 已結束（`now >= date`）\n\n需具備 UI 狀態：loading / empty / error。\n\n### 4.8 管理後台（Admin Panel）\n功能：\n- 活動 CRUD（建立/讀取/更新/下架）\n- 手動關閉報名（狀態轉換為 `closed`）\n- 草稿發佈（狀態轉換為 `published`）\n- 查看報名名單（姓名 / Email / 報名時間）\n- 匯出報名名單為 CSV\n\n管理後台需具備：\n- 權限檢查（非 Admin 一律 403）\n- loading / error / empty\n- 操作成功/失敗提示\n\n### 4.9 稽核紀錄（Audit Log）\n- 必須記錄重要操作：\n  - 活動建立 / 修改 / 狀態變更\n  - 管理員關閉報名 / 下架\n  - 報名 / 取消\n  - 匯出名單\n- 每筆紀錄至少包含：actor、action、target_type/target_id、created_at\n\n### 4.10 時區與時間顯示\n- 系統必須可設定預設時區（例如 `Asia/Taipei`）\n- 所有時間判斷（`now`、`deadline`、`date`）需以同一時區進行比較\n- 顯示給使用者的 `date/deadline` 需以該時區呈現\n\n### 4.11 UI 互動與狀態一致性\n- 所有重要操作需有 loading、成功、失敗提示\n- 成功後列表/詳情/我的活動/管理後台的名額與狀態必須同步更新\n- 若後端回傳 409/400：前端需顯示可理解的原因（例如：已截止、已額滿、已關閉、活動不存在、已報名）\n\n### 4.12 資料可見性與導覽規則（資訊架構與導覽，必填）\n\n#### 4.12.1 頁面清單（Page Inventory）\n- 活動列表頁（Activity List）\n  - 用途：瀏覽對外公開活動（`published`、`full`）\n  - Route：`/activities`\n- 活動詳情頁（Activity Detail）\n  - 用途：查看活動完整資訊；Member 在此報名/取消\n  - Route：`/activities/:activityId`\n- 我的活動頁（My Activities）\n  - 用途：查看自己有效報名的活動\n  - Route：`/my-activities`\n- 登入頁（Login）\n  - 用途：輸入 Email + 密碼登入；支援 returnTo 回跳\n  - Route：`/login`\n- 註冊頁（Register）\n  - 用途：建立帳號（Email 唯一）\n  - Route：`/register`\n- 管理後台活動列表頁（Admin Activity List）\n  - 用途：查看全部活動（含 `draft/closed/archived`）與即時報名人數；進入編輯/名單\n  - Route：`/admin/activities`\n- 管理後台活動編輯頁（Admin Activity Editor）\n  - 用途：建立草稿、編輯活動資訊、發佈、下架\n  - Route：\n    - 建立：`/admin/activities/new`\n    - 編輯：`/admin/activities/:activityId/edit`\n- 管理後台報名名單頁（Admin Registrations）\n  - 用途：查看活動報名名單與匯出 CSV\n  - Route：`/admin/activities/:activityId/registrations`\n\n#### 4.12.2 路由存取控制（Route Access Control）\n- `/activities`\n  - Guest：允許\n  - Member：允許\n  - Admin：允許\n- `/activities/:activityId`\n  - Guest：允許（僅 `published/full`；其他狀態回 404）\n  - Member：允許（同上）\n  - Admin：允許（同上；若要查看所有狀態需走管理後台路由）\n- `/my-activities`\n  - Guest：不允許（導向 `/login`，保留 returnTo）\n  - Member：允許\n  - Admin：允許\n- `/login`、`/register`\n  - Guest：允許\n  - Member/Admin：允許（但已登入時可選擇導向 `/activities` 以避免重複登入）\n- `/admin/*`\n  - Guest：不允許（導向 `/login`）\n  - Member：不允許（顯示 403）\n  - Admin：允許\n\n#### 4.12.3 導覽列/Header 規則（Navigation Visibility Rules）\n- 共用導覽（所有頁面共用 Layout）：\n  - Guest：顯示「活動列表」與「登入/註冊」；不得顯示「我的活動」與任何「管理後台」入口\n  - Member：顯示「活動列表」「我的活動」「登出」；不得顯示「管理後台」入口\n  - Admin：顯示「活動列表」「我的活動」「管理後台」「登出」\n- 禁止用「顯示但點了才導登入」取代「不該出現」：例如 Guest 不得看到「我的活動」選單。\n\n#### 4.12.4 全站共用元件責任（Layout Responsibility）\n- Layout（Header/Sidebar）負責：\n  - 提供跨頁導覽入口（活動列表、我的活動、管理後台、登入/登出）\n  - 顯示目前登入狀態（Guest vs Member/Admin）\n- 頁面自身負責（避免 CTA 重複）：\n  - 登入頁：只放登入表單與送出按鈕；Header 若已顯示登入入口，登入頁內不再重複提供第二顆「登入導向」按鈕\n  - 活動詳情頁：只放報名/取消 CTA；Header 不提供報名/取消入口\n  - 管理後台頁面：頁面內提供「建立活動」「發佈」「關閉報名」「下架」「匯出」等管理 CTA；Header 不提供重複的管理操作按鈕\n\n---\n\n## 5. 非功能需求（Non-functional Requirements）\n- RWD：支援桌機與手機\n- 基本錯誤處理：401 / 403 / 404 / 5xx\n  - 401：導向登入並保留 returnTo\n  - 403：顯示無權限頁面（可回到活動列表）\n  - 404：顯示找不到（可回到活動列表）\n  - 5xx：顯示系統錯誤（可重試/回到活動列表）\n- 操作需有 loading 與錯誤提示（報名/取消/建立/編輯/狀態變更/匯出）\n- 前後端資料需同步，避免超賣（交易/原子操作 + 唯一性限制）\n- 時區一致：\n  - 系統需可設定預設時區（例如 `Asia/Taipei`）\n  - 顯示給使用者的 `date/deadline` 需以該時區呈現\n- 安全：\n  - 密碼雜湊儲存\n  - Email 唯一\n  - 登入失敗訊息一致，不洩漏帳號是否存在\n  - RBAC 嚴格實施（路由與 API 都要檢查）\n- 稽核/追蹤：\n  - 活動建立 / 修改 / 狀態變更\n  - 管理員關閉報名 / 下架\n  - 報名/取消\n  - 匯出\n- 一致性與可用性：\n  - 列表/詳情/我的活動/管理後台同一活動的狀態與名額顯示必須一致\n  - 防重複提交與重送請求一致（idempotent）\n\n---\n\n## 6. 資料模型（Data Model）\n\n### 6.1 User\n欄位：\n- `id` (PK)\n- `name` (必填)\n- `email`（唯一，必填）\n- `role` (`member` | `admin`)（必填）\n- `password_hash`（必填）\n- `created_at`\n\n規則/索引：\n- `email` unique index\n- `role` 僅允許 `member` 或 `admin`\n\n### 6.2 Activity\n欄位：\n- `id` (PK)\n- `title`\n- `description`\n- `date`\n- `location`\n- `deadline`\n- `capacity`\n- `status` (`draft` | `published` | `full` | `closed` | `archived`)\n- `created_by` (FK -> User.id)\n- `created_at`\n- `updated_at`\n\n建議衍生/快取欄位：\n- `registered_count`（有效報名數快取；若採用快取，必須在報名/取消交易內同步更新）\n\n規則/索引：\n- `(status, date)` 索引（支援列表查詢）\n- 需滿足資料規則：`date > deadline`、`capacity` 為正整數\n\n### 6.3 Registration\n欄位：\n- `id` (PK)\n- `user_id` (FK -> User.id)\n- `activity_id` (FK -> Activity.id)\n- `created_at`（報名時間）\n- `canceled_at`（nullable；取消時間）\n\n規則/索引：\n- `(user_id, activity_id)` unique（確保同一使用者對同一活動只有一筆 Registration；取消後透過更新 `canceled_at` 來維持唯一性並支援防重複提交）\n- `(activity_id, canceled_at)` 索引（計算有效報名與名單）\n\n### 6.4 Audit Log（重要操作紀錄）\n欄位：\n- `id` (PK)\n- `actor_user_id`（FK -> User.id；執行者）\n- `action`（`ACTIVITY_CREATE` / `ACTIVITY_UPDATE` / `ACTIVITY_STATUS_CHANGE` / `REGISTRATION_CREATE` / `REGISTRATION_CANCEL` / `EXPORT_CSV`）\n- `target_type`（`activity` / `registration`）\n- `target_id`\n- `metadata`（可序列化附加資訊，例如舊狀態/新狀態/匯出範圍）\n- `created_at`\n\n關聯：\n- User 1:N Activity（created_by）\n- User 1:N Registration\n- Activity 1:N Registration\n- User 1:N AuditLog\n",
    "summary": {
      "productName": "社團活動管理平台",
      "goals": [
        "瀏覽即將舉辦的活動（僅顯示對一般使用者公開的活動）",
        "報名活動 / 取消報名活動",
        "查看自己的報名狀態、活動是否可報名、可用名額與名額上限",
        "管理員可建立與管理活動並查看報名狀況、匯出名單"
      ],
      "roles": [
        {"id": "guest", "label": "Guest"},
        {"id": "member", "label": "Member"},
        {"id": "admin", "label": "Admin"}
      ]
    }
  },
  "diagrams": [
    {
      "id": "page_entry",
      "name": "Entry",
      "level": "page",
      "parentDiagramId": null,
      "roles": [],
      "variant": {
        "kind": "standalone",
        "baseDiagramId": null,
        "deltaDiagramIdsByRole": {},
        "appliesToRoles": []
      },
      "source": {"type": "mermaid", "sectionTitle": "① Entry State Machine", "order": 1},
      "groups": [],
      "states": [
        {
          "id": "page.Entry.Init",
          "label": "Entry.Init",
          "type": "start",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_entry",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Entry.Init"}
          }
        },
        {
          "id": "page.Entry.CheckSession",
          "label": "Entry.CheckSession",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_entry",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Entry.CheckSession"}
          }
        },
        {
          "id": "page.Entry.Guest",
          "label": "Entry.Guest",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_entry",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Entry.Guest"}
          }
        },
        {
          "id": "page.Entry.Member",
          "label": "Entry.Member",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_entry",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Entry.Member"}
          }
        },
        {
          "id": "page.Entry.Admin",
          "label": "Entry.Admin",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_entry",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Entry.Admin"}
          }
        }
      ],
      "transitions": [
        {
          "id": "t.page_entry.0001",
          "from": "page.Entry.Init",
          "to": "page.Entry.CheckSession",
          "event": "checkSession",
          "roles": [],
          "validations": [
            "讀取本地 session/token；若不存在或過期，下一步必走 Guest 分支。"
          ],
          "intent": {"category": "action", "summary": "checkSession"},
          "meta": {
            "diagramId": "page_entry",
            "source": {"raw": "Entry.Init --> Entry.CheckSession : checkSession"}
          }
        },
        {
          "id": "t.page_entry.0002",
          "from": "page.Entry.CheckSession",
          "to": "page.Entry.Guest",
          "event": "sessionMissing",
          "roles": [],
          "validations": [
            "session/token 缺失或驗證失敗時，判定為 Guest；Header 導覽僅顯示「活動列表」「登入/註冊」。"
          ],
          "intent": {"category": "action", "summary": "sessionMissing"},
          "meta": {
            "diagramId": "page_entry",
            "source": {"raw": "Entry.CheckSession --> Entry.Guest : sessionMissing"}
          }
        },
        {
          "id": "t.page_entry.0003",
          "from": "page.Entry.CheckSession",
          "to": "page.Entry.Member",
          "event": "sessionValid(role=member)",
          "roles": [],
          "validations": [
            "session/token 驗證成功且 role=member；Header 顯示「活動列表」「我的活動」「登出」，不顯示「管理後台」。"
          ],
          "intent": {"category": "action", "summary": "sessionValid(role=member)"},
          "meta": {
            "diagramId": "page_entry",
            "source": {"raw": "Entry.CheckSession --> Entry.Member : sessionValid(role=member)"}
          }
        },
        {
          "id": "t.page_entry.0004",
          "from": "page.Entry.CheckSession",
          "to": "page.Entry.Admin",
          "event": "sessionValid(role=admin)",
          "roles": [],
          "validations": [
            "session/token 驗證成功且 role=admin；Header 顯示「活動列表」「我的活動」「管理後台」「登出」。"
          ],
          "intent": {"category": "action", "summary": "sessionValid(role=admin)"},
          "meta": {
            "diagramId": "page_entry",
            "source": {"raw": "Entry.CheckSession --> Entry.Admin : sessionValid(role=admin)"}
          }
        }
      ],
      "connectors": [
        {
          "id": "c.page_entry.contains.page_login",
          "type": "contains",
          "from": {"diagramId": "page_entry", "stateId": null},
          "to": {"diagramId": "page_login", "stateId": null},
          "meta": {"reason": "derived from parentDiagramId"}
        },
        {
          "id": "c.page_entry.contains.page_register",
          "type": "contains",
          "from": {"diagramId": "page_entry", "stateId": null},
          "to": {"diagramId": "page_register", "stateId": null},
          "meta": {"reason": "derived from parentDiagramId"}
        },
        {
          "id": "c.page_entry.contains.page_activitylistpage",
          "type": "contains",
          "from": {"diagramId": "page_entry", "stateId": null},
          "to": {"diagramId": "page_activitylistpage", "stateId": null},
          "meta": {"reason": "derived from parentDiagramId"}
        },
        {
          "id": "c.page_entry.contains.page_activitydetailpage",
          "type": "contains",
          "from": {"diagramId": "page_entry", "stateId": null},
          "to": {"diagramId": "page_activitydetailpage", "stateId": null},
          "meta": {"reason": "derived from parentDiagramId"}
        },
        {
          "id": "c.page_entry.contains.page_myactivitiespage",
          "type": "contains",
          "from": {"diagramId": "page_entry", "stateId": null},
          "to": {"diagramId": "page_myactivitiespage", "stateId": null},
          "meta": {"reason": "derived from parentDiagramId"}
        },
        {
          "id": "c.page_entry.contains.page_adminactivitylistpage",
          "type": "contains",
          "from": {"diagramId": "page_entry", "stateId": null},
          "to": {"diagramId": "page_adminactivitylistpage", "stateId": null},
          "meta": {"reason": "derived from parentDiagramId"}
        },
        {
          "id": "c.page_entry.contains.page_adminactivityeditorpage",
          "type": "contains",
          "from": {"diagramId": "page_entry", "stateId": null},
          "to": {"diagramId": "page_adminactivityeditorpage", "stateId": null},
          "meta": {"reason": "derived from parentDiagramId"}
        },
        {
          "id": "c.page_entry.contains.page_adminregistrationspage",
          "type": "contains", 
          "from": {"diagramId": "page_entry", "stateId": null},
          "to": {"diagramId": "page_adminregistrationspage", "stateId": null},
          "meta": {"reason": "derived from parentDiagramId"}
        },
        {
          "id": "c.page_entry.contains.feature_login",
          "type": "contains",
          "from": {"diagramId": "page_entry", "stateId": null},
          "to": {"diagramId": "feature_login", "stateId": null},
          "meta": {"reason": "derived from parentDiagramId"}
        },
        {
          "id": "c.page_entry.contains.feature_register",
          "type": "contains",
          "from": {"diagramId": "page_entry", "stateId": null},
          "to": {"diagramId": "feature_register", "stateId": null},
          "meta": {"reason": "derived from parentDiagramId"}
        },
        {
          "id": "c.page_entry.contains.feature_logout",
          "type": "contains",
          "from": {"diagramId": "page_entry", "stateId": null},
          "to": {"diagramId": "feature_logout", "stateId": null},
          "meta": {"reason": "derived from parentDiagramId"}
        },
        {
          "id": "c.page_entry.contains.feature_registration_register",
          "type": "contains",
          "from": {"diagramId": "page_entry", "stateId": null},
          "to": {"diagramId": "feature_registration_register", "stateId": null},
          "meta": {"reason": "derived from parentDiagramId"}
        },
        {
          "id": "c.page_entry.contains.feature_registration_cancel",
          "type": "contains",
          "from": {"diagramId": "page_entry", "stateId": null},
          "to": {"diagramId": "feature_registration_cancel", "stateId": null},
          "meta": {"reason": "derived from parentDiagramId"}
        },
        {
          "id": "c.page_entry.contains.feature_adminactivity_save",
          "type": "contains",
          "from": {"diagramId": "page_entry", "stateId": null},
          "to": {"diagramId": "feature_adminactivity_save", "stateId": null},
          "meta": {"reason": "derived from parentDiagramId"}
        },
        {
          "id": "c.page_entry.contains.feature_adminactivity_publish",
          "type": "contains",
          "from": {"diagramId": "page_entry", "stateId": null},
          "to": {"diagramId": "feature_adminactivity_publish", "stateId": null},
          "meta": {"reason": "derived from parentDiagramId"}
        },
        {
          "id": "c.page_entry.contains.feature_adminactivity_close",
          "type": "contains",
          "from": {"diagramId": "page_entry", "stateId": null},
          "to": {"diagramId": "feature_adminactivity_close", "stateId": null},
          "meta": {"reason": "derived from parentDiagramId"}
        },
        {
          "id": "c.page_entry.contains.feature_adminactivity_archive",
          "type": "contains",
          "from": {"diagramId": "page_entry", "stateId": null},
          "to": {"diagramId": "feature_adminactivity_archive", "stateId": null},
          "meta": {"reason": "derived from parentDiagramId"}
        },
        {
          "id": "c.page_entry.contains.feature_adminregistrations_exportcsv",
          "type": "contains",
          "from": {"diagramId": "page_entry", "stateId": null},
          "to": {"diagramId": "feature_adminregistrations_exportcsv", "stateId": null},
          "meta": {"reason": "derived from parentDiagramId"}
        },
        {
          "id": "c.page_entry.contains.page_21",
          "type": "contains",
          "from": {"diagramId": "page_entry", "stateId": null},
          "to": {"diagramId": "page_21", "stateId": null},
          "meta": {"reason": "derived from parentDiagramId"}
        },
        {
          "id": "c.page_entry.invokes.page_activitylistpage.s.page_Entry_Guest.a_enterActivities.to.page_ActivityListPage_Loading",
          "type": "invokes",
          "from": {"diagramId": "page_entry", "stateId": "page.Entry.Guest"},
          "to": {"diagramId": "page_activitylistpage", "stateId": "page.ActivityListPage.Loading"},
          "meta": {
            "reason": "enterActivities | navigate /activities",
            "action": "enterActivities",
            "navigateTarget": "/activities",
            "validations": [
              "進入 `/activities`；活動列表進入 Loading 並發送列表查詢；列表只會顯示 published/full。"
            ]
          }
        },
        {
          "id": "c.page_entry.invokes.page_activitylistpage.s.page_Entry_Member.a_enterActivities.to.page_ActivityListPage_Loading",
          "type": "invokes",
          "from": {"diagramId": "page_entry", "stateId": "page.Entry.Member"},
          "to": {"diagramId": "page_activitylistpage", "stateId": "page.ActivityListPage.Loading"},
          "meta": {
            "reason": "enterActivities | navigate /activities",
            "action": "enterActivities",
            "navigateTarget": "/activities",
            "validations": [
              "進入 `/activities`；列表 Loading；同一活動顯示「可報名/已報名/額滿」需與後端一致。"
            ]
          }
        },
        {
          "id": "c.page_entry.invokes.page_activitylistpage.s.page_Entry_Admin.a_enterActivities.to.page_ActivityListPage_Loading",
          "type": "invokes",
          "from": {"diagramId": "page_entry", "stateId": "page.Entry.Admin"},
          "to": {"diagramId": "page_activitylistpage", "stateId": "page.ActivityListPage.Loading"},
          "meta": {
            "reason": "enterActivities | navigate /activities",
            "action": "enterActivities",
            "navigateTarget": "/activities",
            "validations": [
              "進入 `/activities`；列表 Loading；Admin 在一般列表仍只看 published/full（完整狀態需走 `/admin/*`）。"
            ]
          }
        }
      ],
      "meta": {
        "pageName": "Entry",
        "featureName": null,
        "entryStateId": "page.Entry.Init",
        "entryValidations": [
          "前端載入 App 後進入初始狀態；未發出任何需要登入的 API。"
        ]
      }
    },
    {
      "id": "page_login",
      "name": "Login Page",
      "level": "page",
      "parentDiagramId": "page_entry",
      "roles": [],
      "variant": {
        "kind": "standalone",
        "baseDiagramId": null,
        "deltaDiagramIdsByRole": {},
        "appliesToRoles": []
      },
      "source": {"type": "mermaid", "sectionTitle": "② Login Page", "order": 2},
      "groups": [],
      "states": [
        {
          "id": "page.LoginPage.Init",
          "label": "LoginPage.Init",
          "type": "start",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_login",
            "synthetic": false,
            "source": {"scope": "root", "raw": "LoginPage.Init"}
          }
        },
        {
          "id": "page.LoginPage.Editing",
          "label": "LoginPage.Editing",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_login",
            "synthetic": false,
            "source": {"scope": "root", "raw": "LoginPage.Editing"}
          }
        },
        {
          "id": "page.LoginPage.Redirecting",
          "label": "LoginPage.Redirecting",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_login",
            "synthetic": false,
            "source": {"scope": "root", "raw": "LoginPage.Redirecting"}
          }
        }
      ],
      "transitions": [
        {
          "id": "t.page_login.0001",
          "from": "page.LoginPage.Init",
          "to": "page.LoginPage.Editing",
          "event": "showForm",
          "roles": [],
          "validations": [
            "UI 顯示 Email/Password 欄位與送出按鈕；不顯示第二個重複的「登入導向」CTA（Header 已有則頁內不重複）。"
          ],
          "intent": {"category": "action", "summary": "showForm"},
          "meta": {
            "diagramId": "page_login",
            "source": {"raw": "LoginPage.Init --> LoginPage.Editing : showForm"}
          }
        }
      ],
      "connectors": [
        {
          "id": "c.page_login.invokes.feature_login.s.page_LoginPage_Editing.a_submitLogin.to.feature_Login_Submitting",
          "type": "invokes",
          "from": {"diagramId": "page_login", "stateId": "page.LoginPage.Editing"},
          "to": {"diagramId": "feature_login", "stateId": "feature.Login.Submitting"},
          "meta": {
            "reason": "submitLogin | navigate Feature.Login",
            "action": "submitLogin",
            "navigateTarget": "Feature.Login",
            "validations": [
              "點擊登入後按鈕 disabled + 顯示 loading；送出登入 API；失敗訊息不得洩漏帳號是否存在（訊息一致）。"
            ]
          }
        },
        {
          "id": "c.page_login.invokes.page_register.s.page_LoginPage_Editing.a_clickGoRegister.to.page_RegisterPage_Init",
          "type": "invokes",
          "from": {"diagramId": "page_login", "stateId": "page.LoginPage.Editing"},
          "to": {"diagramId": "page_register", "stateId": "page.RegisterPage.Init"},
          "meta": {
            "reason": "clickGoRegister | navigate /register",
            "action": "clickGoRegister",
            "navigateTarget": "/register",
            "validations": [
              "導向 `/register`；保留必要導覽（可回登入）；不丟失使用者已填但未送出的資料屬於可選（Spec 未強制）。"
            ]
          }
        },
        {
          "id": "c.page_login.invokes.page_activitylistpage.s.page_LoginPage_Redirecting.a_afterLoginNavigate.to.page_ActivityListPage_Loading",
          "type": "invokes",
          "from": {"diagramId": "page_login", "stateId": "page.LoginPage.Redirecting"},
          "to": {"diagramId": "page_activitylistpage", "stateId": "page.ActivityListPage.Loading"},
          "meta": {
            "reason": "afterLoginNavigate | navigate /activities",
            "action": "afterLoginNavigate",
            "navigateTarget": "/activities",
            "validations": [
              "導向列表後觸發列表重新載入；Header 依 role 顯示正確選項。"
            ]
          }
        }
      ],
      "meta": {
        "pageName": "LoginPage",
        "featureName": null,
        "entryStateId": "page.LoginPage.Init",
        "entryValidations": [
          "進入 `/login` 時不需要已登入；若已登入可選擇導回 `/activities`（避免重複登入）。"
        ]
      }
    },
    {
      "id": "page_register",
      "name": "Register Page",
      "level": "page",
      "parentDiagramId": "page_entry",
      "roles": [],
      "variant": {
        "kind": "standalone",
        "baseDiagramId": null,
        "deltaDiagramIdsByRole": {},
        "appliesToRoles": []
      },
      "source": {"type": "mermaid", "sectionTitle": "③ Register Page", "order": 3},
      "groups": [],
      "states": [
        {
          "id": "page.RegisterPage.Init",
          "label": "RegisterPage.Init",
          "type": "start",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_register",
            "synthetic": false,
            "source": {"scope": "root", "raw": "RegisterPage.Init"}
          }
        },
        {
          "id": "page.RegisterPage.Editing",
          "label": "RegisterPage.Editing",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_register",
            "synthetic": false,
            "source": {"scope": "root", "raw": "RegisterPage.Editing"}
          }
        },
        {
          "id": "page.RegisterPage.Redirecting",
          "label": "RegisterPage.Redirecting",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_register",
            "synthetic": false,
            "source": {"scope": "root", "raw": "RegisterPage.Redirecting"}
          }
        }
      ],
      "transitions": [
        {
          "id": "t.page_register.0001",
          "from": "page.RegisterPage.Init",
          "to": "page.RegisterPage.Editing",
          "event": "showForm",
          "roles": [],
          "validations": [
            "UI 顯示註冊欄位（name/email/password）與送出；email 必須唯一（若重複需顯示錯誤）。"
          ],
          "intent": {"category": "action", "summary": "showForm"},
          "meta": {
            "diagramId": "page_register",
            "source": {"raw": "RegisterPage.Init --> RegisterPage.Editing : showForm"}
          }
        }
      ],
      "connectors": [
        {
          "id": "c.page_register.invokes.feature_register.s.page_RegisterPage_Editing.a_submitRegister.to.feature_Register_Submitting",
          "type": "invokes",
          "from": {"diagramId": "page_register", "stateId": "page.RegisterPage.Editing"},
          "to": {"diagramId": "feature_register", "stateId": "feature.Register.Submitting"},
          "meta": {
            "reason": "submitRegister | navigate Feature.Register",
            "action": "submitRegister",
            "navigateTarget": "Feature.Register",
            "validations": [
              "送出期間按鈕 disabled + loading；送出註冊 API；若 email 重複需回可顯示訊息。"
            ]
          }
        },
        {
          "id": "c.page_register.invokes.page_login.s.page_RegisterPage_Editing.a_clickGoLogin.to.page_LoginPage_Init",
          "type": "invokes",
          "from": {"diagramId": "page_register", "stateId": "page.RegisterPage.Editing"},
          "to": {"diagramId": "page_login", "stateId": "page.LoginPage.Init"},
          "meta": {
            "reason": "clickGoLogin | navigate /login",
            "action": "clickGoLogin",
            "navigateTarget": "/login",
            "validations": [
              "可導回登入頁；不暴露管理後台入口。"
            ]
          }
        },
        {
          "id": "c.page_register.invokes.page_activitylistpage.s.page_RegisterPage_Redirecting.a_afterRegisterNavigate.to.page_ActivityListPage_Loading",
          "type": "invokes",
          "from": {"diagramId": "page_register", "stateId": "page.RegisterPage.Redirecting"},
          "to": {"diagramId": "page_activitylistpage", "stateId": "page.ActivityListPage.Loading"},
          "meta": {
            "reason": "afterRegisterNavigate | navigate /activities",
            "action": "afterRegisterNavigate",
            "navigateTarget": "/activities",
            "validations": [
              "導向列表後重新載入；Header 顯示已登入狀態（Member 或 Admin 依帳號角色）。"
            ]
          }
        }
      ],
      "meta": {
        "pageName": "RegisterPage",
        "featureName": null,
        "entryStateId": "page.RegisterPage.Init",
        "entryValidations": [
          "進入 `/register` 不需要已登入；若已登入可選擇導回 `/activities`。"
        ]
      }
    },
    {
      "id": "page_activitylistpage",
      "name": "Activity List Page",
      "level": "page",
      "parentDiagramId": "page_entry",
      "roles": [],
      "variant": {
        "kind": "standalone",
        "baseDiagramId": null,
        "deltaDiagramIdsByRole": {},
        "appliesToRoles": []
      },
      "source": {"type": "mermaid", "sectionTitle": "④ ActivityListPage Page", "order": 4},
      "groups": [],
      "states": [
        {
          "id": "page.ActivityListPage.Init",
          "label": "ActivityListPage.Init",
          "type": "start",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_activitylistpage",
            "synthetic": false,
            "source": {"scope": "root", "raw": "ActivityListPage.Init"}
          }
        },
        {
          "id": "page.ActivityListPage.Loading",
          "label": "ActivityListPage.Loading",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_activitylistpage",
            "synthetic": false,
            "source": {"scope": "root", "raw": "ActivityListPage.Loading"}
          }
        },
        {
          "id": "page.ActivityListPage.Ready",
          "label": "ActivityListPage.Ready",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_activitylistpage",
            "synthetic": false,
            "source": {"scope": "root", "raw": "ActivityListPage.Ready"}
          }
        },
        {
          "id": "page.ActivityListPage.Empty",
          "label": "ActivityListPage.Empty",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_activitylistpage",
            "synthetic": false,
            "source": {"scope": "root", "raw": "ActivityListPage.Empty"}
          }
        },
        {
          "id": "page.ActivityListPage.Error",
          "label": "ActivityListPage.Error",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_activitylistpage",
            "synthetic": false,
            "source": {"scope": "root", "raw": "ActivityListPage.Error"}
          }
        }
      ],
      "transitions": [
        {
          "id": "t.page_activitylistpage.0001",
          "from": "page.ActivityListPage.Init",
          "to": "page.ActivityListPage.Loading",
          "event": "fetchActivities",
          "roles": [],
          "validations": [
            "呼叫列表 API；回傳資料僅包含 published/full；日期/截止時間以系統預設時區呈現。"
          ],
          "intent": {"category": "action", "summary": "fetchActivities"},
          "meta": {
            "diagramId": "page_activitylistpage",
            "source": {"raw": "ActivityListPage.Init --> ActivityListPage.Loading : fetchActivities"}
          }
        },
        {
          "id": "t.page_activitylistpage.0002",
          "from": "page.ActivityListPage.Loading",
          "to": "page.ActivityListPage.Ready",
          "event": "fetchSuccess(hasItems)",
          "roles": [],
          "validations": [
            "UI 顯示活動卡片清單；每筆顯示 title/date/location/registered_count/capacity；Member 需能看到已報名標示（若適用）。"
          ],
          "intent": {"category": "action", "summary": "fetchSuccess(hasItems)"},
          "meta": {
            "diagramId": "page_activitylistpage",
            "source": {"raw": "ActivityListPage.Loading --> ActivityListPage.Ready : fetchSuccess(hasItems)"}
          }
        },
        {
          "id": "t.page_activitylistpage.0003",
          "from": "page.ActivityListPage.Loading",
          "to": "page.ActivityListPage.Empty",
          "event": "fetchSuccess(noItems)",
          "roles": [],
          "validations": [
            "UI 顯示 empty 狀態文案；仍可導向登入/註冊（Guest）或其他頁；不顯示錯誤。"
          ],
          "intent": {"category": "action", "summary": "fetchSuccess(noItems)"},
          "meta": {
            "diagramId": "page_activitylistpage",
            "source": {"raw": "ActivityListPage.Loading --> ActivityListPage.Empty : fetchSuccess(noItems)"}
          }
        },
        {
          "id": "t.page_activitylistpage.0004",
          "from": "page.ActivityListPage.Loading",
          "to": "page.ActivityListPage.Error",
          "event": "fetchFailed",
          "roles": [],
          "validations": [
            "UI 顯示 error 狀態與 retry；不得卡在 loading。"
          ],
          "intent": {"category": "action", "summary": "fetchFailed"},
          "meta": {
            "diagramId": "page_activitylistpage",
            "source": {"raw": "ActivityListPage.Loading --> ActivityListPage.Error : fetchFailed"}
          }
        },
        {
          "id": "t.page_activitylistpage.0005",
          "from": "page.ActivityListPage.Error",
          "to": "page.ActivityListPage.Loading",
          "event": "retryFetch",
          "roles": [],
          "validations": [
            "點擊 retry 會重新發送列表 API；成功後轉 Ready/Empty。"
          ],
          "intent": {"category": "action", "summary": "retryFetch"},
          "meta": {
            "diagramId": "page_activitylistpage",
            "source": {"raw": "ActivityListPage.Error --> ActivityListPage.Loading : retryFetch"}
          }
        }
      ],
      "connectors": [
        {
          "id": "c.page_activitylistpage.invokes.page_activitydetailpage.s.page_ActivityListPage_Ready.a_clickActivityCard.to.page_ActivityDetailPage_Loading",
          "type": "invokes",
          "from": {"diagramId": "page_activitylistpage", "stateId": "page.ActivityListPage.Ready"},
          "to": {"diagramId": "page_activitydetailpage", "stateId": "page.ActivityDetailPage.Loading"},
          "meta": {
            "reason": "clickActivityCard | navigate /activities/:activityId",
            "action": "clickActivityCard",
            "navigateTarget": "/activities/:activityId",
            "validations": [
              "導向詳情路由；詳情頁先進入 Loading 再發送詳情查詢。"
            ]
          }
        },
        {
          "id": "c.page_activitylistpage.invokes.page_activitydetailpage.s.page_ActivityListPage_Empty.a_openActivityById.to.page_ActivityDetailPage_Loading",
          "type": "invokes",
          "from": {"diagramId": "page_activitylistpage", "stateId": "page.ActivityListPage.Empty"},
          "to": {"diagramId": "page_activitydetailpage", "stateId": "page.ActivityDetailPage.Loading"},
          "meta": {
            "reason": "openActivityById | navigate /activities/:activityId",
            "action": "openActivityById",
            "navigateTarget": "/activities/:activityId",
            "validations": [
              "若使用者直接輸入 URL（列表為空也可能），仍會走詳情 Loading；若活動不可見需顯示 NotFound。"
            ]
          }
        },
        {
          "id": "c.page_activitylistpage.invokes.page_myactivitiespage.s.page_ActivityListPage_Ready.a_clickMyActivities.to.page_MyActivitiesPage_Loading",
          "type": "invokes",
          "from": {"diagramId": "page_activitylistpage", "stateId": "page.ActivityListPage.Ready"},
          "to": {"diagramId": "page_myactivitiespage", "stateId": "page.MyActivitiesPage.Loading"},
          "meta": {
            "reason": "clickMyActivities | navigate /my-activities",
            "action": "clickMyActivities",
            "navigateTarget": "/my-activities",
            "validations": [
              "Guest 點擊（若不顯示此入口則不會發生）；若發生則應導向登入並保留 returnTo；Member/Admin 則進入我的活動 Loading。"
            ]
          }
        },
        {
          "id": "c.page_activitylistpage.invokes.page_adminactivitylistpage.s.page_ActivityListPage_Ready.a_clickAdminPanel.to.page_AdminActivityListPage_Loading",
          "type": "invokes",
          "from": {"diagramId": "page_activitylistpage", "stateId": "page.ActivityListPage.Ready"},
          "to": {"diagramId": "page_adminactivitylistpage", "stateId": "page.AdminActivityListPage.Loading"},
          "meta": {
            "reason": "clickAdminPanel | navigate /admin/activities",
            "action": "clickAdminPanel",
            "navigateTarget": "/admin/activities",
            "validations": [
              "只有 Admin Header 會顯示此入口；若 Member 強行進入需回 403；Guest 需導向登入。"
            ]
          }
        },
        {
          "id": "c.page_activitylistpage.invokes.feature_logout.s.page_ActivityListPage_Ready.a_clickLogout.to.feature_Logout_Confirming",
          "type": "invokes",
          "from": {"diagramId": "page_activitylistpage", "stateId": "page.ActivityListPage.Ready"},
          "to": {"diagramId": "feature_logout", "stateId": "feature.Logout.Confirming"},
          "meta": {
            "reason": "clickLogout | navigate Feature.Logout",
            "action": "clickLogout",
            "navigateTarget": "Feature.Logout",
            "validations": [
              "只有已登入狀態才會顯示登出入口；點擊後進入確認狀態（不直接登出）。"
            ]
          }
        }
      ],
      "meta": {
        "pageName": "ActivityListPage",
        "featureName": null,
        "entryStateId": "page.ActivityListPage.Init",
        "entryValidations": [
          "進入 `/activities`；顯示頁面骨架或 loading；不應先顯示空資料當作 ready。"
        ]
      }
    },
    {
      "id": "page_activitydetailpage",
      "name": "Activity Detail Page",
      "level": "page",
      "parentDiagramId": "page_entry",
      "roles": [],
      "variant": {
        "kind": "standalone",
        "baseDiagramId": null,
        "deltaDiagramIdsByRole": {},
        "appliesToRoles": []
      },
      "source": {"type": "mermaid", "sectionTitle": "⑤ ActivityDetailPage Page", "order": 5},
      "groups": [],
      "states": [
        {
          "id": "page.ActivityDetailPage.Init",
          "label": "ActivityDetailPage.Init",
          "type": "start",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_activitydetailpage",
            "synthetic": false,
            "source": {"scope": "root", "raw": "ActivityDetailPage.Init"}
          }
        },
        {
          "id": "page.ActivityDetailPage.Loading",
          "label": "ActivityDetailPage.Loading",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_activitydetailpage",
            "synthetic": false,
            "source": {"scope": "root", "raw": "ActivityDetailPage.Loading"}
          }
        },
        {
          "id": "page.ActivityDetailPage.Ready",
          "label": "ActivityDetailPage.Ready",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_activitydetailpage",
            "synthetic": false,
            "source": {"scope": "root", "raw": "ActivityDetailPage.Ready"}
          }
        },
        {
          "id": "page.ActivityDetailPage.NotFound",
          "label": "ActivityDetailPage.NotFound",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_activitydetailpage",
            "synthetic": false,
            "source": {"scope": "root", "raw": "ActivityDetailPage.NotFound"}
          }
        },
        {
          "id": "page.ActivityDetailPage.Error",
          "label": "ActivityDetailPage.Error",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_activitydetailpage",
            "synthetic": false,
            "source": {"scope": "root", "raw": "ActivityDetailPage.Error"}
          }
        },
        {
          "id": "page.ActivityDetailPage.Refreshing",
          "label": "ActivityDetailPage.Refreshing",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_activitydetailpage",
            "synthetic": false,
            "source": {"scope": "root", "raw": "ActivityDetailPage.Refreshing"}
          }
        }
      ],
      "transitions": [
        {
          "id": "t.page_activitydetailpage.0001",
          "from": "page.ActivityDetailPage.Init",
          "to": "page.ActivityDetailPage.Loading",
          "event": "fetchActivityDetail",
          "roles": [],
          "validations": [
            "呼叫詳情 API；Guest/Member 只能取到 published/full；若活動為 draft/closed/archived 或不存在，應回 404。"
          ],
          "intent": {"category": "action", "summary": "fetchActivityDetail"},
          "meta": {
            "diagramId": "page_activitydetailpage",
            "source": {"raw": "ActivityDetailPage.Init --> ActivityDetailPage.Loading : fetchActivityDetail"}
          }
        },
        {
          "id": "t.page_activitydetailpage.0002",
          "from": "page.ActivityDetailPage.Loading",
          "to": "page.ActivityDetailPage.Ready",
          "event": "fetchSuccess(visible)",
          "roles": [],
          "validations": [
            "UI 顯示 title/description/date/location/deadline/capacity/status/registered_count；依登入與報名狀態顯示「請登入以報名/報名/取消/不可操作原因」。"
          ],
          "intent": {"category": "action", "summary": "fetchSuccess(visible)"},
          "meta": {
            "diagramId": "page_activitydetailpage",
            "source": {"raw": "ActivityDetailPage.Loading --> ActivityDetailPage.Ready : fetchSuccess(visible)"}
          }
        },
        {
          "id": "t.page_activitydetailpage.0003",
          "from": "page.ActivityDetailPage.Loading",
          "to": "page.ActivityDetailPage.NotFound",
          "event": "fetchNotFoundOrNotVisible",
          "roles": [],
          "validations": [
            "UI 顯示 not found；提供回到 `/activities` 的入口；不得洩漏管理後台狀態（例如 closed/draft）。"
          ],
          "intent": {"category": "action", "summary": "fetchNotFoundOrNotVisible"},
          "meta": {
            "diagramId": "page_activitydetailpage",
            "source": {"raw": "ActivityDetailPage.Loading --> ActivityDetailPage.NotFound : fetchNotFoundOrNotVisible"}
          }
        },
        {
          "id": "t.page_activitydetailpage.0004",
          "from": "page.ActivityDetailPage.Loading",
          "to": "page.ActivityDetailPage.Error",
          "event": "fetchFailed",
          "roles": [],
          "validations": [
            "UI 顯示 error 與 retry；不顯示操作按鈕。"
          ],
          "intent": {"category": "action", "summary": "fetchFailed"},
          "meta": {
            "diagramId": "page_activitydetailpage",
            "source": {"raw": "ActivityDetailPage.Loading --> ActivityDetailPage.Error : fetchFailed"}
          }
        },
        {
          "id": "t.page_activitydetailpage.0005",
          "from": "page.ActivityDetailPage.Error",
          "to": "page.ActivityDetailPage.Loading",
          "event": "retryFetch",
          "roles": [],
          "validations": [
            "retry 會重送詳情 API；成功後進 Ready/NotFound。"
          ],
          "intent": {"category": "action", "summary": "retryFetch"},
          "meta": {
            "diagramId": "page_activitydetailpage",
            "source": {"raw": "ActivityDetailPage.Error --> ActivityDetailPage.Loading : retryFetch"}
          }
        },
        {
          "id": "t.page_activitydetailpage.0006",
          "from": "page.ActivityDetailPage.Refreshing",
          "to": "page.ActivityDetailPage.Loading",
          "event": "refetchAfterMutation",
          "roles": [],
          "validations": [
            "成功後會重新抓取詳情以確保 UI 與後端一致（registered_count/status/按鈕狀態同步）。"
          ],
          "intent": {"category": "action", "summary": "refetchAfterMutation"},
          "meta": {
            "diagramId": "page_activitydetailpage",
            "source": {"raw": "ActivityDetailPage.Refreshing --> ActivityDetailPage.Loading : refetchAfterMutation"}
          }
        }
      ],
      "connectors": [
        {
          "id": "c.page_activitydetailpage.invokes.page_activitylistpage.s.page_ActivityDetailPage_Ready.a_clickBackToList.to.page_ActivityListPage_Loading",
          "type": "invokes",
          "from": {"diagramId": "page_activitydetailpage", "stateId": "page.ActivityDetailPage.Ready"},
          "to": {"diagramId": "page_activitylistpage", "stateId": "page.ActivityListPage.Loading"},
          "meta": {
            "reason": "clickBackToList | navigate /activities",
            "action": "clickBackToList",
            "navigateTarget": "/activities",
            "validations": [
              "導回列表並重新載入（或使用快取但畫面需一致）；Header 狀態保持正確。"
            ]
          }
        },
        {
          "id": "c.page_activitydetailpage.invokes.feature_registration_register.s.page_ActivityDetailPage_Ready.a_clickRegister.to.feature_Registration_Register_Submitting",
          "type": "invokes",
          "from": {"diagramId": "page_activitydetailpage", "stateId": "page.ActivityDetailPage.Ready"},
          "to": {"diagramId": "feature_registration_register", "stateId": "feature.Registration.Register.Submitting"},
          "meta": {
            "reason": "clickRegister | navigate Feature.Registration.Register",
            "action": "clickRegister",
            "navigateTarget": "Feature.Registration.Register",
            "validations": [
              "點擊報名後按鈕 disabled + loading；若 Guest 不應出現此按鈕（應顯示導向登入）；後端需以交易避免超賣並回傳一致結果。"
            ]
          }
        },
        {
          "id": "c.page_activitydetailpage.invokes.feature_registration_cancel.s.page_ActivityDetailPage_Ready.a_clickCancelRegistration.to.feature_Registration_Cancel_Submitting",
          "type": "invokes",
          "from": {"diagramId": "page_activitydetailpage", "stateId": "page.ActivityDetailPage.Ready"},
          "to": {"diagramId": "feature_registration_cancel", "stateId": "feature.Registration.Cancel.Submitting"},
          "meta": {
            "reason": "clickCancelRegistration | navigate Feature.Registration.Cancel",
            "action": "clickCancelRegistration",
            "navigateTarget": "Feature.Registration.Cancel",
            "validations": [
              "點擊取消後按鈕 disabled + loading；後端需做冪等取消（已取消重送仍成功）。"
            ]
          }
        }
      ],
      "meta": {
        "pageName": "ActivityDetailPage",
        "featureName": null,
        "entryStateId": "page.ActivityDetailPage.Init",
        "entryValidations": [
          "進入詳情頁先顯示 loading 骨架；尚未取得資料前不顯示報名/取消按鈕。"
        ]
      }
    },
    {
      "id": "page_myactivitiespage",
      "name": "My Activities Page",
      "level": "page",
      "parentDiagramId": "page_entry",
      "roles": [],
      "variant": {
        "kind": "standalone",
        "baseDiagramId": null,
        "deltaDiagramIdsByRole": {},
        "appliesToRoles": []
      },
      "source": {"type": "mermaid", "sectionTitle": "⑥ MyActivitiesPage Page", "order": 6},
      "groups": [],
      "states": [
        {
          "id": "page.MyActivitiesPage.Init",
          "label": "MyActivitiesPage.Init",
          "type": "start",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_myactivitiespage",
            "synthetic": false,
            "source": {"scope": "root", "raw": "MyActivitiesPage.Init"}
          }
        },
        {
          "id": "page.MyActivitiesPage.AuthGuard",
          "label": "MyActivitiesPage.AuthGuard",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_myactivitiespage",
            "synthetic": false,
            "source": {"scope": "root", "raw": "MyActivitiesPage.AuthGuard"}
          }
        },
        {
          "id": "page.MyActivitiesPage.RedirectToLogin",
          "label": "MyActivitiesPage.RedirectToLogin",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_myactivitiespage",
            "synthetic": false,
            "source": {"scope": "root", "raw": "MyActivitiesPage.RedirectToLogin"}
          }
        },
        {
          "id": "page.MyActivitiesPage.Loading",
          "label": "MyActivitiesPage.Loading",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_myactivitiespage",
            "synthetic": false,
            "source": {"scope": "root", "raw": "MyActivitiesPage.Loading"}
          }
        },
        {
          "id": "page.MyActivitiesPage.Ready",
          "label": "MyActivitiesPage.Ready",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_myactivitiespage",
            "synthetic": false,
            "source": {"scope": "root", "raw": "MyActivitiesPage.Ready"}
          }
        },
        {
          "id": "page.MyActivitiesPage.Empty",
          "label": "MyActivitiesPage.Empty",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_myactivitiespage",
            "synthetic": false,
            "source": {"scope": "root", "raw": "MyActivitiesPage.Empty"}
          }
        },
        {
          "id": "page.MyActivitiesPage.Error",
          "label": "MyActivitiesPage.Error",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_myactivitiespage",
            "synthetic": false,
            "source": {"scope": "root", "raw": "MyActivitiesPage.Error"}
          }
        }
      ],
      "transitions": [
        {
          "id": "t.page_myactivitiespage.0001",
          "from": "page.MyActivitiesPage.Init",
          "to": "page.MyActivitiesPage.AuthGuard",
          "event": "checkAuth",
          "roles": [],
          "validations": [
            "驗證 session/token；若無效需走 401 導向流程。"
          ],
          "intent": {"category": "action", "summary": "checkAuth"},
          "meta": {
            "diagramId": "page_myactivitiespage",
            "source": {"raw": "MyActivitiesPage.Init --> MyActivitiesPage.AuthGuard : checkAuth"}
          }
        },
        {
          "id": "t.page_myactivitiespage.0002",
          "from": "page.MyActivitiesPage.AuthGuard",
          "to": "page.MyActivitiesPage.RedirectToLogin",
          "event": "notLoggedIn",
          "roles": [],
          "validations": [
            "前端導向登入並保留 returnTo=/my-activities；後端若有 API 請求應回 401。"
          ],
          "intent": {"category": "action", "summary": "notLoggedIn"},
          "meta": {
            "diagramId": "page_myactivitiespage",
            "source": {"raw": "MyActivitiesPage.AuthGuard --> MyActivitiesPage.RedirectToLogin : notLoggedIn"}
          }
        },
        {
          "id": "t.page_myactivitiespage.0003",
          "from": "page.MyActivitiesPage.AuthGuard",
          "to": "page.MyActivitiesPage.Loading",
          "event": "loggedIn",
          "roles": [],
          "validations": [
            "已登入時進入 Loading 並呼叫「我的活動」API（只回傳有效報名、依活動日期由近到遠排序）。"
          ],
          "intent": {"category": "action", "summary": "loggedIn"},
          "meta": {
            "diagramId": "page_myactivitiespage",
            "source": {"raw": "MyActivitiesPage.AuthGuard --> MyActivitiesPage.Loading : loggedIn"}
          }
        },
        {
          "id": "t.page_myactivitiespage.0004",
          "from": "page.MyActivitiesPage.Loading",
          "to": "page.MyActivitiesPage.Ready",
          "event": "fetchSuccess(hasItems)",
          "roles": [],
          "validations": [
            "UI 顯示清單；每筆顯示活動資訊與狀態（即將開始/已結束）；排序符合由近到遠。"
          ],
          "intent": {"category": "action", "summary": "fetchSuccess(hasItems)"},
          "meta": {
            "diagramId": "page_myactivitiespage",
            "source": {"raw": "MyActivitiesPage.Loading --> MyActivitiesPage.Ready : fetchSuccess(hasItems)"}
          }
        },
        {
          "id": "t.page_myactivitiespage.0005",
          "from": "page.MyActivitiesPage.Loading",
          "to": "page.MyActivitiesPage.Empty",
          "event": "fetchSuccess(noItems)",
          "roles": [],
          "validations": [
            "UI 顯示 empty；不顯示錯誤；提供導向 `/activities`。"
          ],
          "intent": {"category": "action", "summary": "fetchSuccess(noItems)"},
          "meta": {
            "diagramId": "page_myactivitiespage",
            "source": {"raw": "MyActivitiesPage.Loading --> MyActivitiesPage.Empty : fetchSuccess(noItems)"}
          }
        },
        {
          "id": "t.page_myactivitiespage.0006",
          "from": "page.MyActivitiesPage.Loading",
          "to": "page.MyActivitiesPage.Error",
          "event": "fetchFailed",
          "roles": [],
          "validations": [
            "UI 顯示 error + retry；不得停留在 loading。"
          ],
          "intent": {"category": "action", "summary": "fetchFailed"},
          "meta": {
            "diagramId": "page_myactivitiespage",
            "source": {"raw": "MyActivitiesPage.Loading --> MyActivitiesPage.Error : fetchFailed"}
          }
        },
        {
          "id": "t.page_myactivitiespage.0007",
          "from": "page.MyActivitiesPage.Error",
          "to": "page.MyActivitiesPage.Loading",
          "event": "retryFetch",
          "roles": [],
          "validations": [
            "retry 會重新呼叫 API；成功後進 Ready/Empty。"
          ],
          "intent": {"category": "action", "summary": "retryFetch"},
          "meta": {
            "diagramId": "page_myactivitiespage",
            "source": {"raw": "MyActivitiesPage.Error --> MyActivitiesPage.Loading : retryFetch"}
          }
        }
      ],
      "connectors": [
        {
          "id": "c.page_myactivitiespage.invokes.page_login.s.page_MyActivitiesPage_RedirectToLogin.a_redirect.to.page_LoginPage_Init",
          "type": "invokes",
          "from": {"diagramId": "page_myactivitiespage", "stateId": "page.MyActivitiesPage.RedirectToLogin"},
          "to": {"diagramId": "page_login", "stateId": "page.LoginPage.Init"},
          "meta": {
            "reason": "redirect | navigate /login",
            "action": "redirect",
            "navigateTarget": "/login",
            "validations": [
              "確實進入 `/login` 且帶 returnTo；登入成功後回到 `/my-activities`（或依產品導向規則）。"
            ]
          }
        },
        {
          "id": "c.page_myactivitiespage.invokes.page_activitydetailpage.s.page_MyActivitiesPage_Ready.a_clickMyActivityItem.to.page_ActivityDetailPage_Loading",
          "type": "invokes",
          "from": {"diagramId": "page_myactivitiespage", "stateId": "page.MyActivitiesPage.Ready"},
          "to": {"diagramId": "page_activitydetailpage", "stateId": "page.ActivityDetailPage.Loading"},
          "meta": {
            "reason": "clickMyActivityItem | navigate /activities/:activityId",
            "action": "clickMyActivityItem",
            "navigateTarget": "/activities/:activityId",
            "validations": [
              "點擊項目導向詳情；若活動在一般詳情不可見（例如 archived/closed/draft），此情境不應出現在我的活動（因只列有效報名且活動可見性依後端設計；若仍不可見則顯示 NotFound）。"
            ]
          }
        },
        {
          "id": "c.page_myactivitiespage.invokes.page_activitylistpage.s.page_MyActivitiesPage_Ready.a_clickActivities.to.page_ActivityListPage_Loading",
          "type": "invokes",
          "from": {"diagramId": "page_myactivitiespage", "stateId": "page.MyActivitiesPage.Ready"},
          "to": {"diagramId": "page_activitylistpage", "stateId": "page.ActivityListPage.Loading"},
          "meta": {
            "reason": "clickActivities | navigate /activities",
            "action": "clickActivities",
            "navigateTarget": "/activities",
            "validations": [
              "導回列表並重新載入或以快取呈現（但狀態與名額需一致）。"
            ]
          }
        },
        {
          "id": "c.page_myactivitiespage.invokes.feature_logout.s.page_MyActivitiesPage_Ready.a_clickLogout.to.feature_Logout_Confirming",
          "type": "invokes",
          "from": {"diagramId": "page_myactivitiespage", "stateId": "page.MyActivitiesPage.Ready"},
          "to": {"diagramId": "feature_logout", "stateId": "feature.Logout.Confirming"},
          "meta": {
            "reason": "clickLogout | navigate Feature.Logout",
            "action": "clickLogout",
            "navigateTarget": "Feature.Logout",
            "validations": [
              "點擊登出後顯示確認；取消則留在原頁；確認成功後 session/token 失效。"
            ]
          }
        }
      ],
      "meta": {
        "pageName": "MyActivitiesPage",
        "featureName": null,
        "entryStateId": "page.MyActivitiesPage.Init",
        "entryValidations": [
          "進入我的活動頁會先做登入檢查；Guest 不應看到此導覽入口。"
        ]
      }
    },
    {
      "id": "page_adminactivitylistpage",
      "name": "Admin Activity List Page",
      "level": "page",
      "parentDiagramId": "page_entry",
      "roles": [],
      "variant": {
        "kind": "base",
        "baseDiagramId": null,
        "deltaDiagramIdsByRole": {"admin": "page_adminactivitylistpage_admin"},
        "appliesToRoles": []
      },
      "source": {"type": "mermaid", "sectionTitle": "⑦ AdminActivityListPage Page", "order": 7},
      "groups": [],
      "states": [
        {
          "id": "page.AdminActivityListPage.Init",
          "label": "AdminActivityListPage.Init",
          "type": "start",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_adminactivitylistpage",
            "synthetic": false,
            "source": {"scope": "root", "raw": "AdminActivityListPage.Init"}
          }
        },
        {
          "id": "page.AdminActivityListPage.AuthzGuard",
          "label": "AdminActivityListPage.AuthzGuard",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_adminactivitylistpage",
            "synthetic": false,
            "source": {"scope": "root", "raw": "AdminActivityListPage.AuthzGuard"}
          }
        },
        {
          "id": "page.AdminActivityListPage.RedirectToLogin",
          "label": "AdminActivityListPage.RedirectToLogin",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_adminactivitylistpage",
            "synthetic": false,
            "source": {"scope": "root", "raw": "AdminActivityListPage.RedirectToLogin"}
          }
        },
        {
          "id": "page.AdminActivityListPage.Forbidden",
          "label": "AdminActivityListPage.Forbidden",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_adminactivitylistpage",
            "synthetic": false,
            "source": {"scope": "root", "raw": "AdminActivityListPage.Forbidden"}
          }
        },
        {
          "id": "page.AdminActivityListPage.Loading",
          "label": "AdminActivityListPage.Loading",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_adminactivitylistpage",
            "synthetic": false,
            "source": {"scope": "root", "raw": "AdminActivityListPage.Loading"}
          }
        },
        {
          "id": "page.AdminActivityListPage.Ready",
          "label": "AdminActivityListPage.Ready",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_adminactivitylistpage",
            "synthetic": false,
            "source": {"scope": "root", "raw": "AdminActivityListPage.Ready"}
          }
        },
        {
          "id": "page.AdminActivityListPage.Empty",
          "label": "AdminActivityListPage.Empty",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_adminactivitylistpage",
            "synthetic": false,
            "source": {"scope": "root", "raw": "AdminActivityListPage.Empty"}
          }
        },
        {
          "id": "page.AdminActivityListPage.Error",
          "label": "AdminActivityListPage.Error",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_adminactivitylistpage",
            "synthetic": false,
            "source": {"scope": "root", "raw": "AdminActivityListPage.Error"}
          }
        }
      ],
      "transitions": [
        {
          "id": "t.page_adminactivitylistpage.0001",
          "from": "page.AdminActivityListPage.Init",
          "to": "page.AdminActivityListPage.AuthzGuard",
          "event": "checkAdminRole",
          "roles": [],
          "validations": [
            "驗證 session/token 與 role；後端管理 API 需同時檢查避免前端繞過。"
          ],
          "intent": {"category": "action", "summary": "checkAdminRole"},
          "meta": {
            "diagramId": "page_adminactivitylistpage",
            "source": {"raw": "AdminActivityListPage.Init --> AdminActivityListPage.AuthzGuard : checkAdminRole"}
          }
        },
        {
          "id": "t.page_adminactivitylistpage.0002",
          "from": "page.AdminActivityListPage.AuthzGuard",
          "to": "page.AdminActivityListPage.RedirectToLogin",
          "event": "notLoggedIn",
          "roles": [],
          "validations": [
            "Guest 進入 `/admin/*` 需導向 `/login` 並保留 returnTo；後端回 401。"
          ],
          "intent": {"category": "action", "summary": "notLoggedIn"},
          "meta": {
            "diagramId": "page_adminactivitylistpage",
            "source": {"raw": "AdminActivityListPage.AuthzGuard --> AdminActivityListPage.RedirectToLogin : notLoggedIn"}
          }
        },
        {
          "id": "t.page_adminactivitylistpage.0003",
          "from": "page.AdminActivityListPage.AuthzGuard",
          "to": "page.AdminActivityListPage.Forbidden",
          "event": "loggedInButNotAdmin",
          "roles": [],
          "validations": [
            "Member 強行進入 `/admin/activities` 顯示 403；不得回 404（此產品規範為權限不足 403）。"
          ],
          "intent": {"category": "action", "summary": "loggedInButNotAdmin"},
          "meta": {
            "diagramId": "page_adminactivitylistpage",
            "source": {"raw": "AdminActivityListPage.AuthzGuard --> AdminActivityListPage.Forbidden : loggedInButNotAdmin"}
          }
        },
        {
          "id": "t.page_adminactivitylistpage.0004",
          "from": "page.AdminActivityListPage.AuthzGuard",
          "to": "page.AdminActivityListPage.Loading",
          "event": "isAdmin",
          "roles": [],
          "validations": [
            "Admin 進入 Loading 並呼叫管理活動列表 API；資料包含所有狀態（draft/published/full/closed/archived）。"
          ],
          "intent": {"category": "action", "summary": "isAdmin"},
          "meta": {
            "diagramId": "page_adminactivitylistpage",
            "source": {"raw": "AdminActivityListPage.AuthzGuard --> AdminActivityListPage.Loading : isAdmin"}
          }
        },
        {
          "id": "t.page_adminactivitylistpage.0005",
          "from": "page.AdminActivityListPage.Loading",
          "to": "page.AdminActivityListPage.Ready",
          "event": "fetchSuccess(hasItems)",
          "roles": [],
          "validations": [
            "UI 顯示完整活動清單與即時 registered_count/capacity；每筆顯示 status；提供編輯/名單/建立入口。"
          ],
          "intent": {"category": "action", "summary": "fetchSuccess(hasItems)"},
          "meta": {
            "diagramId": "page_adminactivitylistpage",
            "source": {"raw": "AdminActivityListPage.Loading --> AdminActivityListPage.Ready : fetchSuccess(hasItems)"}
          }
        },
        {
          "id": "t.page_adminactivitylistpage.0006",
          "from": "page.AdminActivityListPage.Loading",
          "to": "page.AdminActivityListPage.Empty",
          "event": "fetchSuccess(noItems)",
          "roles": [],
          "validations": [
            "UI 顯示 empty；仍可建立活動（建立入口可用）。"
          ],
          "intent": {"category": "action", "summary": "fetchSuccess(noItems)"},
          "meta": {
            "diagramId": "page_adminactivitylistpage",
            "source": {"raw": "AdminActivityListPage.Loading --> AdminActivityListPage.Empty : fetchSuccess(noItems)"}
          }
        },
        {
          "id": "t.page_adminactivitylistpage.0007",
          "from": "page.AdminActivityListPage.Loading",
          "to": "page.AdminActivityListPage.Error",
          "event": "fetchFailed",
          "roles": [],
          "validations": [
            "UI 顯示 error + retry；不顯示過期資料當作 ready。"
          ],
          "intent": {"category": "action", "summary": "fetchFailed"},
          "meta": {
            "diagramId": "page_adminactivitylistpage",
            "source": {"raw": "AdminActivityListPage.Loading --> AdminActivityListPage.Error : fetchFailed"}
          }
        },
        {
          "id": "t.page_adminactivitylistpage.0008",
          "from": "page.AdminActivityListPage.Error",
          "to": "page.AdminActivityListPage.Loading",
          "event": "retryFetch",
          "roles": [],
          "validations": [
            "retry 會重新查詢；成功後轉 Ready/Empty。"
          ],
          "intent": {"category": "action", "summary": "retryFetch"},
          "meta": {
            "diagramId": "page_adminactivitylistpage",
            "source": {"raw": "AdminActivityListPage.Error --> AdminActivityListPage.Loading : retryFetch"}
          }
        }
      ],
      "connectors": [
        {
          "id": "c.page_adminactivitylistpage.contains.page_adminactivitylistpage_admin",
          "type": "contains",
          "from": {"diagramId": "page_adminactivitylistpage", "stateId": null},
          "to": {"diagramId": "page_adminactivitylistpage_admin", "stateId": null},
          "meta": {"reason": "derived from parentDiagramId"}
        },
        {
          "id": "c.page_adminactivitylistpage.invokes.page_login.s.page_AdminActivityListPage_RedirectToLogin.a_redirect.to.page_LoginPage_Init",
          "type": "invokes",
          "from": {"diagramId": "page_adminactivitylistpage", "stateId": "page.AdminActivityListPage.RedirectToLogin"},
          "to": {"diagramId": "page_login", "stateId": "page.LoginPage.Init"},
          "meta": {
            "reason": "redirect | navigate /login",
            "action": "redirect",
            "navigateTarget": "/login",
            "validations": [
              "導向登入頁；登入成功後若 role=admin 才可回到 `/admin/activities`。"
            ]
          }
        },
        {
          "id": "c.page_adminactivitylistpage.invokes.page_adminactivityeditorpage.s.page_AdminActivityListPage_Ready.a_clickCreateActivity.to.page_AdminActivityEditorPage_Loading",
          "type": "invokes",
          "from": {"diagramId": "page_adminactivitylistpage", "stateId": "page.AdminActivityListPage.Ready"},
          "to": {"diagramId": "page_adminactivityeditorpage", "stateId": "page.AdminActivityEditorPage.Loading"},
          "meta": {
            "reason": "clickCreateActivity | navigate /admin/activities/new",
            "action": "clickCreateActivity",
            "navigateTarget": "/admin/activities/new",
            "validations": [
              "導向建立頁；建立頁為 Admin-only；進入 Loading/Editing 後可保存為 draft。"
            ]
          }
        },
        {
          "id": "c.page_adminactivitylistpage.invokes.page_adminactivityeditorpage.s.page_AdminActivityListPage_Ready.a_clickEditActivity.to.page_AdminActivityEditorPage_Loading",
          "type": "invokes",
          "from": {"diagramId": "page_adminactivitylistpage", "stateId": "page.AdminActivityListPage.Ready"},
          "to": {"diagramId": "page_adminactivityeditorpage", "stateId": "page.AdminActivityEditorPage.Loading"},
          "meta": {
            "reason": "clickEditActivity | navigate /admin/activities/:activityId/edit",
            "action": "clickEditActivity",
            "navigateTarget": "/admin/activities/:activityId/edit",
            "validations": [
              "導向編輯頁；若活動不存在回 NotFound；若存在顯示可編輯欄位。"
            ]
          }
        },
        {
          "id": "c.page_adminactivitylistpage.invokes.page_adminregistrationspage.s.page_AdminActivityListPage_Ready.a_clickViewRegistrations.to.page_AdminRegistrationsPage_Loading",
          "type": "invokes",
          "from": {"diagramId": "page_adminactivitylistpage", "stateId": "page.AdminActivityListPage.Ready"},
          "to": {"diagramId": "page_adminregistrationspage", "stateId": "page.AdminRegistrationsPage.Loading"},
          "meta": {
            "reason": "clickViewRegistrations | navigate /admin/activities/:activityId/registrations",
            "action": "clickViewRegistrations",
            "navigateTarget": "/admin/activities/:activityId/registrations",
            "validations": [
              "導向名單頁；可看到姓名/email/報名時間；並能匯出。"
            ]
          }
        },
        {
          "id": "c.page_adminactivitylistpage.invokes.page_activitylistpage.s.page_AdminActivityListPage_Ready.a_clickBackToActivities.to.page_ActivityListPage_Loading",
          "type": "invokes",
          "from": {"diagramId": "page_adminactivitylistpage", "stateId": "page.AdminActivityListPage.Ready"},
          "to": {"diagramId": "page_activitylistpage", "stateId": "page.ActivityListPage.Loading"},
          "meta": {
            "reason": "clickBackToActivities | navigate /activities",
            "action": "clickBackToActivities",
            "navigateTarget": "/activities",
            "validations": [
              "可回到一般列表；一般列表只顯示 published/full，不顯示 draft/closed/archived。"
            ]
          }
        },
        {
          "id": "c.page_adminactivitylistpage.invokes.feature_logout.s.page_AdminActivityListPage_Ready.a_clickLogout.to.feature_Logout_Confirming",
          "type": "invokes",
          "from": {"diagramId": "page_adminactivitylistpage", "stateId": "page.AdminActivityListPage.Ready"},
          "to": {"diagramId": "feature_logout", "stateId": "feature.Logout.Confirming"},
          "meta": {
            "reason": "clickLogout | navigate Feature.Logout",
            "action": "clickLogout",
            "navigateTarget": "Feature.Logout",
            "validations": [
              "Admin 可登出；確認後 session/token 失效；再訪問 `/admin/*` 應導向登入。"
            ]
          }
        }
      ],
      "meta": {
        "pageName": "AdminActivityListPage",
        "featureName": null,
        "entryStateId": "page.AdminActivityListPage.Init",
        "entryValidations": [
          "進入管理後台頁前先做身份與角色檢查；非 Admin 不可見此入口。"
        ]
      }
    },
    {
      "id": "page_adminactivitylistpage_admin",
      "name": "AdminActivityListPage (Admin Delta)",
      "level": "page",
      "parentDiagramId": "page_adminactivitylistpage",
      "roles": ["admin"],
      "variant": {
        "kind": "delta",
        "baseDiagramId": "page_adminactivitylistpage",
        "deltaDiagramIdsByRole": {},
        "appliesToRoles": ["admin"]
      },
      "source": {"type": "mermaid", "sectionTitle": "⑧ AdminActivityListPage.Admin（Admin 視角）", "order": 8},
      "groups": [],
      "states": [
        {
          "id": "page.AdminActivityListPage.admin.Ready",
          "label": "AdminActivityListPage.Ready",
          "type": "normal",
          "groupId": null,
          "tags": ["page", "admin"],
          "meta": {
            "diagramId": "page_adminactivitylistpage_admin",
            "synthetic": false,
            "source": {"scope": "root", "raw": "AdminActivityListPage.Ready"}
          }
        }
      ],
      "transitions": [],
      "connectors": [
        {
          "id": "c.page_adminactivitylistpage_admin.invokes.feature_adminactivity_publish.s.page_AdminActivityListPage_admin_Ready.a_clickPublishFromList.to.feature_AdminActivity_Publish_Submitting",
          "type": "invokes",
          "from": {"diagramId": "page_adminactivitylistpage_admin", "stateId": "page.AdminActivityListPage.admin.Ready"},
          "to": {"diagramId": "feature_adminactivity_publish", "stateId": "feature.AdminActivity.Publish.Submitting"},
          "meta": {
            "reason": "clickPublishFromList | navigate Feature.AdminActivity.Publish",
            "action": "clickPublishFromList",
            "navigateTarget": "Feature.AdminActivity.Publish",
            "validations": [
              "只有活動狀態為 draft 才允許發佈；API 成功後活動 status 變為 published；Audit Log 寫入 ACTIVITY_STATUS_CHANGE。"
            ]
          }
        },
        {
          "id": "c.page_adminactivitylistpage_admin.invokes.feature_adminactivity_close.s.page_AdminActivityListPage_admin_Ready.a_clickCloseFromList.to.feature_AdminActivity_Close_Submitting",
          "type": "invokes",
          "from": {"diagramId": "page_adminactivitylistpage_admin", "stateId": "page.AdminActivityListPage.admin.Ready"},
          "to": {"diagramId": "feature_adminactivity_close", "stateId": "feature.AdminActivity.Close.Submitting"},
          "meta": {
            "reason": "clickCloseFromList | navigate Feature.AdminActivity.Close",
            "action": "clickCloseFromList",
            "navigateTarget": "Feature.AdminActivity.Close",
            "validations": [
              "允許從 published/full 關閉；成功後 status=closed；一般列表不再顯示（因僅顯示 published/full）。"
            ]
          }
        },
        {
          "id": "c.page_adminactivitylistpage_admin.invokes.feature_adminactivity_archive.s.page_AdminActivityListPage_admin_Ready.a_clickArchiveFromList.to.feature_AdminActivity_Archive_Submitting",
          "type": "invokes",
          "from": {"diagramId": "page_adminactivitylistpage_admin", "stateId": "page.AdminActivityListPage.admin.Ready"},
          "to": {"diagramId": "feature_adminactivity_archive", "stateId": "feature.AdminActivity.Archive.Submitting"},
          "meta": {
            "reason": "clickArchiveFromList | navigate Feature.AdminActivity.Archive",
            "action": "clickArchiveFromList",
            "navigateTarget": "Feature.AdminActivity.Archive",
            "validations": [
              "允許從 draft/closed 下架；成功後 status=archived；一般列表與一般詳情不可再存取（404）。"
            ]
          }
        }
      ],
      "meta": {"pageName": "AdminActivityListPage", "featureName": null, "entryStateId": null}
    },
    {
      "id": "page_adminactivityeditorpage",
      "name": "Admin Activity Editor Page",
      "level": "page",
      "parentDiagramId": "page_entry",
      "roles": [],
      "variant": {
        "kind": "standalone",
        "baseDiagramId": null,
        "deltaDiagramIdsByRole": {},
        "appliesToRoles": []
      },
      "source": {"type": "mermaid", "sectionTitle": "⑨ AdminActivityEditorPage Page", "order": 9},
      "groups": [],
      "states": [
        {
          "id": "page.AdminActivityEditorPage.Init",
          "label": "AdminActivityEditorPage.Init",
          "type": "start",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_adminactivityeditorpage",
            "synthetic": false,
            "source": {"scope": "root", "raw": "AdminActivityEditorPage.Init"}
          }
        },
        {
          "id": "page.AdminActivityEditorPage.AuthzGuard",
          "label": "AdminActivityEditorPage.AuthzGuard",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_adminactivityeditorpage",
            "synthetic": false,
            "source": {"scope": "root", "raw": "AdminActivityEditorPage.AuthzGuard"}
          }
        },
        {
          "id": "page.AdminActivityEditorPage.RedirectToLogin",
          "label": "AdminActivityEditorPage.RedirectToLogin",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_adminactivityeditorpage",
            "synthetic": false,
            "source": {"scope": "root", "raw": "AdminActivityEditorPage.RedirectToLogin"}
          }
        },
        {
          "id": "page.AdminActivityEditorPage.Forbidden",
          "label": "AdminActivityEditorPage.Forbidden",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_adminactivityeditorpage",
            "synthetic": false,
            "source": {"scope": "root", "raw": "AdminActivityEditorPage.Forbidden"}
          }
        },
        {
          "id": "page.AdminActivityEditorPage.Loading",
          "label": "AdminActivityEditorPage.Loading",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_adminactivityeditorpage",
            "synthetic": false,
            "source": {"scope": "root", "raw": "AdminActivityEditorPage.Loading"}
          }
        },
        {
          "id": "page.AdminActivityEditorPage.Editing",
          "label": "AdminActivityEditorPage.Editing",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_adminactivityeditorpage",
            "synthetic": false,
            "source": {"scope": "root", "raw": "AdminActivityEditorPage.Editing"}
          }
        },
        {
          "id": "page.AdminActivityEditorPage.NotFound",
          "label": "AdminActivityEditorPage.NotFound",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_adminactivityeditorpage",
            "synthetic": false,
            "source": {"scope": "root", "raw": "AdminActivityEditorPage.NotFound"}
          }
        },
        {
          "id": "page.AdminActivityEditorPage.Error",
          "label": "AdminActivityEditorPage.Error",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_adminactivityeditorpage",
            "synthetic": false,
            "source": {"scope": "root", "raw": "AdminActivityEditorPage.Error"}
          }
        }
      ],
      "transitions": [
        {
          "id": "t.page_adminactivityeditorpage.0001",
          "from": "page.AdminActivityEditorPage.Init",
          "to": "page.AdminActivityEditorPage.AuthzGuard",
          "event": "checkAdminRole",
          "roles": [],
          "validations": [
            "角色檢查必須同時存在於前端路由守衛與後端 API；避免直接呼叫管理 API。"
          ],
          "intent": {"category": "action", "summary": "checkAdminRole"},
          "meta": {
            "diagramId": "page_adminactivityeditorpage",
            "source": {"raw": "AdminActivityEditorPage.Init --> AdminActivityEditorPage.AuthzGuard : checkAdminRole"}
          }
        },
        {
          "id": "t.page_adminactivityeditorpage.0002",
          "from": "page.AdminActivityEditorPage.AuthzGuard",
          "to": "page.AdminActivityEditorPage.RedirectToLogin",
          "event": "notLoggedIn",
          "roles": [],
          "validations": [
            "Guest 需導向 `/login` 並保留 returnTo；後端回 401。"
          ],
          "intent": {"category": "action", "summary": "notLoggedIn"},
          "meta": {
            "diagramId": "page_adminactivityeditorpage",
            "source": {"raw": "AdminActivityEditorPage.AuthzGuard --> AdminActivityEditorPage.RedirectToLogin : notLoggedIn"}
          }
        },
        {
          "id": "t.page_adminactivityeditorpage.0003",
          "from": "page.AdminActivityEditorPage.AuthzGuard",
          "to": "page.AdminActivityEditorPage.Forbidden",
          "event": "loggedInButNotAdmin",
          "roles": [],
          "validations": [
            "Member 強行進入顯示 403；不得顯示編輯表單內容。"
          ],
          "intent": {"category": "action", "summary": "loggedInButNotAdmin"},
          "meta": {
            "diagramId": "page_adminactivityeditorpage",
            "source": {"raw": "AdminActivityEditorPage.AuthzGuard --> AdminActivityEditorPage.Forbidden : loggedInButNotAdmin"}
          }
        },
        {
          "id": "t.page_adminactivityeditorpage.0004",
          "from": "page.AdminActivityEditorPage.AuthzGuard",
          "to": "page.AdminActivityEditorPage.Loading",
          "event": "isAdmin",
          "roles": [],
          "validations": [
            "Admin 進入 Loading；若為 edit 路由則抓取活動資料；若為 new 路由則建立空表單（預設 draft）。"
          ],
          "intent": {"category": "action", "summary": "isAdmin"},
          "meta": {
            "diagramId": "page_adminactivityeditorpage",
            "source": {"raw": "AdminActivityEditorPage.AuthzGuard --> AdminActivityEditorPage.Loading : isAdmin"}
          }
        },
        {
          "id": "t.page_adminactivityeditorpage.0005",
          "from": "page.AdminActivityEditorPage.Loading",
          "to": "page.AdminActivityEditorPage.Editing",
          "event": "fetchSuccessOrNewDraft",
          "roles": [],
          "validations": [
            "UI 顯示欄位（title/description/date/location/deadline/capacity）；需驗證 date>deadline、capacity 正整數。"
          ],
          "intent": {"category": "action", "summary": "fetchSuccessOrNewDraft"},
          "meta": {
            "diagramId": "page_adminactivityeditorpage",
            "source": {"raw": "AdminActivityEditorPage.Loading --> AdminActivityEditorPage.Editing : fetchSuccessOrNewDraft"}
          }
        },
        {
          "id": "t.page_adminactivityeditorpage.0006",
          "from": "page.AdminActivityEditorPage.Loading",
          "to": "page.AdminActivityEditorPage.NotFound",
          "event": "fetchNotFound",
          "roles": [],
          "validations": [
            "活動不存在時顯示 not found；提供回到 `/admin/activities`。"
          ],
          "intent": {"category": "action", "summary": "fetchNotFound"},
          "meta": {
            "diagramId": "page_adminactivityeditorpage",
            "source": {"raw": "AdminActivityEditorPage.Loading --> AdminActivityEditorPage.NotFound : fetchNotFound"}
          }
        },
        {
          "id": "t.page_adminactivityeditorpage.0007",
          "from": "page.AdminActivityEditorPage.Loading",
          "to": "page.AdminActivityEditorPage.Error",
          "event": "fetchFailed",
          "roles": [],
          "validations": [
            "顯示 error + retry；不顯示過期資料。"
          ],
          "intent": {"category": "action", "summary": "fetchFailed"},
          "meta": {
            "diagramId": "page_adminactivityeditorpage",
            "source": {"raw": "AdminActivityEditorPage.Loading --> AdminActivityEditorPage.Error : fetchFailed"}
          }
        },
        {
          "id": "t.page_adminactivityeditorpage.0008",
          "from": "page.AdminActivityEditorPage.Error",
          "to": "page.AdminActivityEditorPage.Loading",
          "event": "retryFetch",
          "roles": [],
          "validations": [
            "retry 重新抓取；成功後進 Editing/NotFound。"
          ],
          "intent": {"category": "action", "summary": "retryFetch"},
          "meta": {
            "diagramId": "page_adminactivityeditorpage",
            "source": {"raw": "AdminActivityEditorPage.Error --> AdminActivityEditorPage.Loading : retryFetch"}
          }
        }
      ],
      "connectors": [
        {
          "id": "c.page_entry.contains.page_adminactivityeditorpage",
          "type": "contains",
          "from": {"diagramId": "page_entry", "stateId": null},
          "to": {"diagramId": "page_adminactivityeditorpage", "stateId": null},
          "meta": {"reason": "derived from parentDiagramId"}
        },
        {
          "id": "c.page_adminactivityeditorpage.invokes.page_login.s.page_AdminActivityEditorPage_RedirectToLogin.a_redirect.to.page_LoginPage_Init",
          "type": "invokes",
          "from": {"diagramId": "page_adminactivityeditorpage", "stateId": "page.AdminActivityEditorPage.RedirectToLogin"},
          "to": {"diagramId": "page_login", "stateId": "page.LoginPage.Init"},
          "meta": {
            "reason": "redirect | navigate /login",
            "action": "redirect",
            "navigateTarget": "/login",
            "validations": [
              "導向登入頁；需保留 returnTo=/admin/activities/:activityId/edit 或 /admin/activities/new。"
            ]
          }
        },
        {
          "id": "c.page_adminactivityeditorpage.invokes.feature_adminactivity_save.s.page_AdminActivityEditorPage_Editing.a_clickSaveDraftOrUpdate.to.feature_AdminActivity_Save_Submitting",
          "type": "invokes",
          "from": {"diagramId": "page_adminactivityeditorpage", "stateId": "page.AdminActivityEditorPage.Editing"},
          "to": {"diagramId": "feature_adminactivity_save", "stateId": "feature.AdminActivity.Save.Submitting"},
          "meta": {
            "reason": "clickSaveDraftOrUpdate | navigate Feature.AdminActivity.Save",
            "action": "clickSaveDraftOrUpdate",
            "navigateTarget": "Feature.AdminActivity.Save",
            "validations": [
              "保存 draft 或更新活動內容；成功後停留在編輯頁並顯示成功提示。"
            ]
          }
        },
        {
          "id": "c.page_adminactivityeditorpage.invokes.feature_adminactivity_publish.s.page_AdminActivityEditorPage_Editing.a_clickPublish.to.feature_AdminActivity_Publish_Submitting",
          "type": "invokes",
          "from": {"diagramId": "page_adminactivityeditorpage", "stateId": "page.AdminActivityEditorPage.Editing"},
          "to": {"diagramId": "feature_adminactivity_publish", "stateId": "feature.AdminActivity.Publish.Submitting"},
          "meta": {
            "reason": "clickPublish | navigate Feature.AdminActivity.Publish",
            "action": "clickPublish",
            "navigateTarget": "Feature.AdminActivity.Publish",
            "validations": [
              "Publish 需通過欄位驗證與權限檢查；成功後回到管理列表並顯示已發佈。"
            ]
          }
        },
        {
          "id": "c.page_adminactivityeditorpage.invokes.feature_adminactivity_archive.s.page_AdminActivityEditorPage_Editing.a_clickArchive.to.feature_AdminActivity_Archive_Submitting",
          "type": "invokes",
          "from": {"diagramId": "page_adminactivityeditorpage", "stateId": "page.AdminActivityEditorPage.Editing"},
          "to": {"diagramId": "feature_adminactivity_archive", "stateId": "feature.AdminActivity.Archive.Submitting"},
          "meta": {
            "reason": "clickArchive | navigate Feature.AdminActivity.Archive",
            "action": "clickArchive",
            "navigateTarget": "Feature.AdminActivity.Archive",
            "validations": [
              "Archive 後該活動不應再在一般列表/詳情可見；管理列表可看到 archived。"
            ]
          }
        },
        {
          "id": "c.page_adminactivityeditorpage.invokes.page_adminactivitylistpage.s.page_AdminActivityEditorPage_Editing.a_clickBackToAdminList.to.page_AdminActivityListPage_Loading",
          "type": "invokes",
          "from": {"diagramId": "page_adminactivityeditorpage", "stateId": "page.AdminActivityEditorPage.Editing"},
          "to": {"diagramId": "page_adminactivitylistpage", "stateId": "page.AdminActivityListPage.Loading"},
          "meta": {
            "reason": "clickBackToAdminList | navigate /admin/activities",
            "action": "clickBackToAdminList",
            "navigateTarget": "/admin/activities",
            "validations": [
              "回到管理列表；列表需重新載入以反映 draft/published/closed/archived 變化。"
            ]
          }
        }
      ],
      "meta": {
        "pageName": "AdminActivityEditorPage",
        "featureName": null,
        "entryStateId": "page.AdminActivityEditorPage.Init",
        "entryValidations": [
          "進入編輯器頁會先做 Admin 權限檢查；Member 不可進入。"
        ]
      }
    },
    {
      "id": "page_adminregistrationspage",
      "name": "Admin Registrations Page",
      "level": "page",
      "parentDiagramId": "page_entry",
      "roles": [],
      "variant": {
        "kind": "standalone",
        "baseDiagramId": null,
        "deltaDiagramIdsByRole": {},
        "appliesToRoles": []
      },
      "source": {"type": "mermaid", "sectionTitle": "⑩ AdminRegistrationsPage Page", "order": 10},
      "groups": [],
      "states": [
        {
          "id": "page.AdminRegistrationsPage.Init",
          "label": "AdminRegistrationsPage.Init",
          "type": "start",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_adminregistrationspage",
            "synthetic": false,
            "source": {"scope": "root", "raw": "AdminRegistrationsPage.Init"}
          }
        },
        {
          "id": "page.AdminRegistrationsPage.AuthzGuard",
          "label": "AdminRegistrationsPage.AuthzGuard",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_adminregistrationspage",
            "synthetic": false,
            "source": {"scope": "root", "raw": "AdminRegistrationsPage.AuthzGuard"}
          }
        },
        {
          "id": "page.AdminRegistrationsPage.RedirectToLogin",
          "label": "AdminRegistrationsPage.RedirectToLogin",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_adminregistrationspage",
            "synthetic": false,
            "source": {"scope": "root", "raw": "AdminRegistrationsPage.RedirectToLogin"}
          }
        },
        {
          "id": "page.AdminRegistrationsPage.Forbidden",
          "label": "AdminRegistrationsPage.Forbidden",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_adminregistrationspage",
            "synthetic": false,
            "source": {"scope": "root", "raw": "AdminRegistrationsPage.Forbidden"}
          }
        },
        {
          "id": "page.AdminRegistrationsPage.Loading",
          "label": "AdminRegistrationsPage.Loading",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_adminregistrationspage",
            "synthetic": false,
            "source": {"scope": "root", "raw": "AdminRegistrationsPage.Loading"}
          }
        },
        {
          "id": "page.AdminRegistrationsPage.Ready",
          "label": "AdminRegistrationsPage.Ready",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_adminregistrationspage",
            "synthetic": false,
            "source": {"scope": "root", "raw": "AdminRegistrationsPage.Ready"}
          }
        },
        {
          "id": "page.AdminRegistrationsPage.NotFound",
          "label": "AdminRegistrationsPage.NotFound",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_adminregistrationspage",
            "synthetic": false,
            "source": {"scope": "root", "raw": "AdminRegistrationsPage.NotFound"}
          }
        },
        {
          "id": "page.AdminRegistrationsPage.Error",
          "label": "AdminRegistrationsPage.Error",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_adminregistrationspage",
            "synthetic": false,
            "source": {"scope": "root", "raw": "AdminRegistrationsPage.Error"}
          }
        }
      ],
      "transitions": [
        {
          "id": "t.page_adminregistrationspage.0001",
          "from": "page.AdminRegistrationsPage.Init",
          "to": "page.AdminRegistrationsPage.AuthzGuard",
          "event": "checkAdminRole",
          "roles": [],
          "validations": [
            "後端名單 API 必須檢查 role=admin；Member 直接呼叫需回 403。"
          ],
          "intent": {"category": "action", "summary": "checkAdminRole"},
          "meta": {
            "diagramId": "page_adminregistrationspage",
            "source": {"raw": "AdminRegistrationsPage.Init --> AdminRegistrationsPage.AuthzGuard : checkAdminRole"}
          }
        },
        {
          "id": "t.page_adminregistrationspage.0002",
          "from": "page.AdminRegistrationsPage.AuthzGuard",
          "to": "page.AdminRegistrationsPage.RedirectToLogin",
          "event": "notLoggedIn",
          "roles": [],
          "validations": [
            "Guest 需導向登入並保留 returnTo；後端回 401。"
          ],
          "intent": {"category": "action", "summary": "notLoggedIn"},
          "meta": {
            "diagramId": "page_adminregistrationspage",
            "source": {"raw": "AdminRegistrationsPage.AuthzGuard --> AdminRegistrationsPage.RedirectToLogin : notLoggedIn"}
          }
        },
        {
          "id": "t.page_adminregistrationspage.0003",
          "from": "page.AdminRegistrationsPage.AuthzGuard",
          "to": "page.AdminRegistrationsPage.Forbidden",
          "event": "loggedInButNotAdmin",
          "roles": [],
          "validations": [
            "Member 顯示 403；不得顯示名單內容。"
          ],
          "intent": {"category": "action", "summary": "loggedInButNotAdmin"},
          "meta": {
            "diagramId": "page_adminregistrationspage",
            "source": {"raw": "AdminRegistrationsPage.AuthzGuard --> AdminRegistrationsPage.Forbidden : loggedInButNotAdmin"}
          }
        },
        {
          "id": "t.page_adminregistrationspage.0004",
          "from": "page.AdminRegistrationsPage.AuthzGuard",
          "to": "page.AdminRegistrationsPage.Loading",
          "event": "isAdmin",
          "roles": [],
          "validations": [
            "Admin 進入 Loading 並呼叫名單 API；回傳欄位包含姓名/email/created_at。"
          ],
          "intent": {"category": "action", "summary": "isAdmin"},
          "meta": {
            "diagramId": "page_adminregistrationspage",
            "source": {"raw": "AdminRegistrationsPage.AuthzGuard --> AdminRegistrationsPage.Loading : isAdmin"}
          }
        },
        {
          "id": "t.page_adminregistrationspage.0005",
          "from": "page.AdminRegistrationsPage.Loading",
          "to": "page.AdminRegistrationsPage.Ready",
          "event": "fetchSuccess(hasItemsOrEmptyAllowed)",
          "roles": [],
          "validations": [
            "UI 顯示名單（可為空）；顯示 registered_count/capacity 一致；不因名單空而視為錯誤。"
          ],
          "intent": {"category": "action", "summary": "fetchSuccess(hasItemsOrEmptyAllowed)"},
          "meta": {
            "diagramId": "page_adminregistrationspage",
            "source": {"raw": "AdminRegistrationsPage.Loading --> AdminRegistrationsPage.Ready : fetchSuccess(hasItemsOrEmptyAllowed)"}
          }
        },
        {
          "id": "t.page_adminregistrationspage.0006",
          "from": "page.AdminRegistrationsPage.Loading",
          "to": "page.AdminRegistrationsPage.NotFound",
          "event": "fetchNotFound",
          "roles": [],
          "validations": [
            "活動不存在時顯示 not found；提供回管理列表。"
          ],
          "intent": {"category": "action", "summary": "fetchNotFound"},
          "meta": {
            "diagramId": "page_adminregistrationspage",
            "source": {"raw": "AdminRegistrationsPage.Loading --> AdminRegistrationsPage.NotFound : fetchNotFound"}
          }
        },
        {
          "id": "t.page_adminregistrationspage.0007",
          "from": "page.AdminRegistrationsPage.Loading",
          "to": "page.AdminRegistrationsPage.Error",
          "event": "fetchFailed",
          "roles": [],
          "validations": [
            "顯示 error + retry；不顯示過期名單。"
          ],
          "intent": {"category": "action", "summary": "fetchFailed"},
          "meta": {
            "diagramId": "page_adminregistrationspage",
            "source": {"raw": "AdminRegistrationsPage.Loading --> AdminRegistrationsPage.Error : fetchFailed"}
          }
        },
        {
          "id": "t.page_adminregistrationspage.0008",
          "from": "page.AdminRegistrationsPage.Error",
          "to": "page.AdminRegistrationsPage.Loading",
          "event": "retryFetch",
          "roles": [],
          "validations": [
            "retry 重新抓取名單；成功後進 Ready/NotFound。"
          ],
          "intent": {"category": "action", "summary": "retryFetch"},
          "meta": {
            "diagramId": "page_adminregistrationspage",
            "source": {"raw": "AdminRegistrationsPage.Error --> AdminRegistrationsPage.Loading : retryFetch"}
          }
        }
      ],
      "connectors": [
        {
          "id": "c.page_entry.contains.page_adminregistrationspage",
          "type": "contains",
          "from": {"diagramId": "page_entry", "stateId": null},
          "to": {"diagramId": "page_adminregistrationspage", "stateId": null},
          "meta": {"reason": "derived from parentDiagramId"}
        },
        {
          "id": "c.page_adminregistrationspage.invokes.page_login.s.page_AdminRegistrationsPage_RedirectToLogin.a_redirect.to.page_LoginPage_Init",
          "type": "invokes",
          "from": {"diagramId": "page_adminregistrationspage", "stateId": "page.AdminRegistrationsPage.RedirectToLogin"},
          "to": {"diagramId": "page_login", "stateId": "page.LoginPage.Init"},
          "meta": {
            "reason": "redirect | navigate /login",
            "action": "redirect",
            "navigateTarget": "/login",
            "validations": [
              "導向登入頁並保留 returnTo=/admin/activities/:activityId/registrations。"
            ]
          }
        },
        {
          "id": "c.page_adminregistrationspage.invokes.feature_adminregistrations_exportcsv.s.page_AdminRegistrationsPage_Ready.a_clickExportCsv.to.feature_AdminRegistrations_ExportCsv_Submitting",
          "type": "invokes",
          "from": {"diagramId": "page_adminregistrationspage", "stateId": "page.AdminRegistrationsPage.Ready"},
          "to": {"diagramId": "feature_adminregistrations_exportcsv", "stateId": "feature.AdminRegistrations.ExportCsv.Submitting"},
          "meta": {
            "reason": "clickExportCsv | navigate Feature.AdminRegistrations.ExportCsv",
            "action": "clickExportCsv",
            "navigateTarget": "Feature.AdminRegistrations.ExportCsv",
            "validations": [
              "匯出 CSV 需包含 name/email/registeredAt；欄位順序與檔名規則一致。"
            ]
          }
        },
        {
          "id": "c.page_adminregistrationspage.invokes.page_adminactivitylistpage.s.page_AdminRegistrationsPage_Ready.a_clickBackToAdminList.to.page_AdminActivityListPage_Loading",
          "type": "invokes",
          "from": {"diagramId": "page_adminregistrationspage", "stateId": "page.AdminRegistrationsPage.Ready"},
          "to": {"diagramId": "page_adminactivitylistpage", "stateId": "page.AdminActivityListPage.Loading"},
          "meta": {
            "reason": "clickBackToAdminList | navigate /admin/activities",
            "action": "clickBackToAdminList",
            "navigateTarget": "/admin/activities",
            "validations": [
              "回到管理列表；列表需可看到 draft/published/full/closed/archived。"
            ]
          }
        },
        {
          "id": "c.page_adminregistrationspage.invokes.page_adminactivityeditorpage.s.page_AdminRegistrationsPage_Ready.a_clickGoEditActivity.to.page_AdminActivityEditorPage_Loading",
          "type": "invokes",
          "from": {"diagramId": "page_adminregistrationspage", "stateId": "page.AdminRegistrationsPage.Ready"},
          "to": {"diagramId": "page_adminactivityeditorpage", "stateId": "page.AdminActivityEditorPage.Loading"},
          "meta": {
            "reason": "clickGoEditActivity | navigate /admin/activities/:activityId/edit",
            "action": "clickGoEditActivity",
            "navigateTarget": "/admin/activities/:activityId/edit",
            "validations": [
              "導向活動編輯頁；編輯頁需可回名單頁或管理列表。"
            ]
          }
        }
      ],
      "meta": {
        "pageName": "AdminRegistrationsPage",
        "featureName": null,
        "entryStateId": "page.AdminRegistrationsPage.Init",
        "entryValidations": [
          "進入名單頁先做 Admin 檢查；只有 Admin 可查看姓名/email/報名時間。"
        ]
      }
    },
    {
      "id": "feature_login",
      "name": "Feature: Login",
      "level": "feature",
      "parentDiagramId": "page_entry",
      "roles": [],
      "variant": {
        "kind": "standalone",
        "baseDiagramId": null,
        "deltaDiagramIdsByRole": {},
        "appliesToRoles": []
      },
      "source": {"type": "mermaid", "sectionTitle": "⑪ Feature: Login", "order": 11},
      "groups": [],
      "states": [
        {
          "id": "feature.Login.Idle",
          "label": "Feature.Login.Idle",
          "type": "start",
          "groupId": null,
          "tags": ["feature"],
          "meta": {
            "diagramId": "feature_login",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.Login.Idle"}
          }
        },
        {
          "id": "feature.Login.Validating",
          "label": "Feature.Login.Validating",
          "type": "normal",
          "groupId": null,
          "tags": ["feature"],
          "meta": {
            "diagramId": "feature_login",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.Login.Validating"}
          }
        },
        {
          "id": "feature.Login.Submitting",
          "label": "Feature.Login.Submitting",
          "type": "normal",
          "groupId": null,
          "tags": ["feature"],
          "meta": {
            "diagramId": "feature_login",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.Login.Submitting"}
          }
        },
        {
          "id": "feature.Login.Succeeded",
          "label": "Feature.Login.Succeeded",
          "type": "normal",
          "groupId": null,
          "tags": ["feature"],
          "meta": {
            "diagramId": "feature_login",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.Login.Succeeded"}
          }
        },
        {
          "id": "feature.Login.Failed",
          "label": "Feature.Login.Failed",
          "type": "normal",
          "groupId": null,
          "tags": ["feature"],
          "meta": {
            "diagramId": "feature_login",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.Login.Failed"}
          }
        }
      ],
      "transitions": [
        {
          "id": "t.feature_login.0001",
          "from": "feature.Login.Idle",
          "to": "feature.Login.Validating",
          "event": "validateInput",
          "roles": [],
          "validations": [
            "前端檢查 email 格式與必填；password 必填；不通過則不送 API。"
          ],
          "intent": {"category": "action", "summary": "validateInput"},
          "meta": {
            "diagramId": "feature_login",
            "source": {"raw": "Feature.Login.Idle --> Feature.Login.Validating : validateInput"}
          }
        },
        {
          "id": "t.feature_login.0002",
          "from": "feature.Login.Validating",
          "to": "feature.Login.Submitting",
          "event": "valid",
          "roles": [],
          "validations": [
            "通過驗證後送出登入 API；UI 進入 submitting 並禁用送出。"
          ],
          "intent": {"category": "action", "summary": "valid"},
          "meta": {
            "diagramId": "feature_login",
            "source": {"raw": "Feature.Login.Validating --> Feature.Login.Submitting : valid"}
          }
        },
        {
          "id": "t.feature_login.0003",
          "from": "feature.Login.Validating",
          "to": "feature.Login.Failed",
          "event": "invalid",
          "roles": [],
          "validations": [
            "顯示欄位錯誤（必填/格式）；不呼叫登入 API。"
          ],
          "intent": {"category": "action", "summary": "invalid"},
          "meta": {
            "diagramId": "feature_login",
            "source": {"raw": "Feature.Login.Validating --> Feature.Login.Failed : invalid"}
          }
        },
        {
          "id": "t.feature_login.0004",
          "from": "feature.Login.Submitting",
          "to": "feature.Login.Succeeded",
          "event": "apiSuccess(sessionIssued)",
          "roles": [],
          "validations": [
            "API 回 200；session/token 可用；回傳資料不含敏感密碼資訊；Header 依 role 更新。"
          ],
          "intent": {"category": "action", "summary": "apiSuccess(sessionIssued)"},
          "meta": {
            "diagramId": "feature_login",
            "source": {"raw": "Feature.Login.Submitting --> Feature.Login.Succeeded : apiSuccess(sessionIssued)"}
          }
        },
        {
          "id": "t.feature_login.0005",
          "from": "feature.Login.Submitting",
          "to": "feature.Login.Failed",
          "event": "apiFailed",
          "roles": [],
          "validations": [
            "API 回 400/401（依後端設計）；錯誤訊息一致不洩漏帳號是否存在；UI 回到可編輯狀態。"
          ],
          "intent": {"category": "action", "summary": "apiFailed"},
          "meta": {
            "diagramId": "feature_login",
            "source": {"raw": "Feature.Login.Submitting --> Feature.Login.Failed : apiFailed"}
          }
        }
      ],
      "connectors": [
        {
          "id": "c.page_entry.contains.feature_login",
          "type": "contains",
          "from": {"diagramId": "page_entry", "stateId": null},
          "to": {"diagramId": "feature_login", "stateId": null},
          "meta": {"reason": "derived from parentDiagramId"}
        },
        {
          "id": "c.feature_login.invokes.page_activitylistpage.s.feature_Login_Succeeded.a_navigateAfterLogin.to.page_ActivityListPage_Loading",
          "type": "invokes",
          "from": {"diagramId": "feature_login", "stateId": "feature.Login.Succeeded"},
          "to": {"diagramId": "page_activitylistpage", "stateId": "page.ActivityListPage.Loading"},
          "meta": {
            "reason": "navigateAfterLogin | navigate /activities",
            "action": "navigateAfterLogin",
            "navigateTarget": "/activities",
            "validations": [
              "登入成功後導向列表；Header 需顯示正確 role 導覽；API 需帶上有效 token/session。"
            ]
          }
        },
        {
          "id": "c.feature_login.invokes.page_login.s.feature_Login_Failed.a_backToForm.to.page_LoginPage_Editing",
          "type": "invokes",
          "from": {"diagramId": "feature_login", "stateId": "feature.Login.Failed"},
          "to": {"diagramId": "page_login", "stateId": "page.LoginPage.Editing"},
          "meta": {
            "reason": "backToForm | navigate /login",
            "action": "backToForm",
            "navigateTarget": "/login",
            "validations": [
              "回登入表單並顯示錯誤訊息；不得重複送出；不得洩漏帳號是否存在。"
            ]
          }
        }
      ],
      "meta": {
        "pageName": null,
        "featureName": "Login",
        "entryStateId": "feature.Login.Idle",
        "entryValidations": [
          "進入登入功能狀態；尚未送出 API 前不得顯示成功。"
        ]
      }
    },
    {
      "id": "feature_register",
      "name": "Feature: Register",
      "level": "feature",
      "parentDiagramId": "page_entry",
      "roles": [],
      "variant": {
        "kind": "standalone",
        "baseDiagramId": null,
        "deltaDiagramIdsByRole": {},
        "appliesToRoles": []
      },
      "source": {"type": "mermaid", "sectionTitle": "⑫ Feature: Register", "order": 12},
      "groups": [],
      "states": [
        {
          "id": "feature.Register.Idle",
          "label": "Feature.Register.Idle",
          "type": "start",
          "groupId": null,
          "tags": ["feature"],
          "meta": {
            "diagramId": "feature_register",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.Register.Idle"}
          }
        },
        {
          "id": "feature.Register.Validating",
          "label": "Feature.Register.Validating",
          "type": "normal",
          "groupId": null,
          "tags": ["feature"],
          "meta": {
            "diagramId": "feature_register",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.Register.Validating"}
          }
        },
        {
          "id": "feature.Register.Submitting",
          "label": "Feature.Register.Submitting",
          "type": "normal",
          "groupId": null,
          "tags": ["feature"],
          "meta": {
            "diagramId": "feature_register",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.Register.Submitting"}
          }
        },
        {
          "id": "feature.Register.Succeeded",
          "label": "Feature.Register.Succeeded",
          "type": "normal",
          "groupId": null,
          "tags": ["feature"],
          "meta": {
            "diagramId": "feature_register",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.Register.Succeeded"}
          }
        },
        {
          "id": "feature.Register.Failed",
          "label": "Feature.Register.Failed",
          "type": "normal",
          "groupId": null,
          "tags": ["feature"],
          "meta": {
            "diagramId": "feature_register",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.Register.Failed"}
          }
        }
      ],
      "transitions": [
        {
          "id": "t.feature_register.0001",
          "from": "feature.Register.Idle",
          "to": "feature.Register.Validating",
          "event": "validateInput",
          "roles": [],
          "validations": [
            "前端檢查 name/email/password 必填與格式；不通過不得送 API。"
          ],
          "intent": {"category": "action", "summary": "validateInput"},
          "meta": {
            "diagramId": "feature_register",
            "source": {"raw": "Feature.Register.Idle --> Feature.Register.Validating : validateInput"}
          }
        },
        {
          "id": "t.feature_register.0002",
          "from": "feature.Register.Validating",
          "to": "feature.Register.Submitting",
          "event": "valid",
          "roles": [],
          "validations": [
            "送出註冊 API；UI 顯示 submitting/loading。"
          ],
          "intent": {"category": "action", "summary": "valid"},
          "meta": {
            "diagramId": "feature_register",
            "source": {"raw": "Feature.Register.Validating --> Feature.Register.Submitting : valid"}
          }
        },
        {
          "id": "t.feature_register.0003",
          "from": "feature.Register.Validating",
          "to": "feature.Register.Failed",
          "event": "invalid",
          "roles": [],
          "validations": [
            "顯示欄位錯誤；不呼叫註冊 API。"
          ],
          "intent": {"category": "action", "summary": "invalid"},
          "meta": {
            "diagramId": "feature_register",
            "source": {"raw": "Feature.Register.Validating --> Feature.Register.Failed : invalid"}
          }
        },
        {
          "id": "t.feature_register.0004",
          "from": "feature.Register.Submitting",
          "to": "feature.Register.Succeeded",
          "event": "apiSuccess(userCreated)",
          "roles": [],
          "validations": [
            "API 回 201/200（依後端設計）；email 唯一性保證；password_hash 以安全雜湊儲存（不回傳明文）。"
          ],
          "intent": {"category": "action", "summary": "apiSuccess(userCreated)"},
          "meta": {
            "diagramId": "feature_register",
            "source": {"raw": "Feature.Register.Submitting --> Feature.Register.Succeeded : apiSuccess(userCreated)"}
          }
        },
        {
          "id": "t.feature_register.0005",
          "from": "feature.Register.Submitting",
          "to": "feature.Register.Failed",
          "event": "apiFailed",
          "roles": [],
          "validations": [
            "API 回 400（欄位錯誤）或 409（email 已存在）；UI 顯示可理解訊息。"
          ],
          "intent": {"category": "action", "summary": "apiFailed"},
          "meta": {
            "diagramId": "feature_register",
            "source": {"raw": "Feature.Register.Submitting --> Feature.Register.Failed : apiFailed"}
          }
        }
      ],
      "connectors": [
        {
          "id": "c.page_entry.contains.feature_register",
          "type": "contains",
          "from": {"diagramId": "page_entry", "stateId": null},
          "to": {"diagramId": "feature_register", "stateId": null},
          "meta": {"reason": "derived from parentDiagramId"}
        },
        {
          "id": "c.feature_register.invokes.page_activitylistpage.s.feature_Register_Succeeded.a_navigateAfterRegister.to.page_ActivityListPage_Loading",
          "type": "invokes",
          "from": {"diagramId": "feature_register", "stateId": "feature.Register.Succeeded"},
          "to": {"diagramId": "page_activitylistpage", "stateId": "page.ActivityListPage.Loading"},
          "meta": {
            "reason": "navigateAfterRegister | navigate /activities",
            "action": "navigateAfterRegister",
            "navigateTarget": "/activities",
            "validations": [
              "註冊成功後導向列表；可能需要自動登入或建立 session；Header 更新。"
            ]
          }
        },
        {
          "id": "c.feature_register.invokes.page_register.s.feature_Register_Failed.a_backToForm.to.page_RegisterPage_Editing",
          "type": "invokes",
          "from": {"diagramId": "feature_register", "stateId": "feature.Register.Failed"},
          "to": {"diagramId": "page_register", "stateId": "page.RegisterPage.Editing"},
          "meta": {
            "reason": "backToForm | navigate /register",
            "action": "backToForm",
            "navigateTarget": "/register",
            "validations": [
              "回註冊表單並顯示錯誤（email 已存在或欄位錯誤）；不得重複建立帳號。"
            ]
          }
        }
      ],
      "meta": {
        "pageName": null,
        "featureName": "Register",
        "entryStateId": "feature.Register.Idle",
        "entryValidations": [
          "進入註冊功能狀態。"
        ]
      }
    },
    {
      "id": "feature_logout",
      "name": "Feature: Logout",
      "level": "feature",
      "parentDiagramId": "page_entry",
      "roles": [],
      "variant": {
        "kind": "standalone",
        "baseDiagramId": null,
        "deltaDiagramIdsByRole": {},
        "appliesToRoles": []
      },
      "source": {"type": "mermaid", "sectionTitle": "⑬ Feature: Logout", "order": 13},
      "groups": [],
      "states": [
        {
          "id": "feature.Logout.Confirming",
          "label": "Feature.Logout.Confirming",
          "type": "start",
          "groupId": null,
          "tags": ["feature"],
          "meta": {
            "diagramId": "feature_logout",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.Logout.Confirming"}
          }
        },
        {
          "id": "feature.Logout.Submitting",
          "label": "Feature.Logout.Submitting",
          "type": "normal",
          "groupId": null,
          "tags": ["feature"],
          "meta": {
            "diagramId": "feature_logout",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.Logout.Submitting"}
          }
        },
        {
          "id": "feature.Logout.Succeeded",
          "label": "Feature.Logout.Succeeded",
          "type": "normal",
          "groupId": null,
          "tags": ["feature"],
          "meta": {
            "diagramId": "feature_logout",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.Logout.Succeeded"}
          }
        },
        {
          "id": "feature.Logout.Failed",
          "label": "Feature.Logout.Failed",
          "type": "normal",
          "groupId": null,
          "tags": ["feature"],
          "meta": {
            "diagramId": "feature_logout",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.Logout.Failed"}
          }
        }
      ],
      "transitions": [
        {
          "id": "t.feature_logout.0001",
          "from": "feature.Logout.Confirming",
          "to": "feature.Logout.Submitting",
          "event": "confirmLogout",
          "roles": [],
          "validations": [
            "使用者確認後呼叫登出 API；送出期間禁用再次點擊。"
          ],
          "intent": {"category": "action", "summary": "confirmLogout"},
          "meta": {
            "diagramId": "feature_logout",
            "source": {"raw": "Feature.Logout.Confirming --> Feature.Logout.Submitting : confirmLogout"}
          }
        },
        {
          "id": "t.feature_logout.0002",
          "from": "feature.Logout.Submitting",
          "to": "feature.Logout.Succeeded",
          "event": "apiSuccess(sessionInvalidated)",
          "roles": [],
          "validations": [
            "API 回 200；server 端 session 失效或 token blacklist（若採用）；後續受保護 API 會回 401。"
          ],
          "intent": {"category": "action", "summary": "apiSuccess(sessionInvalidated)"},
          "meta": {
            "diagramId": "feature_logout",
            "source": {"raw": "Feature.Logout.Submitting --> Feature.Logout.Succeeded : apiSuccess(sessionInvalidated)"}
          }
        },
        {
          "id": "t.feature_logout.0003",
          "from": "feature.Logout.Submitting",
          "to": "feature.Logout.Failed",
          "event": "apiFailed",
          "roles": [],
          "validations": [
            "API 回 5xx 或網路錯誤；session/token 不應被部分清除造成不一致；UI 顯示錯誤並可重試。"
          ],
          "intent": {"category": "action", "summary": "apiFailed"},
          "meta": {
            "diagramId": "feature_logout",
            "source": {"raw": "Feature.Logout.Submitting --> Feature.Logout.Failed : apiFailed"}
          }
        },
        {
          "id": "t.feature_logout.0004",
          "from": "feature.Logout.Failed",
          "to": "feature.Logout.Confirming",
          "event": "showErrorAndStay",
          "roles": [],
          "validations": [
            "回確認狀態並顯示錯誤；可再次確認送出。"
          ],
          "intent": {"category": "action", "summary": "showErrorAndStay"},
          "meta": {
            "diagramId": "feature_logout",
            "source": {"raw": "Feature.Logout.Failed --> Feature.Logout.Confirming : showErrorAndStay"}
          }
        }
      ],
      "connectors": [
        {
          "id": "c.page_entry.contains.feature_logout",
          "type": "contains",
          "from": {"diagramId": "page_entry", "stateId": null},
          "to": {"diagramId": "feature_logout", "stateId": null},
          "meta": {"reason": "derived from parentDiagramId"}
        },
        {
          "id": "c.feature_logout.invokes.page_activitylistpage.s.feature_Logout_Confirming.a_cancelLogout.to.page_ActivityListPage_Ready",
          "type": "invokes",
          "from": {"diagramId": "feature_logout", "stateId": "feature.Logout.Confirming"},
          "to": {"diagramId": "page_activitylistpage", "stateId": "page.ActivityListPage.Ready"},
          "meta": {
            "reason": "cancelLogout | navigate /activities",
            "action": "cancelLogout",
            "navigateTarget": "/activities",
            "validations": [
              "取消登出會回到列表已載入狀態；使用者仍保持登入。"
            ]
          }
        },
        {
          "id": "c.feature_logout.invokes.page_activitylistpage.s.feature_Logout_Succeeded.a_navigateAfterLogout.to.page_ActivityListPage_Loading",
          "type": "invokes",
          "from": {"diagramId": "feature_logout", "stateId": "feature.Logout.Succeeded"},
          "to": {"diagramId": "page_activitylistpage", "stateId": "page.ActivityListPage.Loading"},
          "meta": {
            "reason": "navigateAfterLogout | navigate /activities",
            "action": "navigateAfterLogout",
            "navigateTarget": "/activities",
            "validations": [
              "登出成功後回到列表並以 Guest 狀態呈現；Header 不顯示我的活動/管理後台。"
            ]
          }
        }
      ],
      "meta": {
        "pageName": null,
        "featureName": "Logout",
        "entryStateId": "feature.Logout.Confirming",
        "entryValidations": [
          "顯示登出確認 UI；未確認前不清除 session/token。"
        ]
      }
    },
    {
      "id": "feature_registration_register",
      "name": "Feature: Registration.Register",
      "level": "feature",
      "parentDiagramId": "page_entry",
      "roles": ["member", "admin"],
      "variant": {
        "kind": "standalone",
        "baseDiagramId": null,
        "deltaDiagramIdsByRole": {},
        "appliesToRoles": []
      },
      "source": {"type": "mermaid", "sectionTitle": "⑭ Feature: Registration.Register", "order": 14},
      "groups": [],
      "states": [
        {
          "id": "feature.Registration.Register.Idle",
          "label": "Feature.Registration.Register.Idle",
          "type": "start",
          "groupId": null,
          "tags": ["feature", "member", "admin"],
          "meta": {
            "diagramId": "feature_registration_register",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.Registration.Register.Idle"}
          }
        },
        {
          "id": "feature.Registration.Register.CheckAuth",
          "label": "Feature.Registration.Register.CheckAuth",
          "type": "normal",
          "groupId": null,
          "tags": ["feature", "member", "admin"],
          "meta": {
            "diagramId": "feature_registration_register",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.Registration.Register.CheckAuth"}
          }
        },
        {
          "id": "feature.Registration.Register.RedirectToLogin",
          "label": "Feature.Registration.Register.RedirectToLogin",
          "type": "normal",
          "groupId": null,
          "tags": ["feature", "member", "admin"],
          "meta": {
            "diagramId": "feature_registration_register",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.Registration.Register.RedirectToLogin"}
          }
        },
        {
          "id": "feature.Registration.Register.Validating",
          "label": "Feature.Registration.Register.Validating",
          "type": "normal",
          "groupId": null,
          "tags": ["feature", "member", "admin"],
          "meta": {
            "diagramId": "feature_registration_register",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.Registration.Register.Validating"}
          }
        },
        {
          "id": "feature.Registration.Register.Submitting",
          "label": "Feature.Registration.Register.Submitting",
          "type": "normal",
          "groupId": null,
          "tags": ["feature", "member", "admin"],
          "meta": {
            "diagramId": "feature_registration_register",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.Registration.Register.Submitting"}
          }
        },
        {
          "id": "feature.Registration.Register.Succeeded",
          "label": "Feature.Registration.Register.Succeeded",
          "type": "normal",
          "groupId": null,
          "tags": ["feature", "member", "admin"],
          "meta": {
            "diagramId": "feature_registration_register",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.Registration.Register.Succeeded"}
          }
        },
        {
          "id": "feature.Registration.Register.Failed",
          "label": "Feature.Registration.Register.Failed",
          "type": "normal",
          "groupId": null,
          "tags": ["feature", "member", "admin"],
          "meta": {
            "diagramId": "feature_registration_register",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.Registration.Register.Failed"}
          }
        }
      ],
      "transitions": [
        {
          "id": "t.feature_registration_register.0001",
          "from": "feature.Registration.Register.Idle",
          "to": "feature.Registration.Register.CheckAuth",
          "event": "ensureLoggedIn",
          "roles": ["member", "admin"],
          "validations": [
            "再次確認 token/session（防止過期）；若過期需走 401。"
          ],
          "intent": {"category": "action", "summary": "ensureLoggedIn"},
          "meta": {
            "diagramId": "feature_registration_register",
            "source": {"raw": "Feature.Registration.Register.Idle --> Feature.Registration.Register.CheckAuth : ensureLoggedIn"}
          }
        },
        {
          "id": "t.feature_registration_register.0002",
          "from": "feature.Registration.Register.CheckAuth",
          "to": "feature.Registration.Register.RedirectToLogin",
          "event": "notLoggedIn",
          "roles": ["member", "admin"],
          "validations": [
            "觸發 401 導向登入並帶 returnTo 回到活動詳情；後端回 401。"
          ],
          "intent": {"category": "action", "summary": "notLoggedIn"},
          "meta": {
            "diagramId": "feature_registration_register",
            "source": {"raw": "Feature.Registration.Register.CheckAuth --> Feature.Registration.Register.RedirectToLogin : notLoggedIn"}
          }
        },
        {
          "id": "t.feature_registration_register.0003",
          "from": "feature.Registration.Register.CheckAuth",
          "to": "feature.Registration.Register.Validating",
          "event": "loggedIn",
          "roles": ["member", "admin"],
          "validations": [
            "取得活動當前狀態與時間條件（deadline/date/status）用於前端提示；最終仍以後端判斷為準。"
          ],
          "intent": {"category": "action", "summary": "loggedIn"},
          "meta": {
            "diagramId": "feature_registration_register",
            "source": {"raw": "Feature.Registration.Register.CheckAuth --> Feature.Registration.Register.Validating : loggedIn"}
          }
        },
        {
          "id": "t.feature_registration_register.0004",
          "from": "feature.Registration.Register.Validating",
          "to": "feature.Registration.Register.Submitting",
          "event": "validByRules",
          "roles": ["member", "admin"],
          "validations": [
            "規則成立：status=published 且 now<deadline 且 now<date；前端進 submitting 並禁用按鈕。"
          ],
          "intent": {"category": "action", "summary": "validByRules"},
          "meta": {
            "diagramId": "feature_registration_register",
            "source": {"raw": "Feature.Registration.Register.Validating --> Feature.Registration.Register.Submitting : validByRules"}
          }
        },
        {
          "id": "t.feature_registration_register.0005",
          "from": "feature.Registration.Register.Validating",
          "to": "feature.Registration.Register.Failed",
          "event": "invalidByRules",
          "roles": ["member", "admin"],
          "validations": [
            "規則不成立時不送 API；UI 顯示原因（已截止/已結束/已額滿/已關閉/非 published/已報名）。"
          ],
          "intent": {"category": "action", "summary": "invalidByRules"},
          "meta": {
            "diagramId": "feature_registration_register",
            "source": {"raw": "Feature.Registration.Register.Validating --> Feature.Registration.Register.Failed : invalidByRules"}
          }
        },
        {
          "id": "t.feature_registration_register.0006",
          "from": "feature.Registration.Register.Submitting",
          "to": "feature.Registration.Register.Succeeded",
          "event": "apiSuccess(registeredOrIdempotent)",
          "roles": ["member", "admin"],
          "validations": [
            "API 回 200；若已存在有效報名則仍回成功（冪等）；資料庫保證 (user_id, activity_id) 唯一；不會新增第二筆。"
          ],
          "intent": {"category": "action", "summary": "apiSuccess(registeredOrIdempotent)"},
          "meta": {
            "diagramId": "feature_registration_register",
            "source": {"raw": "Feature.Registration.Register.Submitting --> Feature.Registration.Register.Succeeded : apiSuccess(registeredOrIdempotent)"}
          }
        },
        {
          "id": "t.feature_registration_register.0007",
          "from": "feature.Registration.Register.Submitting",
          "to": "feature.Registration.Register.Failed",
          "event": "apiFailed(409or400)",
          "roles": ["member", "admin"],
          "validations": [
            "API 回 400/409（例如 deadline 已過、活動非 published、full、已報名）；UI 顯示可理解訊息；不改變 local state 為已報名。"
          ],
          "intent": {"category": "action", "summary": "apiFailed(409or400)"},
          "meta": {
            "diagramId": "feature_registration_register",
            "source": {"raw": "Feature.Registration.Register.Submitting --> Feature.Registration.Register.Failed : apiFailed(409or400)"}
          }
        }
      ],
      "connectors": [
        {
          "id": "c.page_entry.contains.feature_registration_register",
          "type": "contains",
          "from": {"diagramId": "page_entry", "stateId": null},
          "to": {"diagramId": "feature_registration_register", "stateId": null},
          "meta": {"reason": "derived from parentDiagramId"}
        },
        {
          "id": "c.feature_registration_register.invokes.page_login.s.feature_Registration_Register_RedirectToLogin.a_redirect.to.page_LoginPage_Init",
          "type": "invokes",
          "from": {"diagramId": "feature_registration_register", "stateId": "feature.Registration.Register.RedirectToLogin"},
          "to": {"diagramId": "page_login", "stateId": "page.LoginPage.Init"},
          "meta": {
            "reason": "redirect | navigate /login",
            "action": "redirect",
            "navigateTarget": "/login",
            "validations": [
              "Guest 報名需先登入；登入後 returnTo 回到 /activities/:activityId。"
            ]
          }
        },
        {
          "id": "c.feature_registration_register.invokes.page_activitydetailpage.s.feature_Registration_Register_Succeeded.a_refreshDetail.to.page_ActivityDetailPage_Refreshing",
          "type": "invokes",
          "from": {"diagramId": "feature_registration_register", "stateId": "feature.Registration.Register.Succeeded"},
          "to": {"diagramId": "page_activitydetailpage", "stateId": "page.ActivityDetailPage.Refreshing"},
          "meta": {
            "reason": "refreshDetail | navigate /activities/:activityId",
            "action": "refreshDetail",
            "navigateTarget": "/activities/:activityId",
            "validations": [
              "報名成功後詳情需刷新；顯示已報名狀態；名額與人數同步更新。"
            ]
          }
        },
        {
          "id": "c.feature_registration_register.invokes.page_activitydetailpage.s.feature_Registration_Register_Failed.a_backToDetailWithMessage.to.page_ActivityDetailPage_Ready",
          "type": "invokes",
          "from": {"diagramId": "feature_registration_register", "stateId": "feature.Registration.Register.Failed"},
          "to": {"diagramId": "page_activitydetailpage", "stateId": "page.ActivityDetailPage.Ready"},
          "meta": {
            "reason": "backToDetailWithMessage | navigate /activities/:activityId",
            "action": "backToDetailWithMessage",
            "navigateTarget": "/activities/:activityId",
            "validations": [
              "失敗需顯示可理解訊息（已額滿/已截止/重複報名）；詳情不應變成不一致狀態。"
            ]
          }
        }
      ],
      "meta": {
        "pageName": null,
        "featureName": "Registration.Register",
        "entryStateId": "feature.Registration.Register.Idle",
        "entryValidations": [
          "進入報名功能；此功能僅在 Member/Admin 已登入狀態可觸發（Guest 不顯示報名按鈕）。"
        ]
      }
    },
    {
      "id": "feature_registration_cancel",
      "name": "Feature: Registration.Cancel",
      "level": "feature",
      "parentDiagramId": "page_entry",
      "roles": ["member", "admin"],
      "variant": {
        "kind": "standalone",
        "baseDiagramId": null,
        "deltaDiagramIdsByRole": {},
        "appliesToRoles": []
      },
      "source": {"type": "mermaid", "sectionTitle": "⑮ Feature: Registration.Cancel", "order": 15},
      "groups": [],
      "states": [
        {
          "id": "feature.Registration.Cancel.Idle",
          "label": "Feature.Registration.Cancel.Idle",
          "type": "start",
          "groupId": null,
          "tags": ["feature", "member", "admin"],
          "meta": {
            "diagramId": "feature_registration_cancel",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.Registration.Cancel.Idle"}
          }
        },
        {
          "id": "feature.Registration.Cancel.CheckAuth",
          "label": "Feature.Registration.Cancel.CheckAuth",
          "type": "normal",
          "groupId": null,
          "tags": ["feature", "member", "admin"],
          "meta": {
            "diagramId": "feature_registration_cancel",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.Registration.Cancel.CheckAuth"}
          }
        },
        {
          "id": "feature.Registration.Cancel.RedirectToLogin",
          "label": "Feature.Registration.Cancel.RedirectToLogin",
          "type": "normal",
          "groupId": null,
          "tags": ["feature", "member", "admin"],
          "meta": {
            "diagramId": "feature_registration_cancel",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.Registration.Cancel.RedirectToLogin"}
          }
        },
        {
          "id": "feature.Registration.Cancel.Validating",
          "label": "Feature.Registration.Cancel.Validating",
          "type": "normal",
          "groupId": null,
          "tags": ["feature", "member", "admin"],
          "meta": {
            "diagramId": "feature_registration_cancel",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.Registration.Cancel.Validating"}
          }
        },
        {
          "id": "feature.Registration.Cancel.Submitting",
          "label": "Feature.Registration.Cancel.Submitting",
          "type": "normal",
          "groupId": null,
          "tags": ["feature", "member", "admin"],
          "meta": {
            "diagramId": "feature_registration_cancel",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.Registration.Cancel.Submitting"}
          }
        },
        {
          "id": "feature.Registration.Cancel.Succeeded",
          "label": "Feature.Registration.Cancel.Succeeded",
          "type": "normal",
          "groupId": null,
          "tags": ["feature", "member", "admin"],
          "meta": {
            "diagramId": "feature_registration_cancel",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.Registration.Cancel.Succeeded"}
          }
        },
        {
          "id": "feature.Registration.Cancel.Failed",
          "label": "Feature.Registration.Cancel.Failed",
          "type": "normal",
          "groupId": null,
          "tags": ["feature", "member", "admin"],
          "meta": {
            "diagramId": "feature_registration_cancel",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.Registration.Cancel.Failed"}
          }
        }
      ],
      "transitions": [
        {
          "id": "t.feature_registration_cancel.0001",
          "from": "feature.Registration.Cancel.Idle",
          "to": "feature.Registration.Cancel.CheckAuth",
          "event": "ensureLoggedIn",
          "roles": ["member", "admin"],
          "validations": [
            "驗證 token/session；過期則走 401。"
          ],
          "intent": {"category": "action", "summary": "ensureLoggedIn"},
          "meta": {
            "diagramId": "feature_registration_cancel",
            "source": {"raw": "Feature.Registration.Cancel.Idle --> Feature.Registration.Cancel.CheckAuth : ensureLoggedIn"}
          }
        },
        {
          "id": "t.feature_registration_cancel.0002",
          "from": "feature.Registration.Cancel.CheckAuth",
          "to": "feature.Registration.Cancel.RedirectToLogin",
          "event": "notLoggedIn",
          "roles": ["member", "admin"],
          "validations": [
            "觸發 401 導向登入並保留 returnTo；後端回 401。"
          ],
          "intent": {"category": "action", "summary": "notLoggedIn"},
          "meta": {
            "diagramId": "feature_registration_cancel",
            "source": {"raw": "Feature.Registration.Cancel.CheckAuth --> Feature.Registration.Cancel.RedirectToLogin : notLoggedIn"}
          }
        },
        {
          "id": "t.feature_registration_cancel.0003",
          "from": "feature.Registration.Cancel.CheckAuth",
          "to": "feature.Registration.Cancel.Validating",
          "event": "loggedIn",
          "roles": ["member", "admin"],
          "validations": [
            "依規則檢查 now<deadline 且 now<date；同時確認使用者存在有效報名（最終以後端判斷）。"
          ],
          "intent": {"category": "action", "summary": "loggedIn"},
          "meta": {
            "diagramId": "feature_registration_cancel",
            "source": {"raw": "Feature.Registration.Cancel.CheckAuth --> Feature.Registration.Cancel.Validating : loggedIn"}
          }
        },
        {
          "id": "t.feature_registration_cancel.0004",
          "from": "feature.Registration.Cancel.Validating",
          "to": "feature.Registration.Cancel.Submitting",
          "event": "validByRules",
          "roles": ["member", "admin"],
          "validations": [
            "規則成立才送出取消 API；UI 進 submitting，按鈕 disabled。"
          ],
          "intent": {"category": "action", "summary": "validByRules"},
          "meta": {
            "diagramId": "feature_registration_cancel",
            "source": {"raw": "Feature.Registration.Cancel.Validating --> Feature.Registration.Cancel.Submitting : validByRules"}
          }
        },
        {
          "id": "t.feature_registration_cancel.0005",
          "from": "feature.Registration.Cancel.Validating",
          "to": "feature.Registration.Cancel.Failed",
          "event": "invalidByRules",
          "roles": ["member", "admin"],
          "validations": [
            "規則不成立時不送 API；UI 顯示原因（已截止/已結束）。"
          ],
          "intent": {"category": "action", "summary": "invalidByRules"},
          "meta": {
            "diagramId": "feature_registration_cancel",
            "source": {"raw": "Feature.Registration.Cancel.Validating --> Feature.Registration.Cancel.Failed : invalidByRules"}
          }
        },
        {
          "id": "t.feature_registration_cancel.0006",
          "from": "feature.Registration.Cancel.Submitting",
          "to": "feature.Registration.Cancel.Succeeded",
          "event": "apiSuccess(canceledOrIdempotent)",
          "roles": ["member", "admin"],
          "validations": [
            "API 回 200；若已取消重送仍成功（冪等）；資料更新 canceled_at（若尚未取消）。"
          ],
          "intent": {"category": "action", "summary": "apiSuccess(canceledOrIdempotent)"},
          "meta": {
            "diagramId": "feature_registration_cancel",
            "source": {"raw": "Feature.Registration.Cancel.Submitting --> Feature.Registration.Cancel.Succeeded : apiSuccess(canceledOrIdempotent)"}
          }
        },
        {
          "id": "t.feature_registration_cancel.0007",
          "from": "feature.Registration.Cancel.Submitting",
          "to": "feature.Registration.Cancel.Failed",
          "event": "apiFailed(409or400)",
          "roles": ["member", "admin"],
          "validations": [
            "API 回 400/409（例如已截止/已結束/未報名）；UI 顯示可理解訊息；不應把 UI 誤判為已取消。"
          ],
          "intent": {"category": "action", "summary": "apiFailed(409or400)"},
          "meta": {
            "diagramId": "feature_registration_cancel",
            "source": {"raw": "Feature.Registration.Cancel.Submitting --> Feature.Registration.Cancel.Failed : apiFailed(409or400)"}
          }
        }
      ],
      "connectors": [
        {
          "id": "c.page_entry.contains.feature_registration_cancel",
          "type": "contains",
          "from": {"diagramId": "page_entry", "stateId": null},
          "to": {"diagramId": "feature_registration_cancel", "stateId": null},
          "meta": {"reason": "derived from parentDiagramId"}
        },
        {
          "id": "c.feature_registration_cancel.invokes.page_login.s.feature_Registration_Cancel_RedirectToLogin.a_redirect.to.page_LoginPage_Init",
          "type": "invokes",
          "from": {"diagramId": "feature_registration_cancel", "stateId": "feature.Registration.Cancel.RedirectToLogin"},
          "to": {"diagramId": "page_login", "stateId": "page.LoginPage.Init"},
          "meta": {
            "reason": "redirect | navigate /login",
            "action": "redirect",
            "navigateTarget": "/login",
            "validations": [
              "Guest 取消報名需先登入；登入後 returnTo 回到 /activities/:activityId。"
            ]
          }
        },
        {
          "id": "c.feature_registration_cancel.invokes.page_activitydetailpage.s.feature_Registration_Cancel_Succeeded.a_refreshDetail.to.page_ActivityDetailPage_Refreshing",
          "type": "invokes",
          "from": {"diagramId": "feature_registration_cancel", "stateId": "feature.Registration.Cancel.Succeeded"},
          "to": {"diagramId": "page_activitydetailpage", "stateId": "page.ActivityDetailPage.Refreshing"},
          "meta": {
            "reason": "refreshDetail | navigate /activities/:activityId",
            "action": "refreshDetail",
            "navigateTarget": "/activities/:activityId",
            "validations": [
              "取消成功後詳情刷新；名額與人數同步更新；按鈕狀態回可報名。"
            ]
          }
        },
        {
          "id": "c.feature_registration_cancel.invokes.page_activitydetailpage.s.feature_Registration_Cancel_Failed.a_backToDetailWithMessage.to.page_ActivityDetailPage_Ready",
          "type": "invokes",
          "from": {"diagramId": "feature_registration_cancel", "stateId": "feature.Registration.Cancel.Failed"},
          "to": {"diagramId": "page_activitydetailpage", "stateId": "page.ActivityDetailPage.Ready"},
          "meta": {
            "reason": "backToDetailWithMessage | navigate /activities/:activityId",
            "action": "backToDetailWithMessage",
            "navigateTarget": "/activities/:activityId",
            "validations": [
              "失敗需顯示訊息（尚未報名/期限已過等）；詳情需保持一致。"
            ]
          }
        }
      ],
      "meta": {
        "pageName": null,
        "featureName": "Registration.Cancel",
        "entryStateId": "feature.Registration.Cancel.Idle",
        "entryValidations": [
          "進入取消功能；僅已登入且已報名者才應看到取消按鈕（由詳情 UI 決定）。"
        ]
      }
    },
    {
      "id": "feature_adminactivity_save",
      "name": "Feature: AdminActivity.Save",
      "level": "feature",
      "parentDiagramId": "page_entry",
      "roles": ["admin"],
      "variant": {
        "kind": "standalone",
        "baseDiagramId": null,
        "deltaDiagramIdsByRole": {},
        "appliesToRoles": []
      },
      "source": {"type": "mermaid", "sectionTitle": "⑯ Feature: AdminActivity.Save", "order": 16},
      "groups": [],
      "states": [
        {
          "id": "feature.AdminActivity.Save.Idle",
          "label": "Feature.AdminActivity.Save.Idle",
          "type": "start",
          "groupId": null,
          "tags": ["feature", "admin"],
          "meta": {
            "diagramId": "feature_adminactivity_save",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.AdminActivity.Save.Idle"}
          }
        },
        {
          "id": "feature.AdminActivity.Save.Validating",
          "label": "Feature.AdminActivity.Save.Validating",
          "type": "normal",
          "groupId": null,
          "tags": ["feature", "admin"],
          "meta": {
            "diagramId": "feature_adminactivity_save",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.AdminActivity.Save.Validating"}
          }
        },
        {
          "id": "feature.AdminActivity.Save.Submitting",
          "label": "Feature.AdminActivity.Save.Submitting",
          "type": "normal",
          "groupId": null,
          "tags": ["feature", "admin"],
          "meta": {
            "diagramId": "feature_adminactivity_save",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.AdminActivity.Save.Submitting"}
          }
        },
        {
          "id": "feature.AdminActivity.Save.Succeeded",
          "label": "Feature.AdminActivity.Save.Succeeded",
          "type": "normal",
          "groupId": null,
          "tags": ["feature", "admin"],
          "meta": {
            "diagramId": "feature_adminactivity_save",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.AdminActivity.Save.Succeeded"}
          }
        },
        {
          "id": "feature.AdminActivity.Save.Failed",
          "label": "Feature.AdminActivity.Save.Failed",
          "type": "normal",
          "groupId": null,
          "tags": ["feature", "admin"],
          "meta": {
            "diagramId": "feature_adminactivity_save",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.AdminActivity.Save.Failed"}
          }
        }
      ],
      "transitions": [
        {
          "id": "t.feature_adminactivity_save.0001",
          "from": "feature.AdminActivity.Save.Idle",
          "to": "feature.AdminActivity.Save.Validating",
          "event": "validateFields",
          "roles": ["admin"],
          "validations": [
            "檢查必填：title/description/date/location/deadline/capacity；並檢查 date>deadline、capacity 正整數。"
          ],
          "intent": {"category": "action", "summary": "validateFields"},
          "meta": {
            "diagramId": "feature_adminactivity_save",
            "source": {"raw": "Feature.AdminActivity.Save.Idle --> Feature.AdminActivity.Save.Validating : validateFields"}
          }
        },
        {
          "id": "t.feature_adminactivity_save.0002",
          "from": "feature.AdminActivity.Save.Validating",
          "to": "feature.AdminActivity.Save.Submitting",
          "event": "valid",
          "roles": ["admin"],
          "validations": [
            "驗證通過後送出保存/更新 API；UI 顯示 submitting/loading。"
          ],
          "intent": {"category": "action", "summary": "valid"},
          "meta": {
            "diagramId": "feature_adminactivity_save",
            "source": {"raw": "Feature.AdminActivity.Save.Validating --> Feature.AdminActivity.Save.Submitting : valid"}
          }
        },
        {
          "id": "t.feature_adminactivity_save.0003",
          "from": "feature.AdminActivity.Save.Validating",
          "to": "feature.AdminActivity.Save.Failed",
          "event": "invalid",
          "roles": ["admin"],
          "validations": [
            "顯示欄位錯誤；不送 API。"
          ],
          "intent": {"category": "action", "summary": "invalid"},
          "meta": {
            "diagramId": "feature_adminactivity_save",
            "source": {"raw": "Feature.AdminActivity.Save.Validating --> Feature.AdminActivity.Save.Failed : invalid"}
          }
        },
        {
          "id": "t.feature_adminactivity_save.0004",
          "from": "feature.AdminActivity.Save.Submitting",
          "to": "feature.AdminActivity.Save.Succeeded",
          "event": "apiSuccess(savedDraftOrUpdated)",
          "roles": ["admin"],
          "validations": [
            "API 回 200；created_at/updated_at 正確；若新建則 created_by 為當前 Admin；Audit Log 寫 ACTIVITY_CREATE 或 ACTIVITY_UPDATE。"
          ],
          "intent": {"category": "action", "summary": "apiSuccess(savedDraftOrUpdated)"},
          "meta": {
            "diagramId": "feature_adminactivity_save",
            "source": {"raw": "Feature.AdminActivity.Save.Submitting --> Feature.AdminActivity.Save.Succeeded : apiSuccess(savedDraftOrUpdated)"}
          }
        },
        {
          "id": "t.feature_adminactivity_save.0005",
          "from": "feature.AdminActivity.Save.Submitting",
          "to": "feature.AdminActivity.Save.Failed",
          "event": "apiFailed",
          "roles": ["admin"],
          "validations": [
            "API 失敗（4xx/5xx）需顯示訊息；不應在 UI 假定已保存。"
          ],
          "intent": {"category": "action", "summary": "apiFailed"},
          "meta": {
            "diagramId": "feature_adminactivity_save",
            "source": {"raw": "Feature.AdminActivity.Save.Submitting --> Feature.AdminActivity.Save.Failed : apiFailed"}
          }
        }
      ],
      "connectors": [
        {
          "id": "c.page_entry.contains.feature_adminactivity_save",
          "type": "contains",
          "from": {"diagramId": "page_entry", "stateId": null},
          "to": {"diagramId": "feature_adminactivity_save", "stateId": null},
          "meta": {"reason": "derived from parentDiagramId"}
        },
        {
          "id": "c.feature_adminactivity_save.invokes.page_adminactivityeditorpage.s.feature_AdminActivity_Save_Succeeded.a_stayOnEditor.to.page_AdminActivityEditorPage_Editing",
          "type": "invokes",
          "from": {"diagramId": "feature_adminactivity_save", "stateId": "feature.AdminActivity.Save.Succeeded"},
          "to": {"diagramId": "page_adminactivityeditorpage", "stateId": "page.AdminActivityEditorPage.Editing"},
          "meta": {
            "reason": "stayOnEditor | navigate /admin/activities/:activityId/edit",
            "action": "stayOnEditor",
            "navigateTarget": "/admin/activities/:activityId/edit",
            "validations": [
              "保存成功後仍留在編輯頁；若是 new 建立則需要拿到 activityId 並更新 URL。"
            ]
          }
        },
        {
          "id": "c.feature_adminactivity_save.invokes.page_adminactivityeditorpage.s.feature_AdminActivity_Save_Failed.a_backToEditorWithErrors.to.page_AdminActivityEditorPage_Editing",
          "type": "invokes",
          "from": {"diagramId": "feature_adminactivity_save", "stateId": "feature.AdminActivity.Save.Failed"},
          "to": {"diagramId": "page_adminactivityeditorpage", "stateId": "page.AdminActivityEditorPage.Editing"},
          "meta": {
            "reason": "backToEditorWithErrors | navigate /admin/activities/:activityId/edit",
            "action": "backToEditorWithErrors",
            "navigateTarget": "/admin/activities/:activityId/edit",
            "validations": [
              "顯示欄位錯誤訊息並保留使用者輸入；不得丟失表單狀態。"
            ]
          }
        }
      ],
      "meta": {
        "pageName": null,
        "featureName": "AdminActivity.Save",
        "entryStateId": "feature.AdminActivity.Save.Idle",
        "entryValidations": [
          "僅 Admin 可觸發；非 Admin 呼叫 API 回 403。"
        ]
      }
    },
    {
      "id": "feature_adminactivity_publish",
      "name": "Feature: AdminActivity.Publish",
      "level": "feature",
      "parentDiagramId": "page_entry",
      "roles": ["admin"],
      "variant": {
        "kind": "standalone",
        "baseDiagramId": null,
        "deltaDiagramIdsByRole": {},
        "appliesToRoles": []
      },
      "source": {"type": "mermaid", "sectionTitle": "⑰ Feature: AdminActivity.Publish", "order": 17},
      "groups": [],
      "states": [
        {
          "id": "feature.AdminActivity.Publish.Idle",
          "label": "Feature.AdminActivity.Publish.Idle",
          "type": "start",
          "groupId": null,
          "tags": ["feature", "admin"],
          "meta": {
            "diagramId": "feature_adminactivity_publish",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.AdminActivity.Publish.Idle"}
          }
        },
        {
          "id": "feature.AdminActivity.Publish.Validating",
          "label": "Feature.AdminActivity.Publish.Validating",
          "type": "normal",
          "groupId": null,
          "tags": ["feature", "admin"],
          "meta": {
            "diagramId": "feature_adminactivity_publish",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.AdminActivity.Publish.Validating"}
          }
        },
        {
          "id": "feature.AdminActivity.Publish.Submitting",
          "label": "Feature.AdminActivity.Publish.Submitting",
          "type": "normal",
          "groupId": null,
          "tags": ["feature", "admin"],
          "meta": {
            "diagramId": "feature_adminactivity_publish",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.AdminActivity.Publish.Submitting"}
          }
        },
        {
          "id": "feature.AdminActivity.Publish.Succeeded",
          "label": "Feature.AdminActivity.Publish.Succeeded",
          "type": "normal",
          "groupId": null,
          "tags": ["feature", "admin"],
          "meta": {
            "diagramId": "feature_adminactivity_publish",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.AdminActivity.Publish.Succeeded"}
          }
        },
        {
          "id": "feature.AdminActivity.Publish.Failed",
          "label": "Feature.AdminActivity.Publish.Failed",
          "type": "normal",
          "groupId": null,
          "tags": ["feature", "admin"],
          "meta": {
            "diagramId": "feature_adminactivity_publish",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.AdminActivity.Publish.Failed"}
          }
        }
      ],
      "transitions": [
        {
          "id": "t.feature_adminactivity_publish.0001",
          "from": "feature.AdminActivity.Publish.Idle",
          "to": "feature.AdminActivity.Publish.Validating",
          "event": "validateStatusAndFields",
          "roles": ["admin"],
          "validations": [
            "必須是 draft 才可 publish；同時欄位需合法（date>deadline、capacity 正整數、必填）。"
          ],
          "intent": {"category": "action", "summary": "validateStatusAndFields"},
          "meta": {
            "diagramId": "feature_adminactivity_publish",
            "source": {"raw": "Feature.AdminActivity.Publish.Idle --> Feature.AdminActivity.Publish.Validating : validateStatusAndFields"}
          }
        },
        {
          "id": "t.feature_adminactivity_publish.0002",
          "from": "feature.AdminActivity.Publish.Validating",
          "to": "feature.AdminActivity.Publish.Submitting",
          "event": "valid",
          "roles": ["admin"],
          "validations": [
            "送出狀態變更 API；UI 顯示 loading；避免重複送出。"
          ],
          "intent": {"category": "action", "summary": "valid"},
          "meta": {
            "diagramId": "feature_adminactivity_publish",
            "source": {"raw": "Feature.AdminActivity.Publish.Validating --> Feature.AdminActivity.Publish.Submitting : valid"}
          }
        },
        {
          "id": "t.feature_adminactivity_publish.0003",
          "from": "feature.AdminActivity.Publish.Validating",
          "to": "feature.AdminActivity.Publish.Failed",
          "event": "invalid",
          "roles": ["admin"],
          "validations": [
            "顯示錯誤原因（例如狀態不合法、欄位不合法）；不送 API。"
          ],
          "intent": {"category": "action", "summary": "invalid"},
          "meta": {
            "diagramId": "feature_adminactivity_publish",
            "source": {"raw": "Feature.AdminActivity.Publish.Validating --> Feature.AdminActivity.Publish.Failed : invalid"}
          }
        },
        {
          "id": "t.feature_adminactivity_publish.0004",
          "from": "feature.AdminActivity.Publish.Submitting",
          "to": "feature.AdminActivity.Publish.Succeeded",
          "event": "apiSuccess(status=draftToPublished)",
          "roles": ["admin"],
          "validations": [
            "API 回 200；status 由 draft 變 published；Audit Log 寫 ACTIVITY_STATUS_CHANGE（metadata 含 old/new）。"
          ],
          "intent": {"category": "action", "summary": "apiSuccess(status=draftToPublished)"},
          "meta": {
            "diagramId": "feature_adminactivity_publish",
            "source": {"raw": "Feature.AdminActivity.Publish.Submitting --> Feature.AdminActivity.Publish.Succeeded : apiSuccess(status=draftToPublished)"}
          }
        },
        {
          "id": "t.feature_adminactivity_publish.0005",
          "from": "feature.AdminActivity.Publish.Submitting",
          "to": "feature.AdminActivity.Publish.Failed",
          "event": "apiFailed",
          "roles": ["admin"],
          "validations": [
            "API 失敗需顯示訊息；狀態不變。"
          ],
          "intent": {"category": "action", "summary": "apiFailed"},
          "meta": {
            "diagramId": "feature_adminactivity_publish",
            "source": {"raw": "Feature.AdminActivity.Publish.Submitting --> Feature.AdminActivity.Publish.Failed : apiFailed"}
          }
        }
      ],
      "connectors": [
        {
          "id": "c.page_entry.contains.feature_adminactivity_publish",
          "type": "contains",
          "from": {"diagramId": "page_entry", "stateId": null},
          "to": {"diagramId": "feature_adminactivity_publish", "stateId": null},
          "meta": {"reason": "derived from parentDiagramId"}
        },
        {
          "id": "c.feature_adminactivity_publish.invokes.page_adminactivitylistpage.s.feature_AdminActivity_Publish_Succeeded.a_backToAdminList.to.page_AdminActivityListPage_Loading",
          "type": "invokes",
          "from": {"diagramId": "feature_adminactivity_publish", "stateId": "feature.AdminActivity.Publish.Succeeded"},
          "to": {"diagramId": "page_adminactivitylistpage", "stateId": "page.AdminActivityListPage.Loading"},
          "meta": {
            "reason": "backToAdminList | navigate /admin/activities",
            "action": "backToAdminList",
            "navigateTarget": "/admin/activities",
            "validations": [
              "發布成功後回管理列表並刷新；一般列表可見 published/full；需寫 audit log。"
            ]
          }
        },
        {
          "id": "c.feature_adminactivity_publish.invokes.page_adminactivityeditorpage.s.feature_AdminActivity_Publish_Failed.a_backToEditorWithMessage.to.page_AdminActivityEditorPage_Editing",
          "type": "invokes",
          "from": {"diagramId": "feature_adminactivity_publish", "stateId": "feature.AdminActivity.Publish.Failed"},
          "to": {"diagramId": "page_adminactivityeditorpage", "stateId": "page.AdminActivityEditorPage.Editing"},
          "meta": {
            "reason": "backToEditorWithMessage | navigate /admin/activities/:activityId/edit",
            "action": "backToEditorWithMessage",
            "navigateTarget": "/admin/activities/:activityId/edit",
            "validations": [
              "發布失敗回編輯頁並顯示訊息；不得改變活動狀態。"
            ]
          }
        }
      ],
      "meta": {
        "pageName": null,
        "featureName": "AdminActivity.Publish",
        "entryStateId": "feature.AdminActivity.Publish.Idle",
        "entryValidations": [
          "僅 Admin 可觸發；非法角色回 403。"
        ]
      }
    },
    {
      "id": "feature_adminactivity_close",
      "name": "Feature: AdminActivity.Close",
      "level": "feature",
      "parentDiagramId": "page_entry",
      "roles": ["admin"],
      "variant": {
        "kind": "standalone",
        "baseDiagramId": null,
        "deltaDiagramIdsByRole": {},
        "appliesToRoles": []
      },
      "source": {"type": "mermaid", "sectionTitle": "⑱ Feature: AdminActivity.Close", "order": 18},
      "groups": [],
      "states": [
        {
          "id": "feature.AdminActivity.Close.Idle",
          "label": "Feature.AdminActivity.Close.Idle",
          "type": "start",
          "groupId": null,
          "tags": ["feature", "admin"],
          "meta": {
            "diagramId": "feature_adminactivity_close",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.AdminActivity.Close.Idle"}
          }
        },
        {
          "id": "feature.AdminActivity.Close.Validating",
          "label": "Feature.AdminActivity.Close.Validating",
          "type": "normal",
          "groupId": null,
          "tags": ["feature", "admin"],
          "meta": {
            "diagramId": "feature_adminactivity_close",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.AdminActivity.Close.Validating"}
          }
        },
        {
          "id": "feature.AdminActivity.Close.Submitting",
          "label": "Feature.AdminActivity.Close.Submitting",
          "type": "normal",
          "groupId": null,
          "tags": ["feature", "admin"],
          "meta": {
            "diagramId": "feature_adminactivity_close",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.AdminActivity.Close.Submitting"}
          }
        },
        {
          "id": "feature.AdminActivity.Close.Succeeded",
          "label": "Feature.AdminActivity.Close.Succeeded",
          "type": "normal",
          "groupId": null,
          "tags": ["feature", "admin"],
          "meta": {
            "diagramId": "feature_adminactivity_close",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.AdminActivity.Close.Succeeded"}
          }
        },
        {
          "id": "feature.AdminActivity.Close.Failed",
          "label": "Feature.AdminActivity.Close.Failed",
          "type": "normal",
          "groupId": null,
          "tags": ["feature", "admin"],
          "meta": {
            "diagramId": "feature_adminactivity_close",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.AdminActivity.Close.Failed"}
          }
        }
      ],
      "transitions": [
        {
          "id": "t.feature_adminactivity_close.0001",
          "from": "feature.AdminActivity.Close.Idle",
          "to": "feature.AdminActivity.Close.Validating",
          "event": "validateCurrentStatus",
          "roles": ["admin"],
          "validations": [
            "僅允許從 published/full 關閉；若已 closed/draft/archived 必須拒絕。"
          ],
          "intent": {"category": "action", "summary": "validateCurrentStatus"},
          "meta": {
            "diagramId": "feature_adminactivity_close",
            "source": {"raw": "Feature.AdminActivity.Close.Idle --> Feature.AdminActivity.Close.Validating : validateCurrentStatus"}
          }
        },
        {
          "id": "t.feature_adminactivity_close.0002",
          "from": "feature.AdminActivity.Close.Validating",
          "to": "feature.AdminActivity.Close.Submitting",
          "event": "valid",
          "roles": ["admin"],
          "validations": [
            "送出關閉 API；UI 顯示 loading；避免重複送出。"
          ],
          "intent": {"category": "action", "summary": "valid"},
          "meta": {
            "diagramId": "feature_adminactivity_close",
            "source": {"raw": "Feature.AdminActivity.Close.Validating --> Feature.AdminActivity.Close.Submitting : valid"}
          }
        },
        {
          "id": "t.feature_adminactivity_close.0003",
          "from": "feature.AdminActivity.Close.Validating",
          "to": "feature.AdminActivity.Close.Failed",
          "event": "invalid",
          "roles": ["admin"],
          "validations": [
            "顯示非法狀態轉換訊息；不送 API。"
          ],
          "intent": {"category": "action", "summary": "invalid"},
          "meta": {
            "diagramId": "feature_adminactivity_close",
            "source": {"raw": "Feature.AdminActivity.Close.Validating --> Feature.AdminActivity.Close.Failed : invalid"}
          }
        },
        {
          "id": "t.feature_adminactivity_close.0004",
          "from": "feature.AdminActivity.Close.Submitting",
          "to": "feature.AdminActivity.Close.Succeeded",
          "event": "apiSuccess(status=publishedOrFullToClosed)",
          "roles": ["admin"],
          "validations": [
            "API 回 200；status=closed；一般列表/詳情對 Guest/Member 變為不可見（存取回 404）。"
          ],
          "intent": {"category": "action", "summary": "apiSuccess(status=publishedOrFullToClosed)"},
          "meta": {
            "diagramId": "feature_adminactivity_close",
            "source": {"raw": "Feature.AdminActivity.Close.Submitting --> Feature.AdminActivity.Close.Succeeded : apiSuccess(status=publishedOrFullToClosed)"}
          }
        },
        {
          "id": "t.feature_adminactivity_close.0005",
          "from": "feature.AdminActivity.Close.Submitting",
          "to": "feature.AdminActivity.Close.Failed",
          "event": "apiFailed",
          "roles": ["admin"],
          "validations": [
            "API 失敗顯示訊息；狀態不變。"
          ],
          "intent": {"category": "action", "summary": "apiFailed"},
          "meta": {
            "diagramId": "feature_adminactivity_close",
            "source": {"raw": "Feature.AdminActivity.Close.Submitting --> Feature.AdminActivity.Close.Failed : apiFailed"}
          }
        }
      ],
      "connectors": [
        {
          "id": "c.page_entry.contains.feature_adminactivity_close",
          "type": "contains",
          "from": {"diagramId": "page_entry", "stateId": null},
          "to": {"diagramId": "feature_adminactivity_close", "stateId": null},
          "meta": {"reason": "derived from parentDiagramId"}
        },
        {
          "id": "c.feature_adminactivity_close.invokes.page_adminactivitylistpage.s.feature_AdminActivity_Close_Succeeded.a_backToAdminList.to.page_AdminActivityListPage_Loading",
          "type": "invokes",
          "from": {"diagramId": "feature_adminactivity_close", "stateId": "feature.AdminActivity.Close.Succeeded"},
          "to": {"diagramId": "page_adminactivitylistpage", "stateId": "page.AdminActivityListPage.Loading"},
          "meta": {
            "reason": "backToAdminList | navigate /admin/activities",
            "action": "backToAdminList",
            "navigateTarget": "/admin/activities",
            "validations": [
              "關閉成功後回管理列表；closed 不應出現在一般列表。"
            ]
          }
        },
        {
          "id": "c.feature_adminactivity_close.invokes.page_adminactivitylistpage.s.feature_AdminActivity_Close_Failed.a_backToListWithMessage.to.page_AdminActivityListPage_Ready",
          "type": "invokes",
          "from": {"diagramId": "feature_adminactivity_close", "stateId": "feature.AdminActivity.Close.Failed"},
          "to": {"diagramId": "page_adminactivitylistpage", "stateId": "page.AdminActivityListPage.Ready"},
          "meta": {
            "reason": "backToListWithMessage | navigate /admin/activities",
            "action": "backToListWithMessage",
            "navigateTarget": "/admin/activities",
            "validations": [
              "關閉失敗回列表並顯示訊息；狀態不得改變。"
            ]
          }
        }
      ],
      "meta": {
        "pageName": null,
        "featureName": "AdminActivity.Close",
        "entryStateId": "feature.AdminActivity.Close.Idle",
        "entryValidations": [
          "僅 Admin 可觸發；非法角色回 403。"
        ]
      }
    },
    {
      "id": "feature_adminactivity_archive",
      "name": "Feature: AdminActivity.Archive",
      "level": "feature",
      "parentDiagramId": "page_entry",
      "roles": ["admin"],
      "variant": {
        "kind": "standalone",
        "baseDiagramId": null,
        "deltaDiagramIdsByRole": {},
        "appliesToRoles": []
      },
      "source": {"type": "mermaid", "sectionTitle": "⑲ Feature: AdminActivity.Archive", "order": 19},
      "groups": [],
      "states": [
        {
          "id": "feature.AdminActivity.Archive.Idle",
          "label": "Feature.AdminActivity.Archive.Idle",
          "type": "start",
          "groupId": null,
          "tags": ["feature", "admin"],
          "meta": {
            "diagramId": "feature_adminactivity_archive",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.AdminActivity.Archive.Idle"}
          }
        },
        {
          "id": "feature.AdminActivity.Archive.Validating",
          "label": "Feature.AdminActivity.Archive.Validating",
          "type": "normal",
          "groupId": null,
          "tags": ["feature", "admin"],
          "meta": {
            "diagramId": "feature_adminactivity_archive",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.AdminActivity.Archive.Validating"}
          }
        },
        {
          "id": "feature.AdminActivity.Archive.Submitting",
          "label": "Feature.AdminActivity.Archive.Submitting",
          "type": "normal",
          "groupId": null,
          "tags": ["feature", "admin"],
          "meta": {
            "diagramId": "feature_adminactivity_archive",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.AdminActivity.Archive.Submitting"}
          }
        },
        {
          "id": "feature.AdminActivity.Archive.Succeeded",
          "label": "Feature.AdminActivity.Archive.Succeeded",
          "type": "normal",
          "groupId": null,
          "tags": ["feature", "admin"],
          "meta": {
            "diagramId": "feature_adminactivity_archive",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.AdminActivity.Archive.Succeeded"}
          }
        },
        {
          "id": "feature.AdminActivity.Archive.Failed",
          "label": "Feature.AdminActivity.Archive.Failed",
          "type": "normal",
          "groupId": null,
          "tags": ["feature", "admin"],
          "meta": {
            "diagramId": "feature_adminactivity_archive",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.AdminActivity.Archive.Failed"}
          }
        }
      ],
      "transitions": [
        {
          "id": "t.feature_adminactivity_archive.0001",
          "from": "feature.AdminActivity.Archive.Idle",
          "to": "feature.AdminActivity.Archive.Validating",
          "event": "validateCurrentStatus",
          "roles": ["admin"],
          "validations": [
            "僅允許從 draft/closed 下架；published/full 不允許直接下架（需先 closed）。"
          ],
          "intent": {"category": "action", "summary": "validateCurrentStatus"},
          "meta": {
            "diagramId": "feature_adminactivity_archive",
            "source": {"raw": "Feature.AdminActivity.Archive.Idle --> Feature.AdminActivity.Archive.Validating : validateCurrentStatus"}
          }
        },
        {
          "id": "t.feature_adminactivity_archive.0002",
          "from": "feature.AdminActivity.Archive.Validating",
          "to": "feature.AdminActivity.Archive.Submitting",
          "event": "valid",
          "roles": ["admin"],
          "validations": [
            "送出下架 API；UI 顯示 loading；避免重複送出。"
          ],
          "intent": {"category": "action", "summary": "valid"},
          "meta": {
            "diagramId": "feature_adminactivity_archive",
            "source": {"raw": "Feature.AdminActivity.Archive.Validating --> Feature.AdminActivity.Archive.Submitting : valid"}
          }
        },
        {
          "id": "t.feature_adminactivity_archive.0003",
          "from": "feature.AdminActivity.Archive.Validating",
          "to": "feature.AdminActivity.Archive.Failed",
          "event": "invalid",
          "roles": ["admin"],
          "validations": [
            "顯示非法狀態轉換訊息；不送 API。"
          ],
          "intent": {"category": "action", "summary": "invalid"},
          "meta": {
            "diagramId": "feature_adminactivity_archive",
            "source": {"raw": "Feature.AdminActivity.Archive.Validating --> Feature.AdminActivity.Archive.Failed : invalid"}
          }
        },
        {
          "id": "t.feature_adminactivity_archive.0004",
          "from": "feature.AdminActivity.Archive.Submitting",
          "to": "feature.AdminActivity.Archive.Succeeded",
          "event": "apiSuccess(status=draftOrClosedToArchived)",
          "roles": ["admin"],
          "validations": [
            "API 回 200；status=archived；一般列表/詳情不可見且存取回 404；不可再報名/取消。"
          ],
          "intent": {"category": "action", "summary": "apiSuccess(status=draftOrClosedToArchived)"},
          "meta": {
            "diagramId": "feature_adminactivity_archive",
            "source": {"raw": "Feature.AdminActivity.Archive.Submitting --> Feature.AdminActivity.Archive.Succeeded : apiSuccess(status=draftOrClosedToArchived)"}
          }
        },
        {
          "id": "t.feature_adminactivity_archive.0005",
          "from": "feature.AdminActivity.Archive.Submitting",
          "to": "feature.AdminActivity.Archive.Failed",
          "event": "apiFailed",
          "roles": ["admin"],
          "validations": [
            "API 失敗顯示訊息；狀態不變。"
          ],
          "intent": {"category": "action", "summary": "apiFailed"},
          "meta": {
            "diagramId": "feature_adminactivity_archive",
            "source": {"raw": "Feature.AdminActivity.Archive.Submitting --> Feature.AdminActivity.Archive.Failed : apiFailed"}
          }
        }
      ],
      "connectors": [
        {
          "id": "c.page_entry.contains.feature_adminactivity_archive",
          "type": "contains",
          "from": {"diagramId": "page_entry", "stateId": null},
          "to": {"diagramId": "feature_adminactivity_archive", "stateId": null},
          "meta": {"reason": "derived from parentDiagramId"}
        },
        {
          "id": "c.feature_adminactivity_archive.invokes.page_adminactivitylistpage.s.feature_AdminActivity_Archive_Succeeded.a_backToAdminList.to.page_AdminActivityListPage_Loading",
          "type": "invokes",
          "from": {"diagramId": "feature_adminactivity_archive", "stateId": "feature.AdminActivity.Archive.Succeeded"},
          "to": {"diagramId": "page_adminactivitylistpage", "stateId": "page.AdminActivityListPage.Loading"},
          "meta": {
            "reason": "backToAdminList | navigate /admin/activities",
            "action": "backToAdminList",
            "navigateTarget": "/admin/activities",
            "validations": [
              "下架成功後回管理列表；archived 不可被一般詳情存取（404）。"
            ]
          }
        },
        {
          "id": "c.feature_adminactivity_archive.invokes.page_adminactivityeditorpage.s.feature_AdminActivity_Archive_Failed.a_backToEditorWithMessage.to.page_AdminActivityEditorPage_Editing",
          "type": "invokes",
          "from": {"diagramId": "feature_adminactivity_archive", "stateId": "feature.AdminActivity.Archive.Failed"},
          "to": {"diagramId": "page_adminactivityeditorpage", "stateId": "page.AdminActivityEditorPage.Editing"},
          "meta": {
            "reason": "backToEditorWithMessage | navigate /admin/activities/:activityId/edit",
            "action": "backToEditorWithMessage",
            "navigateTarget": "/admin/activities/:activityId/edit",
            "validations": [
              "下架失敗回編輯頁並顯示訊息；活動狀態保持不變。"
            ]
          }
        }
      ],
      "meta": {
        "pageName": null,
        "featureName": "AdminActivity.Archive",
        "entryStateId": "feature.AdminActivity.Archive.Idle",
        "entryValidations": [
          "僅 Admin 可觸發；非法角色回 403。"
        ]
      }
    },
    {
      "id": "feature_adminregistrations_exportcsv",
      "name": "Feature: AdminRegistrations.ExportCsv",
      "level": "feature",
      "parentDiagramId": "page_entry",
      "roles": ["admin"],
      "variant": {
        "kind": "standalone",
        "baseDiagramId": null,
        "deltaDiagramIdsByRole": {},
        "appliesToRoles": []
      },
      "source": {"type": "mermaid", "sectionTitle": "⑳ Feature: AdminRegistrations.ExportCsv", "order": 20},
      "groups": [],
      "states": [
        {
          "id": "feature.AdminRegistrations.ExportCsv.Idle",
          "label": "Feature.AdminRegistrations.ExportCsv.Idle",
          "type": "start",
          "groupId": null,
          "tags": ["feature", "admin"],
          "meta": {
            "diagramId": "feature_adminregistrations_exportcsv",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.AdminRegistrations.ExportCsv.Idle"}
          }
        },
        {
          "id": "feature.AdminRegistrations.ExportCsv.Submitting",
          "label": "Feature.AdminRegistrations.ExportCsv.Submitting",
          "type": "normal",
          "groupId": null,
          "tags": ["feature", "admin"],
          "meta": {
            "diagramId": "feature_adminregistrations_exportcsv",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.AdminRegistrations.ExportCsv.Submitting"}
          }
        },
        {
          "id": "feature.AdminRegistrations.ExportCsv.Succeeded",
          "label": "Feature.AdminRegistrations.ExportCsv.Succeeded",
          "type": "normal",
          "groupId": null,
          "tags": ["feature", "admin"],
          "meta": {
            "diagramId": "feature_adminregistrations_exportcsv",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.AdminRegistrations.ExportCsv.Succeeded"}
          }
        },
        {
          "id": "feature.AdminRegistrations.ExportCsv.Failed",
          "label": "Feature.AdminRegistrations.ExportCsv.Failed",
          "type": "normal",
          "groupId": null,
          "tags": ["feature", "admin"],
          "meta": {
            "diagramId": "feature_adminregistrations_exportcsv",
            "synthetic": false,
            "source": {"scope": "root", "raw": "Feature.AdminRegistrations.ExportCsv.Failed"}
          }
        }
      ],
      "transitions": [
        {
          "id": "t.feature_adminregistrations_exportcsv.0001",
          "from": "feature.AdminRegistrations.ExportCsv.Idle",
          "to": "feature.AdminRegistrations.ExportCsv.Submitting",
          "event": "requestExport",
          "roles": ["admin"],
          "validations": [
            "呼叫匯出 API；回應為 CSV；檔案內容包含姓名/email/報名時間，且只包含有效報名（canceled_at is null）。"
          ],
          "intent": {"category": "action", "summary": "requestExport"},
          "meta": {
            "diagramId": "feature_adminregistrations_exportcsv",
            "source": {"raw": "Feature.AdminRegistrations.ExportCsv.Idle --> Feature.AdminRegistrations.ExportCsv.Submitting : requestExport"}
          }
        },
        {
          "id": "t.feature_adminregistrations_exportcsv.0002",
          "from": "feature.AdminRegistrations.ExportCsv.Submitting",
          "to": "feature.AdminRegistrations.ExportCsv.Succeeded",
          "event": "apiSuccess(csvStreamed)",
          "roles": ["admin"],
          "validations": [
            "API 回 200 並成功下載；Audit Log 寫 EXPORT_CSV（含 target=activityId）。"
          ],
          "intent": {"category": "action", "summary": "apiSuccess(csvStreamed)"},
          "meta": {
            "diagramId": "feature_adminregistrations_exportcsv",
            "source": {"raw": "Feature.AdminRegistrations.ExportCsv.Submitting --> Feature.AdminRegistrations.ExportCsv.Succeeded : apiSuccess(csvStreamed)"}
          }
        },
        {
          "id": "t.feature_adminregistrations_exportcsv.0003",
          "from": "feature.AdminRegistrations.ExportCsv.Submitting",
          "to": "feature.AdminRegistrations.ExportCsv.Failed",
          "event": "apiFailed",
          "roles": ["admin"],
          "validations": [
            "API 回 4xx/5xx 或網路錯誤；UI 顯示失敗訊息；不得下載空檔當作成功。"
          ],
          "intent": {"category": "action", "summary": "apiFailed"},
          "meta": {
            "diagramId": "feature_adminregistrations_exportcsv",
            "source": {"raw": "Feature.AdminRegistrations.ExportCsv.Submitting --> Feature.AdminRegistrations.ExportCsv.Failed : apiFailed"}
          }
        }
      ],
      "connectors": [
        {
          "id": "c.page_entry.contains.feature_adminregistrations_exportcsv",
          "type": "contains",
          "from": {"diagramId": "page_entry", "stateId": null},
          "to": {"diagramId": "feature_adminregistrations_exportcsv", "stateId": null},
          "meta": {"reason": "derived from parentDiagramId"}
        },
        {
          "id": "c.feature_adminregistrations_exportcsv.invokes.page_adminregistrationspage.s.feature_AdminRegistrations_ExportCsv_Succeeded.a_backToRoster.to.page_AdminRegistrationsPage_Ready",
          "type": "invokes",
          "from": {"diagramId": "feature_adminregistrations_exportcsv", "stateId": "feature.AdminRegistrations.ExportCsv.Succeeded"},
          "to": {"diagramId": "page_adminregistrationspage", "stateId": "page.AdminRegistrationsPage.Ready"},
          "meta": {
            "reason": "backToRoster | navigate /admin/activities/:activityId/registrations",
            "action": "backToRoster",
            "navigateTarget": "/admin/activities/:activityId/registrations",
            "validations": [
              "匯出成功後回名單頁；可提示下載完成或提供檔案連結。"
            ]
          }
        },
        {
          "id": "c.feature_adminregistrations_exportcsv.invokes.page_adminregistrationspage.s.feature_AdminRegistrations_ExportCsv_Failed.a_backToRosterWithError.to.page_AdminRegistrationsPage_Ready",
          "type": "invokes",
          "from": {"diagramId": "feature_adminregistrations_exportcsv", "stateId": "feature.AdminRegistrations.ExportCsv.Failed"},
          "to": {"diagramId": "page_adminregistrationspage", "stateId": "page.AdminRegistrationsPage.Ready"},
          "meta": {
            "reason": "backToRosterWithError | navigate /admin/activities/:activityId/registrations",
            "action": "backToRosterWithError",
            "navigateTarget": "/admin/activities/:activityId/registrations",
            "validations": [
              "匯出失敗仍回名單頁並顯示錯誤；可再次嘗試匯出。"
            ]
          }
        }
      ],
      "meta": {
        "pageName": null,
        "featureName": "AdminRegistrations.ExportCsv",
        "entryStateId": "feature.AdminRegistrations.ExportCsv.Idle",
        "entryValidations": [
          "僅 Admin 可匯出；非 Admin 回 403；匯出入口不在 Header（避免與頁面 CTA 重複）。"
        ]
      }
    },
    {
      "id": "page_21",
      "name": "Global Error & Authorization",
      "level": "page",
      "parentDiagramId": "page_entry",
      "roles": [],
      "variant": {
        "kind": "standalone",
        "baseDiagramId": null,
        "deltaDiagramIdsByRole": {},
        "appliesToRoles": []
      },
      "source": {"type": "mermaid", "sectionTitle": "㉑ 全站錯誤與權限", "order": 21},
      "groups": [],
      "states": [
        {
          "id": "page.GlobalError.Init",
          "label": "GlobalError.Init",
          "type": "start",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_21",
            "synthetic": false,
            "source": {"scope": "root", "raw": "GlobalError.Init"}
          }
        },
        {
          "id": "page.GlobalError.Unauthorized",
          "label": "GlobalError.Unauthorized",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_21",
            "synthetic": false,
            "source": {"scope": "root", "raw": "GlobalError.Unauthorized"}
          }
        },
        {
          "id": "page.GlobalError.Forbidden",
          "label": "GlobalError.Forbidden",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_21",
            "synthetic": false,
            "source": {"scope": "root", "raw": "GlobalError.Forbidden"}
          }
        },
        {
          "id": "page.GlobalError.NotFound",
          "label": "GlobalError.NotFound",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_21",
            "synthetic": false,
            "source": {"scope": "root", "raw": "GlobalError.NotFound"}
          }
        },
        {
          "id": "page.GlobalError.ServerError",
          "label": "GlobalError.ServerError",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_21",
            "synthetic": false,
            "source": {"scope": "root", "raw": "GlobalError.ServerError"}
          }
        },
        {
          "id": "page.GlobalError.Retrying",
          "label": "GlobalError.Retrying",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_21",
            "synthetic": false,
            "source": {"scope": "root", "raw": "GlobalError.Retrying"}
          }
        },
        {
          "id": "page.GlobalError.NavigationVisibility",
          "label": "GlobalError.NavigationVisibility",
          "type": "normal",
          "groupId": null,
          "tags": ["page"],
          "meta": {
            "diagramId": "page_21",
            "synthetic": false,
            "source": {"scope": "root", "raw": "GlobalError.NavigationVisibility"}
          }
        }
      ],
      "transitions": [
        {
          "id": "t.page_21.0001",
          "from": "page.GlobalError.Init",
          "to": "page.GlobalError.Unauthorized",
          "event": "api401",
          "roles": [],
          "validations": [
            "後端回 401 時，前端導向登入；保留 returnTo 指向原頁；登出後再打受保護 API 必回 401。"
          ],
          "intent": {"category": "action", "summary": "api401"},
          "meta": {
            "diagramId": "page_21",
            "source": {"raw": "GlobalError.Init --> GlobalError.Unauthorized : api401"}
          }
        },
        {
          "id": "t.page_21.0002",
          "from": "page.GlobalError.Init",
          "to": "page.GlobalError.Forbidden",
          "event": "api403",
          "roles": [],
          "validations": [
            "後端回 403 時顯示無權限頁；例如 Member 進入 `/admin/*`。"
          ],
          "intent": {"category": "action", "summary": "api403"},
          "meta": {
            "diagramId": "page_21",
            "source": {"raw": "GlobalError.Init --> GlobalError.Forbidden : api403"}
          }
        },
        {
          "id": "t.page_21.0003",
          "from": "page.GlobalError.Init",
          "to": "page.GlobalError.NotFound",
          "event": "api404",
          "roles": [],
          "validations": [
            "404 用於活動不存在或對 Guest/Member 不可見（draft/closed/archived 詳情）；不得用 403 取代此可見性規則。"
          ],
          "intent": {"category": "action", "summary": "api404"},
          "meta": {
            "diagramId": "page_21",
            "source": {"raw": "GlobalError.Init --> GlobalError.NotFound : api404"}
          }
        },
        {
          "id": "t.page_21.0004",
          "from": "page.GlobalError.Init",
          "to": "page.GlobalError.ServerError",
          "event": "api5xx",
          "roles": [],
          "validations": [
            "5xx 顯示系統錯誤；提供重試與回列表；不得顯示技術堆疊或內部訊息。"
          ],
          "intent": {"category": "action", "summary": "api5xx"},
          "meta": {
            "diagramId": "page_21",
            "source": {"raw": "GlobalError.Init --> GlobalError.ServerError : api5xx"}
          }
        },
        {
          "id": "t.page_21.0005",
          "from": "page.GlobalError.ServerError",
          "to": "page.GlobalError.Retrying",
          "event": "clickRetry",
          "roles": [],
          "validations": [
            "點擊重試會再次發起原本的載入動作（或至少重新導回列表載入），避免卡死。"
          ],
          "intent": {"category": "action", "summary": "clickRetry"},
          "meta": {
            "diagramId": "page_21",
            "source": {"raw": "GlobalError.ServerError --> GlobalError.Retrying : clickRetry"}
          }
        },
        {
          "id": "t.page_21.0006",
          "from": "page.GlobalError.Init",
          "to": "page.GlobalError.NavigationVisibility",
          "event": "renderHeader",
          "roles": [],
          "validations": [
            "Header 依登入狀態與角色顯示選項；Guest 不顯示「我的活動」「管理後台」；Member 不顯示「管理後台」。"
          ],
          "intent": {"category": "action", "summary": "renderHeader"},
          "meta": {
            "diagramId": "page_21",
            "source": {"raw": "GlobalError.Init --> GlobalError.NavigationVisibility : renderHeader"}
          }
        },
        {
          "id": "t.page_21.0007",
          "from": "page.GlobalError.NavigationVisibility",
          "to": "page.GlobalError.NavigationVisibility",
          "event": "enforceNavByRole",
          "roles": [],
          "validations": [
            "導覽規則為「不該出現就不出現」而非點擊後才導登入；同一頁不應出現重複 CTA（例如 Header 與頁面各一個登入導向）。"
          ],
          "intent": {"category": "action", "summary": "enforceNavByRole"},
          "meta": {
            "diagramId": "page_21",
            "source": {"raw": "GlobalError.NavigationVisibility --> GlobalError.NavigationVisibility : enforceNavByRole"}
          }
        }
      ],
      "connectors": [
        {
          "id": "c.page_entry.contains.page_21",
          "type": "contains",
          "from": {"diagramId": "page_entry", "stateId": null},
          "to": {"diagramId": "page_21", "stateId": null},
          "meta": {"reason": "derived from parentDiagramId"}
        },
        {
          "id": "c.page_21.invokes.page_login.s.page_GlobalError_Unauthorized.a_redirectToLoginWithReturnTo.to.page_LoginPage_Init",
          "type": "invokes",
          "from": {"diagramId": "page_21", "stateId": "page.GlobalError.Unauthorized"},
          "to": {"diagramId": "page_login", "stateId": "page.LoginPage.Init"},
          "meta": {
            "reason": "redirectToLoginWithReturnTo | navigate /login",
            "action": "redirectToLoginWithReturnTo",
            "navigateTarget": "/login",
            "validations": [
              "需保留 returnTo；登入後能回原頁或回列表（依安全策略）。"
            ]
          }
        },
        {
          "id": "c.page_21.invokes.page_activitylistpage.s.page_GlobalError_Forbidden.a_clickBackToActivities.to.page_ActivityListPage_Loading",
          "type": "invokes",
          "from": {"diagramId": "page_21", "stateId": "page.GlobalError.Forbidden"},
          "to": {"diagramId": "page_activitylistpage", "stateId": "page.ActivityListPage.Loading"},
          "meta": {
            "reason": "clickBackToActivities | navigate /activities",
            "action": "clickBackToActivities",
            "navigateTarget": "/activities",
            "validations": [
              "回列表並重新載入；避免停留在無權限頁。"
            ]
          }
        },
        {
          "id": "c.page_21.invokes.page_activitylistpage.s.page_GlobalError_NotFound.a_clickBackToActivities.to.page_ActivityListPage_Loading",
          "type": "invokes",
          "from": {"diagramId": "page_21", "stateId": "page.GlobalError.NotFound"},
          "to": {"diagramId": "page_activitylistpage", "stateId": "page.ActivityListPage.Loading"},
          "meta": {
            "reason": "clickBackToActivities | navigate /activities",
            "action": "clickBackToActivities",
            "navigateTarget": "/activities",
            "validations": [
              "回列表並重新載入；404 的可見性規則需維持一致。"
            ]
          }
        },
        {
          "id": "c.page_21.invokes.page_activitylistpage.s.page_GlobalError_Retrying.a_retryNavigate.to.page_ActivityListPage_Loading",
          "type": "invokes",
          "from": {"diagramId": "page_21", "stateId": "page.GlobalError.Retrying"},
          "to": {"diagramId": "page_activitylistpage", "stateId": "page.ActivityListPage.Loading"},
          "meta": {
            "reason": "retryNavigate | navigate /activities",
            "action": "retryNavigate",
            "navigateTarget": "/activities",
            "validations": [
              "重試後導回列表載入或重新發起原請求；避免無限重試卡死。"
            ]
          }
        }
      ],
      "meta": {
        "pageName": "GlobalError",
        "featureName": null,
        "entryStateId": "page.GlobalError.Init",
        "entryValidations": [
          "任何頁面/API 發生錯誤都可進入此流程；顯示可理解訊息且不暴露敏感資訊。"
        ]
      }
    }
  ],
  "hierarchy": {
    "roots": ["page_entry"],
    "childrenByDiagramId": {
      "page_entry": [
        "page_login",
        "page_register",
        "page_activitylistpage",
        "page_activitydetailpage",
        "page_myactivitiespage",
        "page_adminactivitylistpage",
        "page_adminactivityeditorpage",
        "page_adminregistrationspage",
        "feature_login",
        "feature_register",
        "feature_logout",
        "feature_registration_register",
        "feature_registration_cancel",
        "feature_adminactivity_save",
        "feature_adminactivity_publish",
        "feature_adminactivity_close",
        "feature_adminactivity_archive",
        "feature_adminregistrations_exportcsv",
        "page_21"
      ],
      "page_adminactivitylistpage": ["page_adminactivitylistpage_admin"]
    }
  },
  "meta": {
    "warnings": [
      "transition.md: '② Login Page' contains cross-diagram transition without '| navigate' (Feature.Login.Failed --> LoginPage.Editing : showError); dropped from transitions/connectors.",
      "transition.md: '③ Register Page' contains cross-diagram transition without '| navigate' (Feature.Register.Failed --> RegisterPage.Editing : showError); dropped from transitions/connectors."
    ]
  }
}
