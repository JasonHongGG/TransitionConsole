{
  "system": "ActivityManagementPlatform",
  "version": "2.0",
  "generatedAt": "2026-02-17T20:15:37.131Z",
  "inputs": {
    "specPath": "StateTranstionDiagram/spec.md",
    "transitionPath": "StateTranstionDiagram/transition.md"
  },
  "spec": {
    "raw": "# 任務 Spec：社團活動管理平台\r\nActivity Management Platform\r\n\r\n---\r\n\r\n## 1. 產品目標（Product Goal）\r\n建立一個供社團成員與幹部使用的活動管理平台，讓使用者能在一致且可控的規則下完成「瀏覽活動 → 查看詳情 → 報名/取消 → 管理報名資訊」。\r\n\r\n使用者可完成的核心行為：\r\n- 瀏覽即將舉辦的活動（僅顯示可公開活動）\r\n- 查看活動詳情（包含剩餘名額與自身報名狀態）\r\n- 報名活動 / 取消報名活動（受活動狀態與截止時間限制）\r\n- 查看「我的活動」清單（只顯示自己已報名的活動）\r\n- 管理員建立/編輯/下架活動、手動關閉報名、查看報名名單並匯出 CSV\r\n\r\n系統必備能力：\r\n- 使用者登入與身分驗證（Token 或 Session）\r\n- 角色權限控管（Member / Admin；角色由系統設定，不可自行切換）\r\n- 活動狀態管理（State Machine：draft/published/full/closed/archived）\r\n- 名額控管與一致性（避免超賣；報名/取消需具備原子性與防重複提交）\r\n- 前後端資料一致性（活動狀態、報名名額、使用者報名狀態需同步）\r\n\r\n補充目標（體驗面）：\r\n- 使用者可清楚看到「是否已報名」與「可用名額/額滿」\r\n- 管理員可快速掌握活動列表與活動的即時報名名單\r\n\r\n---\r\n\r\n## 2. 使用者角色定義（Roles）\r\n\r\n### 2.1 一般使用者（Member）\r\n權限與可執行行為：\r\n- 可瀏覽活動清單（僅顯示 `published` 與 `full`）\r\n- 可查看活動詳情\r\n- 可報名活動（僅限活動 `published` 且未逾 `deadline` 且未額滿）\r\n- 可取消已報名活動（僅限未逾 `deadline` 且活動未結束）\r\n- 可查看自己已報名的活動（「我的活動」）\r\n- 可登出\r\n\r\n限制：\r\n- 同一使用者對同一活動最多只能存在一筆「有效報名」（未取消的 Registration）\r\n- 若活動為 `full/closed/archived/draft`，不可報名\r\n\r\n### 2.2 管理員（Admin）\r\n權限與可執行行為：\r\n- 具備所有 Member 權限\r\n- 可建立活動（草稿/發佈）\r\n- 可編輯活動內容（title/description/date/location/deadline/capacity）\r\n- 可下架活動（進入 `archived`）\r\n- 可手動關閉活動報名（`published/full -> closed`）\r\n- 可查看活動報名名單（姓名 / Email / 報名時間）\r\n- 可匯出活動報名名單為 CSV\r\n\r\n限制：\r\n- 角色由系統設定，不可由使用者自行切換\r\n- 同一帳號不可同時是 Member 與 Admin（`User.role` 為單值 enum）\r\n- 一般公開註冊只建立 Member 帳號；Admin 帳號需由系統/管理流程預先建立（不提供公開註冊成為 Admin）\r\n\r\n---\r\n\r\n## 3. 使用者流程（User Flow）\r\n\r\n### 3.1 一般使用者（Member）流程\r\n1. 以 Email + 密碼註冊（建立 Member）或登入\r\n2. 進入活動列表頁（瀏覽 `published/full` 活動）\r\n3. 點擊活動進入活動詳情頁\r\n4. 若活動可報名且尚未報名：按下「報名」\r\n5. 於「我的活動」頁查看已報名活動（依活動日期排序）\r\n6. 在報名截止前，於活動詳情頁按下「取消報名」釋放名額\r\n7. 完成後可登出\r\n\r\n### 3.2 管理員（Admin）流程\r\n1. 以 Email + 密碼登入（Admin 帳號）\r\n2. 進入管理後台活動列表\r\n3. 建立活動：輸入活動資訊與名額（可先存為草稿 `draft`）\r\n4. 發佈活動：將活動切換為 `published` 使其對外可見並允許報名\r\n5. 視需要編輯活動資訊（仍需滿足 `date > deadline` 等規則）\r\n6. 查看活動報名名單（姓名/Email/報名時間），掌握即時報名狀況\r\n7. 視需要手動關閉報名（`published/full -> closed`）或下架活動（`draft/closed -> archived`）\r\n8. 匯出報名名單 CSV\r\n9. 完成後可登出\r\n\r\n### 3.3 例外流程與錯誤處理（使用者可感知行為）\r\n- 未登入使用者嘗試報名 / 取消報名：\r\n  - API：回傳未授權；前端導向登入頁並保留 returnTo（導回原活動詳情）\r\n  - UI：顯示「請先登入」提示\r\n- 權限不足嘗試進入管理頁：\r\n  - API：回傳禁止；前端顯示無權限提示或導回活動列表\r\n  - UI：管理後台入口不應顯示給非 Admin（不可用「顯示但點了才導登入」替代）\r\n- 活動不存在：\r\n  - UI：顯示找不到活動\r\n- 活動已截止或已結束：\r\n  - UI：禁止報名/取消並顯示原因\r\n\r\n---\r\n\r\n## 4. 功能需求（Functional Requirements）\r\n\r\n### 4.1 帳號與認證\r\n- 使用 Email + 密碼登入\r\n- 密碼必須使用安全雜湊（bcrypt 或 argon2）儲存，不可存明文\r\n- 登入成功後發放可驗證身分的 Token 或建立 Session（伺服器可驗證）\r\n- 需要具備登出功能（使 Token/Session 失效）\r\n- 未登入不可報名活動、不可取消報名、不可進入「我的活動」\r\n- 權限不足者不可進入管理後台\r\n\r\n帳號規則：\r\n- `User.email` 唯一\r\n- `User.role` 為 `member | admin`，且不可由使用者自行切換\r\n- 公開註冊僅能建立 `member`\r\n\r\n### 4.2 活動管理（Activity）\r\n活動欄位（必填/型別/規則）：\r\n- title：字串，必填\r\n- description：多行文字，必填\r\n- date：活動開始時間（含時區），必填\r\n- location：字串，必填\r\n- deadline：報名截止時間（含時區），必填\r\n- capacity：正整數，必填\r\n- status：enum（draft/published/full/closed/archived），必填\r\n\r\n資料規則：\r\n- `date` 必須晚於 `deadline`\r\n- `capacity` 必須為正整數\r\n\r\n活動狀態（State Machine）：\r\n- `draft`：草稿，僅管理員可見\r\n- `published`：已發佈，可對外公開並允許報名（若名額未滿且未逾截止）\r\n- `full`：額滿（系統自動）\r\n- `closed`：報名關閉（管理員手動）\r\n- `archived`：已下架（管理員手動）\r\n\r\n合法狀態轉換（不符合者需拒絕）：\r\n- Admin：`draft -> published`（發佈）\r\n- System：`published -> full`（報名數達上限時自動切換）\r\n- Admin：`published -> closed`（手動關閉報名）\r\n- Admin：`full -> closed`（手動關閉報名）\r\n- Admin：`closed -> archived`（下架）\r\n- Admin：`draft -> archived`（下架草稿）\r\n- System：`full -> published`（取消報名釋放名額且仍未逾截止時，可回到 published）\r\n\r\n狀態限制：\r\n- `status = full` 時不可再報名\r\n- `status != published` 時不可報名\r\n- `status in archived/draft` 不應出現在對外活動列表\r\n\r\n### 4.3 報名系統（Registration）\r\n核心規則：\r\n- 同一使用者對同一活動只能報名一次（以「有效報名」為準：`canceled_at IS NULL`）\r\n- 活動狀態非 `published` 時不可報名\r\n- 報名截止（`now > deadline`）後不可報名、不可取消報名\r\n- 活動結束（`now > date`）後不可取消報名\r\n\r\n名額與狀態連動：\r\n- 報名人數達上限時：\r\n  - 系統自動將活動切換為 `full`\r\n  - 不可再報名\r\n- 取消報名後：\r\n  - 名額需即時釋放（報名數下降）\r\n  - 若活動原為 `full` 且仍未逾截止，且取消後報名數 < capacity：系統可回到 `published`\r\n\r\n一致性要求（避免超賣 / 防重複）：\r\n- 報名與取消必須使用交易或原子操作確保：\r\n  - 不會同時被多個請求把名額扣到超過 capacity\r\n  - 活動狀態（published/full）與報名數同步\r\n- 報名需防重複提交（idempotent）：\r\n  - 若使用者重複送出「報名」請求，系統必須回傳一致結果（例如回傳既有有效報名）而不是建立第二筆\r\n  - 取消報名重複提交亦需回傳一致結果（例如已取消則回傳已取消狀態）\r\n- 資料庫層級必須有唯一性保障：\r\n  - 至少保證「同一 user_id + activity_id」不可存在兩筆同時有效的報名\r\n\r\n### 4.4 活動列表頁（Activity List）\r\n顯示範圍：\r\n- 只顯示 `published` 與 `full` 活動\r\n\r\n顯示資訊：\r\n- 活動名稱\r\n- 日期\r\n- 地點\r\n- 目前報名人數 / 名額上限\r\n- 報名狀態（依使用者身分顯示）：\r\n  - Guest：可報名 / 額滿（僅顯示活動狀態，不顯示「已報名」）\r\n  - Member/Admin：可報名 / 已報名 / 額滿\r\n\r\n主要互動：\r\n- 點擊活動進入活動詳情\r\n\r\nPage-level 狀態：\r\n- Loading：載入活動列表中（顯示 loading）\r\n- Empty：目前無可公開活動\r\n- Failed：載入失敗（顯示錯誤與重試入口）\r\n\r\n### 4.5 活動詳情頁（Activity Detail）\r\n顯示內容：\r\n- 顯示完整活動資訊（title/description/date/location/deadline/capacity/目前報名人數/status）\r\n- 顯示剩餘名額（capacity - currentRegistrationsCount）\r\n\r\n依使用者狀態顯示 CTA：\r\n- Guest：顯示「登入後可報名」提示（可提供導向登入）\r\n- Member/Admin：\r\n  - 若活動可報名且尚未報名：顯示「報名」按鈕\r\n  - 若已報名且可取消：顯示「取消報名」按鈕\r\n  - 若額滿：顯示「已額滿」提示並禁用報名\r\n  - 若已截止或已結束：顯示原因並禁用相關操作\r\n\r\nPage-level 狀態：\r\n- Loading：載入活動詳情中\r\n- NotFound：活動不存在\r\n- Failed：載入失敗\r\n\r\n### 4.6 我的活動頁（My Activities）\r\n範圍與排序：\r\n- 僅顯示使用者已報名（有效報名）的活動\r\n- 依活動日期排序（由近到遠）\r\n\r\n顯示狀態：\r\n- 即將開始（now <= date）\r\n- 已結束（now > date）\r\n\r\n主要互動：\r\n- 點擊活動進入活動詳情\r\n\r\nPage-level 狀態：\r\n- Loading：載入中\r\n- Empty：尚未報名任何活動\r\n- Failed：載入失敗\r\n\r\n### 4.7 管理後台（Admin Panel）\r\n後台頁面功能拆分：\r\n- 活動管理列表（活動 CRUD 入口、草稿/已發佈/關閉/下架等狀態檢視）\r\n- 活動建立/編輯頁（表單）\r\n- 活動報名名單頁（查看名單、匯出 CSV、手動關閉報名/下架）\r\n\r\n活動 CRUD：\r\n- 建立活動：最少需輸入 title/description/date/location/deadline/capacity\r\n- 編輯活動：需保持 `date > deadline`、capacity 正整數\r\n- 下架活動：僅允許 `draft` 或 `closed` 下架為 `archived`\r\n- 手動關閉報名：允許 `published/full -> closed`\r\n\r\n查看報名名單：\r\n- 顯示欄位：姓名 / Email / 報名時間\r\n- 僅列出有效報名（未取消）\r\n\r\n匯出 CSV：\r\n- 下載內容需與畫面名單一致（相同排序與欄位）\r\n\r\nPage-level 狀態（後台頁通用）：\r\n- Loading：載入中\r\n- Empty：列表無資料（例如尚無活動、或無報名）\r\n- Failed：載入/操作失敗\r\n\r\n#### 4.7.x 資訊架構與導覽（必填）\r\n\r\n頁面清單（Page Inventory）：\r\n- 活動列表頁：用途=瀏覽公開活動；Route=`/activities`\r\n- 活動詳情頁：用途=查看活動與報名操作；Route=`/activities/:activityId`\r\n- 我的活動頁：用途=查看已報名活動；Route=`/my-activities`\r\n- 登入頁：用途=登入取得身分；Route=`/login`\r\n- 註冊頁：用途=建立 Member；Route=`/register`\r\n- 管理後台活動列表：用途=管理活動；Route=`/admin/activities`\r\n- 管理後台活動建立頁：用途=建立活動；Route=`/admin/activities/new`\r\n- 管理後台活動編輯頁：用途=編輯活動；Route=`/admin/activities/:activityId/edit`\r\n- 管理後台報名名單頁：用途=查看/匯出名單與關閉/下架；Route=`/admin/activities/:activityId/registrations`\r\n\r\n路由存取控制（Route Access Control）：\r\n- `/activities`：Guest=允許；Member=允許；Admin=允許\r\n- `/activities/:activityId`：Guest=允許；Member=允許；Admin=允許\r\n- `/my-activities`：Guest=不允許（導向 `/login`，保留 returnTo）；Member=允許；Admin=允許\r\n- `/login`：Guest=允許；Member=不允許（導向 `/activities`）；Admin=不允許（導向 `/activities`）\r\n- `/register`：Guest=允許（僅建立 Member）；Member=不允許（導向 `/activities`）；Admin=不允許（導向 `/activities`）\r\n- `/admin/*`：Guest=不允許（導向 `/login`，保留 returnTo）；Member=不允許（顯示 Forbidden 或導回 `/activities` 並提示無權限）；Admin=允許\r\n\r\n導覽列/Header 規則（Navigation Visibility Rules）：\r\n- Guest Header：\r\n  - 顯示：活動（/activities）、登入（/login）、註冊（/register）\r\n  - 不顯示：我的活動、管理後台、登出\r\n- Member Header：\r\n  - 顯示：活動（/activities）、我的活動（/my-activities）、登出\r\n  - 不顯示：註冊、管理後台\r\n- Admin Header：\r\n  - 顯示：活動（/activities）、我的活動（/my-activities）、管理後台（/admin/activities）、登出\r\n  - 不顯示：註冊\r\n\r\n全站共用元件責任（Layout Responsibility）：\r\n- Header：只提供全站主要導覽與登入/登出入口；需依角色隱藏不該出現的選項\r\n- Page 內 CTA：\r\n  - 活動列表頁：主要 CTA 為「進入詳情」；不在列表頁提供報名/取消（避免多處入口）\r\n  - 活動詳情頁：唯一提供「報名/取消」入口（避免 Header 重複顯示相同操作）\r\n  - 管理後台：CRUD/狀態變更/匯出入口均在後台頁面內提供，不放在 Header\r\n\r\n---\r\n\r\n## 5. 非功能需求（Non-functional Requirements）\r\n- RWD（支援桌機與手機）\r\n- 基本錯誤處理（未授權/禁止/不存在/一般失敗）：\r\n  - 使用者需看到可理解的提示\r\n  - 受保護路由需支援 returnTo\r\n- 操作需有 loading 與錯誤提示：\r\n  - 表單送出期間需禁用主要按鈕、防止重複送出\r\n  - 失敗需能重試（若適用）\r\n- 一致性與併發：\r\n  - 報名/取消需保證不超賣\r\n  - 活動狀態（published/full/closed）與報名數一致\r\n- 系統時間以同一時區為準：\r\n  - 系統需有預設時區設定\r\n  - 所有「deadline/date」判斷使用相同時區來源\r\n- 紀錄重要操作（Audit Log）：\r\n  - 活動建立/修改/狀態變更\r\n  - 報名/取消\r\n  - 匯出 CSV\r\n  - 登入/登出（至少成功/失敗的摘要）\r\n- 安全性：\r\n  - 密碼雜湊\r\n  - 需避免未授權存取（RBAC）\r\n  - 重要操作需在伺服器端再次驗證權限與規則（不可只依前端）\r\n\r\n---\r\n\r\n## 6. 資料模型（Conceptual Data Model）\r\n\r\n### User\r\n- id：UUID/整數\r\n- name：字串（顯示名稱）\r\n- email：字串（唯一）\r\n- role：enum（member | admin）\r\n- password_hash：字串\r\n- created_at：時間\r\n\r\n索引/約束：\r\n- `email` unique\r\n\r\n### Activity\r\n- id：UUID/整數\r\n- title：字串\r\n- description：文字\r\n- date：時間（含時區語意）\r\n- location：字串\r\n- capacity：正整數\r\n- status：enum（draft | published | full | closed | archived）\r\n- deadline：時間（含時區語意）\r\n- created_by：User.id（Admin）\r\n- created_at：時間\r\n- updated_at：時間\r\n\r\n索引/約束：\r\n- `date > deadline`\r\n- `capacity > 0`\r\n\r\n### Registration\r\n- id：UUID/整數\r\n- user_id：User.id\r\n- activity_id：Activity.id\r\n- created_at：時間（報名時間）\r\n- canceled_at：時間（nullable；取消時間）\r\n\r\n索引/約束：\r\n- 至少需確保同一使用者同一活動不會有兩筆同時有效報名\r\n  - 概念約束：對相同 `user_id + activity_id`，最多一筆 `canceled_at IS NULL`\r\n\r\n### 關聯\r\n- User 1:N Activity（created_by）\r\n- User 1:N Registration\r\n- Activity 1:N Registration\r\n\r\n衍生/計算（不一定需要存欄位，但必須可取得）：\r\n- Activity.currentRegistrationsCount：有效報名數（`canceled_at IS NULL`）\r\n- Activity.isFull：currentRegistrationsCount >= capacity\r\n",
    "summary": {
      "productName": "社團活動管理平台",
      "goals": [
        "瀏覽即將舉辦的活動（僅顯示可公開活動）",
        "查看活動詳情（包含剩餘名額與自身報名狀態）",
        "報名活動 / 取消報名活動（受活動狀態與截止時間限制）",
        "查看「我的活動」清單（只顯示自己已報名的活動）",
        "管理員建立/編輯/下架活動、手動關閉報名、查看報名名單並匯出 CSV"
      ],
      "roles": [
        {
          "id": "guest",
          "label": "Guest"
        },
        {
          "id": "member",
          "label": "Member"
        },
        {
          "id": "admin",
          "label": "Admin"
        }
      ]
    }
  },
  "diagrams": [
    {
      "id": "page_entry",
      "name": "Entry",
      "level": "page",
      "parentDiagramId": null,
      "roles": [],
      "variant": {
        "kind": "standalone",
        "baseDiagramId": null,
        "deltaDiagramIdsByRole": {},
        "appliesToRoles": []
      },
      "source": {
        "type": "mermaid",
        "sectionTitle": "① Entry State Machine",
        "order": 1
      },
      "groups": [],
      "states": [
        {
          "id": "page.Entry.Init",
          "label": "Entry.Init",
          "type": "start",
          "groupId": null,
          "tags": [
            "page"
          ],
          "meta": {
            "diagramId": "page_entry",
            "synthetic": false,
            "source": {
              "scope": "root",
              "raw": "Entry.Init"
            }
          }
        }
      ],
      "transitions": [
        {
          "id": "t.page_entry.0001",
          "from": "page.Entry.Init",
          "to": "page.Entry.Init",
          "event": "enterApp",
          "roles": [],
          "narrative": {
            "summary": "進入應用入口",
            "taskDescription": "觸發 enterApp 進站初始化，顯示入口畫面並提供訪客/登入/註冊三種明確入口選項。"
          },
          "validations": [
            {
              "id": "v.t.page_entry.0001.01",
              "type": "semantic-check",
              "description": "UI 進站畫面提供三個明確入口（以訪客繼續/登入/註冊）；不做任何既有 session/token 自動偵測分流。",
              "expected": null
            }
          ],
          "intent": {
            "category": "action",
            "summary": "enterApp"
          },
          "meta": {
            "diagramId": "page_entry",
            "source": {
              "raw": "[*] --> Entry.Init : enterApp"
            }
          }
        }
      ],
      "connectors": [
        {
          "id": "c.page_entry.contains.page_login",
          "type": "contains",
          "from": {
            "diagramId": "page_entry",
            "stateId": null
          },
          "to": {
            "diagramId": "page_login",
            "stateId": null
          },
          "narrative": {
            "summary": "Entry 與 Login Page 存在階層關係",
            "taskDescription": "建立 parent/child 關聯，表示 page_login 受 page_entry 統轄。"
          },
          "validations": [],
          "meta": {
            "reason": "derived from parentDiagramId"
          }
        },
        {
          "id": "c.page_entry.contains.page_register",
          "type": "contains",
          "from": {
            "diagramId": "page_entry",
            "stateId": null
          },
          "to": {
            "diagramId": "page_register",
            "stateId": null
          },
          "narrative": {
            "summary": "Entry 與 Register Page 存在階層關係",
            "taskDescription": "建立 parent/child 關聯，表示 page_register 受 page_entry 統轄。"
          },
          "validations": [],
          "meta": {
            "reason": "derived from parentDiagramId"
          }
        },
        {
          "id": "c.page_entry.contains.page_activity_list_guest",
          "type": "contains",
          "from": {
            "diagramId": "page_entry",
            "stateId": null
          },
          "to": {
            "diagramId": "page_activity_list_guest",
            "stateId": null
          },
          "narrative": {
            "summary": "Entry 與 Activity List（Guest）存在階層關係",
            "taskDescription": "建立 parent/child 關聯，表示 page_activity_list_guest 受 page_entry 統轄。"
          },
          "validations": [],
          "meta": {
            "reason": "derived from parentDiagramId"
          }
        },
        {
          "id": "c.page_entry.invokes.page_activity_list_guest.s.page_Entry_Init.to.page_ActivityListPage_guest_Init",
          "type": "invokes",
          "from": {
            "diagramId": "page_entry",
            "stateId": "page.Entry.Init"
          },
          "to": {
            "diagramId": "page_activity_list_guest",
            "stateId": null
          },
          "narrative": {
            "summary": "以訪客身份進入活動列表",
            "taskDescription": "在 Entry.Init 觸發 continueAsGuest 導航到 /activities，並進入 ActivityListPage 的 Guest.Init 狀態。"
          },
          "validations": [
            {
              "id": "v.c.page_entry.invokes.page_activity_list_guest.01",
              "type": "url-equals",
              "description": "導向 `/activities` 並顯示公開活動列表；Header 僅顯示「活動/登入/註冊」，不顯示「我的活動/管理後台/登出」。",
              "expected": "/activities"
            }
          ],
          "meta": {
            "reason": "continueAsGuest | navigate /activities",
            "action": "continueAsGuest",
            "navigateTarget": "/activities"
          }
        },
        {
          "id": "c.page_entry.invokes.page_login.s.page_Entry_Init.to.page_LoginPage_guest_Init",
          "type": "invokes",
          "from": {
            "diagramId": "page_entry",
            "stateId": "page.Entry.Init"
          },
          "to": {
            "diagramId": "page_login",
            "stateId": null
          },
          "narrative": {
            "summary": "從入口進入登入頁",
            "taskDescription": "在 Entry.Init 觸發 chooseLogin 導航到 /login，並進入 LoginPage 的 Init 狀態。"
          },
          "validations": [
            {
              "id": "v.c.page_entry.invokes.page_login.01",
              "type": "url-equals",
              "description": "導向 `/login` 並顯示登入表單；Header 不應同時重複出現第二個登入入口（避免 Header + Page 重複 CTA）。",
              "expected": "/login"
            }
          ],
          "meta": {
            "reason": "chooseLogin | navigate /login",
            "action": "chooseLogin",
            "navigateTarget": "/login"
          }
        },
        {
          "id": "c.page_entry.invokes.page_register.s.page_Entry_Init.to.page_RegisterPage_guest_Init",
          "type": "invokes",
          "from": {
            "diagramId": "page_entry",
            "stateId": "page.Entry.Init"
          },
          "to": {
            "diagramId": "page_register",
            "stateId": null
          },
          "narrative": {
            "summary": "從入口進入註冊頁",
            "taskDescription": "在 Entry.Init 觸發 chooseRegister 導航到 /register，並進入 RegisterPage 的 Init 狀態。"
          },
          "validations": [
            {
              "id": "v.c.page_entry.invokes.page_register.01",
              "type": "url-equals",
              "description": "導向 `/register` 並顯示註冊表單（僅建立 Member）；Header 不應同時重複出現第二個註冊入口（避免 Header + Page 重複 CTA）。",
              "expected": "/register"
            }
          ],
          "meta": {
            "reason": "chooseRegister | navigate /register",
            "action": "chooseRegister",
            "navigateTarget": "/register"
          }
        },
        {
          "id": "c.page_entry.contains.page_activity_list_member",
          "type": "contains",
          "from": {
            "diagramId": "page_entry",
            "stateId": null
          },
          "to": {
            "diagramId": "page_activity_list_member",
            "stateId": null
          },
          "meta": {
            "reason": "derived from parentDiagramId"
          }
        },
        {
          "id": "c.page_entry.contains.page_activity_list_admin",
          "type": "contains",
          "from": {
            "diagramId": "page_entry",
            "stateId": null
          },
          "to": {
            "diagramId": "page_activity_list_admin",
            "stateId": null
          },
          "meta": {
            "reason": "derived from parentDiagramId"
          }
        },
        {
          "id": "c.page_entry.contains.page_activity_detail_guest",
          "type": "contains",
          "from": {
            "diagramId": "page_entry",
            "stateId": null
          },
          "to": {
            "diagramId": "page_activity_detail_guest",
            "stateId": null
          },
          "meta": {
            "reason": "derived from parentDiagramId"
          }
        },
        {
          "id": "c.page_entry.contains.page_activity_detail_member",
          "type": "contains",
          "from": {
            "diagramId": "page_entry",
            "stateId": null
          },
          "to": {
            "diagramId": "page_activity_detail_member",
            "stateId": null
          },
          "meta": {
            "reason": "derived from parentDiagramId"
          }
        },
        {
          "id": "c.page_entry.contains.page_activity_detail_admin",
          "type": "contains",
          "from": {
            "diagramId": "page_entry",
            "stateId": null
          },
          "to": {
            "diagramId": "page_activity_detail_admin",
            "stateId": null
          },
          "meta": {
            "reason": "derived from parentDiagramId"
          }
        }
      ],
      "meta": {
        "pageName": "Entry",
        "featureName": null,
        "entryStateId": "page.Entry.Init"
      }
    },
    {
      "id": "page_login",
      "name": "Login Page",
      "level": "page",
      "parentDiagramId": "page_entry",
      "roles": [
        "guest"
      ],
      "variant": {
        "kind": "standalone",
        "baseDiagramId": null,
        "deltaDiagramIdsByRole": {},
        "appliesToRoles": []
      },
      "source": {
        "type": "mermaid",
        "sectionTitle": "② Login Page",
        "order": 2
      },
      "groups": [],
      "states": [
        {
          "id": "page.LoginPage.guest.Init",
          "label": "LoginPage.Init",
          "type": "start",
          "groupId": null,
          "tags": [
            "page",
            "guest"
          ],
          "meta": {
            "diagramId": "page_login",
            "synthetic": false,
            "source": {
              "scope": "root",
              "raw": "LoginPage.Init"
            }
          }
        },
        {
          "id": "page.LoginPage.guest.Ready",
          "label": "LoginPage.Ready",
          "type": "normal",
          "groupId": null,
          "tags": [
            "page",
            "guest"
          ],
          "meta": {
            "diagramId": "page_login",
            "synthetic": false,
            "source": {
              "scope": "root",
              "raw": "LoginPage.Ready"
            }
          }
        }
      ],
      "transitions": [
        {
          "id": "t.page_login.0001",
          "from": "page.LoginPage.guest.Init",
          "to": "page.LoginPage.guest.Init",
          "event": "enterPage",
          "roles": [
            "guest"
          ],
          "narrative": {
            "summary": "進入登入頁",
            "taskDescription": "導向 /login 時顯示登入頁初始化狀態；若使用者已登入則應導回 /activities 並提示已登入。"
          },
          "validations": [
            {
              "id": "v.t.page_login.0001.01",
              "type": "semantic-check",
              "description": "進入 `/login` 時顯示登入頁；若已登入（Member/Admin）嘗試進入，前端導回 `/activities` 並在 UI 明確提示「已登入」或直接不提供登入頁入口。",
              "expected": null
            }
          ],
          "intent": {
            "category": "action",
            "summary": "enterPage"
          },
          "meta": {
            "diagramId": "page_login",
            "source": {
              "raw": "[*] --> LoginPage.Init : enterPage"
            }
          }
        },
        {
          "id": "t.page_login.0002",
          "from": "page.LoginPage.guest.Init",
          "to": "page.LoginPage.guest.Ready",
          "event": "showLoginForm",
          "roles": [
            "guest"
          ],
          "narrative": {
            "summary": "顯示登入表單",
            "taskDescription": "在登入頁初始化後，渲染 Email/密碼欄位並讓使用者可提交登入。"
          },
          "validations": [
            {
              "id": "v.t.page_login.0002.01",
              "type": "semantic-check",
              "description": "登入表單包含 Email/密碼欄位；送出前按鈕可用；表單區域不與 Header 重複顯示登入按鈕。",
              "expected": null
            }
          ],
          "intent": {
            "category": "action",
            "summary": "showLoginForm"
          },
          "meta": {
            "diagramId": "page_login",
            "source": {
              "raw": "LoginPage.Init --> LoginPage.Ready : showLoginForm"
            }
          }
        }
      ],
      "connectors": [
        {
          "id": "c.page_entry.contains.page_login",
          "type": "contains",
          "from": {
            "diagramId": "page_entry",
            "stateId": null
          },
          "to": {
            "diagramId": "page_login",
            "stateId": null
          },
          "narrative": {
            "summary": "Entry 與 Login Page 存在階層關係",
            "taskDescription": "建立 parent/child 關聯，表示 page_login 受 page_entry 統轄。"
          },
          "validations": [],
          "meta": {
            "reason": "derived from parentDiagramId"
          }
        },
        {
          "id": "c.page_login.invokes.page_register.s.page_LoginPage_guest_Ready.to.page_RegisterPage_guest_Init",
          "type": "invokes",
          "from": {
            "diagramId": "page_login",
            "stateId": "page.LoginPage.guest.Ready"
          },
          "to": {
            "diagramId": "page_register",
            "stateId": null
          },
          "narrative": {
            "summary": "從登入頁改走註冊",
            "taskDescription": "在 LoginPage.Ready 觸發 chooseRegister 導航到 /register，並進入 RegisterPage.Init。"
          },
          "validations": [
            {
              "id": "v.c.page_login.invokes.page_register.01",
              "type": "url-equals",
              "description": "導向 `/register` 並保留 returnTo（若有）；UI 不遺失使用者原本想前往的目標頁資訊。",
              "expected": "/register"
            }
          ],
          "meta": {
            "reason": "chooseRegister | navigate /register",
            "action": "chooseRegister",
            "navigateTarget": "/register"
          }
        },
        {
          "id": "c.page_login.invokes.page_activity_list_guest.s.page_LoginPage_guest_Ready.to.page_ActivityListPage_guest_Init",
          "type": "invokes",
          "from": {
            "diagramId": "page_login",
            "stateId": "page.LoginPage.guest.Ready"
          },
          "to": {
            "diagramId": "page_activity_list_guest",
            "stateId": null
          },
          "narrative": {
            "summary": "取消登入回到公開活動列表",
            "taskDescription": "在 LoginPage.Ready 觸發 cancelLogin 導航到 /activities，並以 Guest 視角進入活動列表初始化狀態。"
          },
          "validations": [
            {
              "id": "v.c.page_login.invokes.page_activity_list_guest.01",
              "type": "url-equals",
              "description": "導回 `/activities` 並仍以 Guest 身分呈現；Header 仍僅顯示「活動/登入/註冊」。",
              "expected": "/activities"
            }
          ],
          "meta": {
            "reason": "cancelLogin | navigate /activities",
            "action": "cancelLogin",
            "navigateTarget": "/activities"
          }
        }
      ],
      "meta": {
        "pageName": "LoginPage",
        "featureName": null,
        "entryStateId": "page.LoginPage.guest.Init"
      }
    },
    {
      "id": "page_register",
      "name": "Register Page",
      "level": "page",
      "parentDiagramId": "page_entry",
      "roles": [
        "guest"
      ],
      "variant": {
        "kind": "standalone",
        "baseDiagramId": null,
        "deltaDiagramIdsByRole": {},
        "appliesToRoles": []
      },
      "source": {
        "type": "mermaid",
        "sectionTitle": "③ Register Page",
        "order": 3
      },
      "groups": [],
      "states": [
        {
          "id": "page.RegisterPage.guest.Init",
          "label": "RegisterPage.Init",
          "type": "start",
          "groupId": null,
          "tags": [
            "page",
            "guest"
          ],
          "meta": {
            "diagramId": "page_register",
            "synthetic": false,
            "source": {
              "scope": "root",
              "raw": "RegisterPage.Init"
            }
          }
        },
        {
          "id": "page.RegisterPage.guest.Ready",
          "label": "RegisterPage.Ready",
          "type": "normal",
          "groupId": null,
          "tags": [
            "page",
            "guest"
          ],
          "meta": {
            "diagramId": "page_register",
            "synthetic": false,
            "source": {
              "scope": "root",
              "raw": "RegisterPage.Ready"
            }
          }
        }
      ],
      "transitions": [
        {
          "id": "t.page_register.0001",
          "from": "page.RegisterPage.guest.Init",
          "to": "page.RegisterPage.guest.Init",
          "event": "enterPage",
          "roles": [
            "guest"
          ],
          "narrative": {
            "summary": "進入註冊頁",
            "taskDescription": "導向 /register 時顯示註冊頁初始化狀態；僅提供建立 Member；若已登入則導回 /activities。"
          },
          "validations": [
            {
              "id": "v.t.page_register.0001.01",
              "type": "semantic-check",
              "description": "進入 `/register` 顯示註冊頁；註冊流程只建立 Member，不提供建立 Admin 的選項；若已登入嘗試進入則導回 `/activities`。",
              "expected": null
            }
          ],
          "intent": {
            "category": "action",
            "summary": "enterPage"
          },
          "meta": {
            "diagramId": "page_register",
            "source": {
              "raw": "[*] --> RegisterPage.Init : enterPage"
            }
          }
        },
        {
          "id": "t.page_register.0002",
          "from": "page.RegisterPage.guest.Init",
          "to": "page.RegisterPage.guest.Ready",
          "event": "showRegisterForm",
          "roles": [
            "guest"
          ],
          "narrative": {
            "summary": "顯示註冊表單",
            "taskDescription": "在註冊頁初始化後，渲染 name/email/密碼欄位並讓使用者可提交註冊。"
          },
          "validations": [
            {
              "id": "v.t.page_register.0002.01",
              "type": "semantic-check",
              "description": "註冊表單至少包含 name/email/密碼欄位；送出前按鈕可用；不與 Header 重複顯示註冊入口。",
              "expected": null
            }
          ],
          "intent": {
            "category": "action",
            "summary": "showRegisterForm"
          },
          "meta": {
            "diagramId": "page_register",
            "source": {
              "raw": "RegisterPage.Init --> RegisterPage.Ready : showRegisterForm"
            }
          }
        }
      ],
      "connectors": [
        {
          "id": "c.page_entry.contains.page_register",
          "type": "contains",
          "from": {
            "diagramId": "page_entry",
            "stateId": null
          },
          "to": {
            "diagramId": "page_register",
            "stateId": null
          },
          "narrative": {
            "summary": "Entry 與 Register Page 存在階層關係",
            "taskDescription": "建立 parent/child 關聯，表示 page_register 受 page_entry 統轄。"
          },
          "validations": [],
          "meta": {
            "reason": "derived from parentDiagramId"
          }
        },
        {
          "id": "c.page_register.invokes.page_login.s.page_RegisterPage_guest_Ready.to.page_LoginPage_guest_Init",
          "type": "invokes",
          "from": {
            "diagramId": "page_register",
            "stateId": "page.RegisterPage.guest.Ready"
          },
          "to": {
            "diagramId": "page_login",
            "stateId": "page.LoginPage.guest.Init"
          },
          "narrative": {
            "summary": "從註冊頁改走登入",
            "taskDescription": "在 RegisterPage.Ready 觸發 chooseLogin 導航到 /login，並進入 LoginPage.Init。"
          },
          "validations": [
            {
              "id": "v.c.page_register.invokes.page_login.01",
              "type": "url-equals",
              "description": "導向 `/login` 並保留 returnTo（若有）；不新增不必要的頁面或流程。",
              "expected": "/login"
            }
          ],
          "meta": {
            "reason": "chooseLogin | navigate /login",
            "action": "chooseLogin",
            "navigateTarget": "/login"
          }
        },
        {
          "id": "c.page_register.invokes.page_activity_list_guest.s.page_RegisterPage_guest_Ready.to.page_ActivityListPage_guest_Init",
          "type": "invokes",
          "from": {
            "diagramId": "page_register",
            "stateId": "page.RegisterPage.guest.Ready"
          },
          "to": {
            "diagramId": "page_activity_list_guest",
            "stateId": null
          },
          "narrative": {
            "summary": "取消註冊回到公開活動列表",
            "taskDescription": "在 RegisterPage.Ready 觸發 cancelRegister 導航到 /activities，並以 Guest 視角進入活動列表初始化狀態。"
          },
          "validations": [
            {
              "id": "v.c.page_register.invokes.page_activity_list_guest.01",
              "type": "url-equals",
              "description": "導回 `/activities` 並仍為 Guest；Header 仍僅顯示「活動/登入/註冊」。",
              "expected": "/activities"
            }
          ],
          "meta": {
            "reason": "cancelRegister | navigate /activities",
            "action": "cancelRegister",
            "navigateTarget": "/activities"
          }
        }
      ],
      "meta": {
        "pageName": "RegisterPage",
        "featureName": null,
        "entryStateId": "page.RegisterPage.guest.Init"
      }
    },
    {
      "id": "page_activity_list_guest",
      "name": "Activity List Page (Guest)",
      "level": "page",
      "parentDiagramId": "page_entry",
      "roles": [
        "guest"
      ],
      "variant": {
        "kind": "standalone",
        "baseDiagramId": null,
        "deltaDiagramIdsByRole": {},
        "appliesToRoles": []
      },
      "source": {
        "type": "mermaid",
        "sectionTitle": "④ Activity List Page - Guest",
        "order": 4
      },
      "groups": [],
      "states": [
        {
          "id": "page.ActivityListPage.guest.Init",
          "label": "ActivityListPage.Guest.Init",
          "type": "start",
          "groupId": null,
          "tags": [
            "page",
            "guest"
          ],
          "meta": {
            "diagramId": "page_activity_list_guest",
            "synthetic": false,
            "source": {
              "scope": "root",
              "raw": "ActivityListPage.Guest.Init"
            }
          }
        },
        {
          "id": "page.ActivityListPage.guest.Ready",
          "label": "ActivityListPage.Guest.Ready",
          "type": "normal",
          "groupId": null,
          "tags": [
            "page",
            "guest"
          ],
          "meta": {
            "diagramId": "page_activity_list_guest",
            "synthetic": false,
            "source": {
              "scope": "root",
              "raw": "ActivityListPage.Guest.Ready"
            }
          }
        },
        {
          "id": "page.ActivityListPage.guest.Empty",
          "label": "ActivityListPage.Guest.Empty",
          "type": "normal",
          "groupId": null,
          "tags": [
            "page",
            "guest"
          ],
          "meta": {
            "diagramId": "page_activity_list_guest",
            "synthetic": false,
            "source": {
              "scope": "root",
              "raw": "ActivityListPage.Guest.Empty"
            }
          }
        },
        {
          "id": "page.ActivityListPage.guest.Failed",
          "label": "ActivityListPage.Guest.Failed",
          "type": "normal",
          "groupId": null,
          "tags": [
            "page",
            "guest"
          ],
          "meta": {
            "diagramId": "page_activity_list_guest",
            "synthetic": false,
            "source": {
              "scope": "root",
              "raw": "ActivityListPage.Guest.Failed"
            }
          }
        }
      ],
      "transitions": [
        {
          "id": "t.page_activity_list_guest.0001",
          "from": "page.ActivityListPage.guest.Init",
          "to": "page.ActivityListPage.guest.Init",
          "event": "enterPage",
          "roles": [
            "guest"
          ],
          "narrative": {
            "summary": "以訪客視角進入活動列表",
            "taskDescription": "導向 /activities 時以 Guest 呈現，初始化列表頁並遵循 Guest 導覽列可見性規則。"
          },
          "validations": [
            {
              "id": "v.t.page_activity_list_guest.0001.01",
              "type": "url-equals",
              "description": "進入 `/activities` 時以 Guest 呈現；Header 不顯示「我的活動/管理後台/登出」。",
              "expected": "/activities"
            }
          ],
          "intent": {
            "category": "action",
            "summary": "enterPage"
          },
          "meta": {
            "diagramId": "page_activity_list_guest",
            "source": {
              "raw": "[*] --> ActivityListPage.Guest.Init : enterPage"
            }
          }
        },
        {
          "id": "t.page_activity_list_guest.0002",
          "from": "page.ActivityListPage.guest.Init",
          "to": "page.ActivityListPage.guest.Ready",
          "event": "loadActivities",
          "roles": [
            "guest"
          ],
          "narrative": {
            "summary": "載入公開活動列表",
            "taskDescription": "呼叫活動列表 API，成功後顯示活動清單與必要欄位資訊。"
          },
          "validations": [
            {
              "id": "v.t.page_activity_list_guest.0002.01",
              "type": "semantic-check",
              "description": "API 成功回傳活動列表且只包含 `published` 與 `full`；UI 顯示活動名稱/日期/地點/目前報名人數與容量；Guest 不顯示「已報名」狀態。",
              "expected": null
            }
          ],
          "intent": {
            "category": "action",
            "summary": "loadActivities"
          },
          "meta": {
            "diagramId": "page_activity_list_guest",
            "source": {
              "raw": "ActivityListPage.Guest.Init --> ActivityListPage.Guest.Ready : loadActivities"
            }
          }
        },
        {
          "id": "t.page_activity_list_guest.0003",
          "from": "page.ActivityListPage.guest.Init",
          "to": "page.ActivityListPage.guest.Empty",
          "event": "loadEmpty",
          "roles": [
            "guest"
          ],
          "narrative": {
            "summary": "載入後無公開活動",
            "taskDescription": "活動列表 API 成功但無資料時，切換到 Empty 狀態並顯示空畫面提示。"
          },
          "validations": [
            {
              "id": "v.t.page_activity_list_guest.0003.01",
              "type": "semantic-check",
              "description": "API 成功但無資料時顯示 Empty 狀態（例如「目前沒有可公開活動」）；仍可透過 Header 進行登入/註冊。",
              "expected": null
            }
          ],
          "intent": {
            "category": "action",
            "summary": "loadEmpty"
          },
          "meta": {
            "diagramId": "page_activity_list_guest",
            "source": {
              "raw": "ActivityListPage.Guest.Init --> ActivityListPage.Guest.Empty : loadEmpty"
            }
          }
        },
        {
          "id": "t.page_activity_list_guest.0004",
          "from": "page.ActivityListPage.guest.Init",
          "to": "page.ActivityListPage.guest.Failed",
          "event": "loadFailed",
          "roles": [
            "guest"
          ],
          "narrative": {
            "summary": "載入活動列表失敗",
            "taskDescription": "活動列表 API 失敗時顯示錯誤狀態並提供重試入口。"
          },
          "validations": [
            {
              "id": "v.t.page_activity_list_guest.0004.01",
              "type": "semantic-check",
              "description": "API 失敗時顯示 Failed 狀態與可重試入口；錯誤訊息不可含糊，且不暴露不必要的技術細節。",
              "expected": null
            }
          ],
          "intent": {
            "category": "action",
            "summary": "loadFailed"
          },
          "meta": {
            "diagramId": "page_activity_list_guest",
            "source": {
              "raw": "ActivityListPage.Guest.Init --> ActivityListPage.Guest.Failed : loadFailed"
            }
          }
        }
      ],
      "connectors": [
        {
          "id": "c.page_entry.contains.page_activity_list_guest",
          "type": "contains",
          "from": {
            "diagramId": "page_entry",
            "stateId": null
          },
          "to": {
            "diagramId": "page_activity_list_guest",
            "stateId": null
          },
          "narrative": {
            "summary": "Entry 與 Activity List（Guest）存在階層關係",
            "taskDescription": "建立 parent/child 關聯，表示 page_activity_list_guest 受 page_entry 統轄。"
          },
          "validations": [],
          "meta": {
            "reason": "derived from parentDiagramId"
          }
        },
        {
          "id": "c.page_activity_list_guest.invokes.page_activity_detail_guest.s.page_ActivityListPage_guest_Ready.to.page_ActivityDetailPage_guest_Init",
          "type": "invokes",
          "from": {
            "diagramId": "page_activity_list_guest",
            "stateId": "page.ActivityListPage.guest.Ready"
          },
          "to": {
            "diagramId": "page_activity_detail_guest",
            "stateId": null
          },
          "narrative": {
            "summary": "從列表開啟活動詳情",
            "taskDescription": "在列表 Ready 狀態點擊活動，導航到 /activities/:activityId 並進入詳情頁初始化狀態。"
          },
          "validations": [
            {
              "id": "v.c.page_activity_list_guest.invokes.page_activity_detail_guest.01",
              "type": "semantic-check",
              "description": "點擊活動後導向對應詳情路由；ActivityId 參數正確；UI 進入詳情載入流程。",
              "expected": null
            }
          ],
          "meta": {
            "reason": "openActivity | navigate /activities/:activityId",
            "action": "openActivity",
            "navigateTarget": "/activities/:activityId"
          }
        },
        {
          "id": "c.page_activity_list_guest.invokes.page_login.s.page_ActivityListPage_guest_Ready.to.page_LoginPage_guest_Init",
          "type": "invokes",
          "from": {
            "diagramId": "page_activity_list_guest",
            "stateId": "page.ActivityListPage.guest.Ready"
          },
          "to": {
            "diagramId": "page_login",
            "stateId": "page.LoginPage.guest.Init"
          },
          "narrative": {
            "summary": "從列表進入登入頁",
            "taskDescription": "在列表 Ready 狀態選擇登入，導航到 /login 並進入 LoginPage.Init。"
          },
          "validations": [
            {
              "id": "v.c.page_activity_list_guest.invokes.page_login.01",
              "type": "url-equals",
              "description": "導向登入頁並維持 Guest 導覽可見性規則；Header 不出現 Member/Admin 專屬選項。",
              "expected": "/login"
            }
          ],
          "meta": {
            "reason": "chooseLogin | navigate /login",
            "action": "chooseLogin",
            "navigateTarget": "/login"
          }
        },
        {
          "id": "c.page_activity_list_guest.invokes.page_register.s.page_ActivityListPage_guest_Ready.to.page_RegisterPage_guest_Init",
          "type": "invokes",
          "from": {
            "diagramId": "page_activity_list_guest",
            "stateId": "page.ActivityListPage.guest.Ready"
          },
          "to": {
            "diagramId": "page_register",
            "stateId": "page.RegisterPage.guest.Init"
          },
          "narrative": {
            "summary": "從列表進入註冊頁",
            "taskDescription": "在列表 Ready 狀態選擇註冊，導航到 /register 並進入 RegisterPage.Init。"
          },
          "validations": [
            {
              "id": "v.c.page_activity_list_guest.invokes.page_register.01",
              "type": "url-equals",
              "description": "導向註冊頁；不提供建立 Admin。",
              "expected": "/register"
            }
          ],
          "meta": {
            "reason": "chooseRegister | navigate /register",
            "action": "chooseRegister",
            "navigateTarget": "/register"
          }
        },
        {
          "id": "c.page_activity_list_guest.invokes.page_login.s.page_ActivityListPage_guest_Empty.to.page_LoginPage_guest_Init",
          "type": "invokes",
          "from": {
            "diagramId": "page_activity_list_guest",
            "stateId": "page.ActivityListPage.guest.Empty"
          },
          "to": {
            "diagramId": "page_login",
            "stateId": "page.LoginPage.guest.Init"
          },
          "narrative": {
            "summary": "Empty 狀態下進入登入頁",
            "taskDescription": "在列表 Empty 狀態選擇登入，導航到 /login 並進入 LoginPage.Init。"
          },
          "validations": [
            {
              "id": "v.c.page_activity_list_guest.invokes.page_login.02",
              "type": "semantic-check",
              "description": "Empty 狀態下仍可進入登入頁；導覽規則一致。",
              "expected": null
            }
          ],
          "meta": {
            "reason": "chooseLogin | navigate /login",
            "action": "chooseLogin",
            "navigateTarget": "/login"
          }
        },
        {
          "id": "c.page_activity_list_guest.invokes.page_register.s.page_ActivityListPage_guest_Empty.to.page_RegisterPage_guest_Init",
          "type": "invokes",
          "from": {
            "diagramId": "page_activity_list_guest",
            "stateId": "page.ActivityListPage.guest.Empty"
          },
          "to": {
            "diagramId": "page_register",
            "stateId": "page.RegisterPage.guest.Init"
          },
          "narrative": {
            "summary": "Empty 狀態下進入註冊頁",
            "taskDescription": "在列表 Empty 狀態選擇註冊，導航到 /register 並進入 RegisterPage.Init。"
          },
          "validations": [
            {
              "id": "v.c.page_activity_list_guest.invokes.page_register.02",
              "type": "semantic-check",
              "description": "Empty 狀態下仍可進入註冊頁；註冊僅建立 Member。",
              "expected": null
            }
          ],
          "meta": {
            "reason": "chooseRegister | navigate /register",
            "action": "chooseRegister",
            "navigateTarget": "/register"
          }
        },
        {
          "id": "c.page_activity_list_guest.invokes.page_activity_list_guest.s.page_ActivityListPage_guest_Empty.to.page_ActivityListPage_guest_Init",
          "type": "invokes",
          "from": {
            "diagramId": "page_activity_list_guest",
            "stateId": "page.ActivityListPage.guest.Empty"
          },
          "to": {
            "diagramId": "page_activity_list_guest",
            "stateId": "page.ActivityListPage.guest.Init"
          },
          "narrative": {
            "summary": "重新整理活動列表",
            "taskDescription": "在 Empty 狀態觸發 refresh 導航到 /activities，並回到 Init 重新載入流程。"
          },
          "validations": [
            {
              "id": "v.c.page_activity_list_guest.invokes.page_activity_list_guest.01",
              "type": "semantic-check",
              "description": "觸發重新載入並回到列表載入流程；UI 會顯示 loading。",
              "expected": null
            }
          ],
          "meta": {
            "reason": "refresh | navigate /activities",
            "action": "refresh",
            "navigateTarget": "/activities"
          }
        },
        {
          "id": "c.page_activity_list_guest.invokes.page_activity_list_guest.s.page_ActivityListPage_guest_Failed.to.page_ActivityListPage_guest_Init",
          "type": "invokes",
          "from": {
            "diagramId": "page_activity_list_guest",
            "stateId": "page.ActivityListPage.guest.Failed"
          },
          "to": {
            "diagramId": "page_activity_list_guest",
            "stateId": "page.ActivityListPage.guest.Init"
          },
          "narrative": {
            "summary": "重試載入活動列表",
            "taskDescription": "在 Failed 狀態觸發 retryLoad 導航到 /activities，並回到 Init 重新載入。"
          },
          "validations": [
            {
              "id": "v.c.page_activity_list_guest.invokes.page_activity_list_guest.02",
              "type": "semantic-check",
              "description": "重試會再次呼叫列表 API；若成功則轉入 Ready/Empty；若失敗則回到 Failed。",
              "expected": null
            }
          ],
          "meta": {
            "reason": "retryLoad | navigate /activities",
            "action": "retryLoad",
            "navigateTarget": "/activities"
          }
        }
      ],
      "meta": {
        "pageName": "ActivityListPage",
        "featureName": null,
        "entryStateId": "page.ActivityListPage.guest.Init"
      }
    },
    {
      "id": "page_activity_list_member",
      "name": "Activity List Page (Member)",
      "level": "page",
      "parentDiagramId": "page_entry",
      "roles": [
        "member"
      ],
      "variant": {
        "kind": "standalone",
        "baseDiagramId": null,
        "deltaDiagramIdsByRole": {},
        "appliesToRoles": []
      },
      "source": {
        "type": "mermaid",
        "sectionTitle": "⑤ Activity List Page - Member",
        "order": 5
      },
      "groups": [],
      "states": [
        {
          "id": "page.ActivityListPage.member.Init",
          "label": "ActivityListPage.Member.Init",
          "type": "start",
          "groupId": null,
          "tags": [
            "page",
            "member"
          ],
          "meta": {
            "diagramId": "page_activity_list_member",
            "synthetic": false,
            "source": {
              "scope": "root",
              "raw": "ActivityListPage.Member.Init"
            }
          }
        },
        {
          "id": "page.ActivityListPage.member.Ready",
          "label": "ActivityListPage.Member.Ready",
          "type": "normal",
          "groupId": null,
          "tags": [
            "page",
            "member"
          ],
          "meta": {
            "diagramId": "page_activity_list_member",
            "synthetic": false,
            "source": {
              "scope": "root",
              "raw": "ActivityListPage.Member.Ready"
            }
          }
        },
        {
          "id": "page.ActivityListPage.member.Empty",
          "label": "ActivityListPage.Member.Empty",
          "type": "normal",
          "groupId": null,
          "tags": [
            "page",
            "member"
          ],
          "meta": {
            "diagramId": "page_activity_list_member",
            "synthetic": false,
            "source": {
              "scope": "root",
              "raw": "ActivityListPage.Member.Empty"
            }
          }
        },
        {
          "id": "page.ActivityListPage.member.Failed",
          "label": "ActivityListPage.Member.Failed",
          "type": "normal",
          "groupId": null,
          "tags": [
            "page",
            "member"
          ],
          "meta": {
            "diagramId": "page_activity_list_member",
            "synthetic": false,
            "source": {
              "scope": "root",
              "raw": "ActivityListPage.Member.Failed"
            }
          }
        }
      ],
      "transitions": [
        {
          "id": "t.page_activity_list_member.0001",
          "from": "page.ActivityListPage.member.Init",
          "to": "page.ActivityListPage.member.Init",
          "event": "enterPage",
          "roles": [
            "member"
          ],
          "narrative": {
            "summary": "以會員視角進入活動列表",
            "taskDescription": "導向 /activities 時以 Member 呈現，初始化列表頁並顯示 Member 導覽列。"
          },
          "validations": [
            {
              "id": "v.t.page_activity_list_member.0001.01",
              "type": "url-equals",
              "description": "進入 `/activities` 時 Header 顯示「活動/我的活動/登出」；不顯示「註冊」；不顯示「管理後台」。",
              "expected": "/activities"
            }
          ],
          "intent": {
            "category": "action",
            "summary": "enterPage"
          },
          "meta": {
            "diagramId": "page_activity_list_member",
            "source": {
              "raw": "[*] --> ActivityListPage.Member.Init : enterPage"
            }
          }
        },
        {
          "id": "t.page_activity_list_member.0002",
          "from": "page.ActivityListPage.member.Init",
          "to": "page.ActivityListPage.member.Ready",
          "event": "loadActivities",
          "roles": [
            "member"
          ],
          "narrative": {
            "summary": "載入公開活動列表（已登入）",
            "taskDescription": "呼叫活動列表 API，成功後顯示活動清單並呈現使用者報名狀態。"
          },
          "validations": [
            {
              "id": "v.t.page_activity_list_member.0002.01",
              "type": "semantic-check",
              "description": "API 成功回傳 `published/full` 活動；UI 顯示每個活動的報名狀態（可報名/已報名/額滿）；「已報名」需與使用者實際 Registration 一致。",
              "expected": null
            }
          ],
          "intent": {
            "category": "action",
            "summary": "loadActivities"
          },
          "meta": {
            "diagramId": "page_activity_list_member",
            "source": {
              "raw": "ActivityListPage.Member.Init --> ActivityListPage.Member.Ready : loadActivities"
            }
          }
        },
        {
          "id": "t.page_activity_list_member.0003",
          "from": "page.ActivityListPage.member.Init",
          "to": "page.ActivityListPage.member.Empty",
          "event": "loadEmpty",
          "roles": [
            "member"
          ],
          "narrative": {
            "summary": "載入後無公開活動（已登入）",
            "taskDescription": "活動列表 API 成功但無資料時，切換到 Empty 狀態並顯示空畫面提示。"
          },
          "validations": [
            {
              "id": "v.t.page_activity_list_member.0003.01",
              "type": "semantic-check",
              "description": "Empty 狀態顯示明確空畫面文案；Header 仍維持 Member 導覽規則。",
              "expected": null
            }
          ],
          "intent": {
            "category": "action",
            "summary": "loadEmpty"
          },
          "meta": {
            "diagramId": "page_activity_list_member",
            "source": {
              "raw": "ActivityListPage.Member.Init --> ActivityListPage.Member.Empty : loadEmpty"
            }
          }
        },
        {
          "id": "t.page_activity_list_member.0004",
          "from": "page.ActivityListPage.member.Init",
          "to": "page.ActivityListPage.member.Failed",
          "event": "loadFailed",
          "roles": [
            "member"
          ],
          "narrative": {
            "summary": "載入活動列表失敗（已登入）",
            "taskDescription": "活動列表 API 失敗時顯示錯誤狀態並提供重試入口；不顯示 Guest 專屬 CTA。"
          },
          "validations": [
            {
              "id": "v.t.page_activity_list_member.0004.01",
              "type": "semantic-check",
              "description": "Failed 狀態顯示錯誤與重試入口；不顯示 Guest 專屬 CTA（登入/註冊）。",
              "expected": null
            }
          ],
          "intent": {
            "category": "action",
            "summary": "loadFailed"
          },
          "meta": {
            "diagramId": "page_activity_list_member",
            "source": {
              "raw": "ActivityListPage.Member.Init --> ActivityListPage.Member.Failed : loadFailed"
            }
          }
        }
      ],
      "connectors": [
        {
          "id": "c.page_entry.contains.page_activity_list_member",
          "type": "contains",
          "from": {
            "diagramId": "page_entry",
            "stateId": null
          },
          "to": {
            "diagramId": "page_activity_list_member",
            "stateId": null
          },
          "narrative": {
            "summary": "Entry 與 Activity List（Member）存在階層關係",
            "taskDescription": "建立 parent/child 關聯，表示 page_activity_list_member 受 page_entry 統轄。"
          },
          "validations": [],
          "meta": {
            "reason": "derived from parentDiagramId"
          }
        },
        {
          "id": "c.page_activity_list_member.invokes.page_activity_detail_member.s.page_ActivityListPage_member_Ready.to.page_ActivityDetailPage_member_Init",
          "type": "invokes",
          "from": {
            "diagramId": "page_activity_list_member",
            "stateId": "page.ActivityListPage.member.Ready"
          },
          "to": {
            "diagramId": "page_activity_detail_member",
            "stateId": null
          },
          "narrative": {
            "summary": "以會員視角開啟活動詳情",
            "taskDescription": "在列表 Ready 狀態點擊活動，導航到 /activities/:activityId 並進入詳情頁（Member）初始化狀態。"
          },
          "validations": [
            {
              "id": "v.c.page_activity_list_member.invokes.page_activity_detail_member.01",
              "type": "semantic-check",
              "description": "導向詳情；進入後能顯示「已報名/可報名/額滿」並與資料一致。",
              "expected": null
            }
          ],
          "meta": {
            "reason": "openActivity | navigate /activities/:activityId",
            "action": "openActivity",
            "navigateTarget": "/activities/:activityId"
          }
        },
        {
          "id": "c.page_activity_list_member.invokes.page_activity_list_member.s.page_ActivityListPage_member_Empty.to.page_ActivityListPage_member_Init",
          "type": "invokes",
          "from": {
            "diagramId": "page_activity_list_member",
            "stateId": "page.ActivityListPage.member.Empty"
          },
          "to": {
            "diagramId": "page_activity_list_member",
            "stateId": "page.ActivityListPage.member.Init"
          },
          "narrative": {
            "summary": "重新整理活動列表（Member）",
            "taskDescription": "在 Empty 狀態觸發 refresh 導航到 /activities，並回到 Init 重新載入流程。"
          },
          "validations": [
            {
              "id": "v.c.page_activity_list_member.invokes.page_activity_list_member.01",
              "type": "semantic-check",
              "description": "重新載入列表；成功後顯示 Ready/Empty。",
              "expected": null
            }
          ],
          "meta": {
            "reason": "refresh | navigate /activities",
            "action": "refresh",
            "navigateTarget": "/activities"
          }
        },
        {
          "id": "c.page_activity_list_member.invokes.page_activity_list_member.s.page_ActivityListPage_member_Failed.to.page_ActivityListPage_member_Init",
          "type": "invokes",
          "from": {
            "diagramId": "page_activity_list_member",
            "stateId": "page.ActivityListPage.member.Failed"
          },
          "to": {
            "diagramId": "page_activity_list_member",
            "stateId": "page.ActivityListPage.member.Init"
          },
          "narrative": {
            "summary": "重試載入活動列表（Member）",
            "taskDescription": "在 Failed 狀態觸發 retryLoad 導航到 /activities，並回到 Init 重新載入。"
          },
          "validations": [
            {
              "id": "v.c.page_activity_list_member.invokes.page_activity_list_member.02",
              "type": "semantic-check",
              "description": "重試會重新呼叫 API；錯誤狀態可恢復。",
              "expected": null
            }
          ],
          "meta": {
            "reason": "retryLoad | navigate /activities",
            "action": "retryLoad",
            "navigateTarget": "/activities"
          }
        }
      ],
      "meta": {
        "pageName": "ActivityListPage",
        "featureName": null,
        "entryStateId": "page.ActivityListPage.member.Init"
      }
    },
    {
      "id": "page_activity_list_admin",
      "name": "Activity List Page (Admin)",
      "level": "page",
      "parentDiagramId": "page_entry",
      "roles": [
        "admin"
      ],
      "variant": {
        "kind": "standalone",
        "baseDiagramId": null,
        "deltaDiagramIdsByRole": {},
        "appliesToRoles": []
      },
      "source": {
        "type": "mermaid",
        "sectionTitle": "⑥ Activity List Page - Admin",
        "order": 6
      },
      "groups": [],
      "states": [
        {
          "id": "page.ActivityListPage.admin.Init",
          "label": "ActivityListPage.Admin.Init",
          "type": "start",
          "groupId": null,
          "tags": [
            "page",
            "admin"
          ],
          "meta": {
            "diagramId": "page_activity_list_admin",
            "synthetic": false,
            "source": {
              "scope": "root",
              "raw": "ActivityListPage.Admin.Init"
            }
          }
        },
        {
          "id": "page.ActivityListPage.admin.Ready",
          "label": "ActivityListPage.Admin.Ready",
          "type": "normal",
          "groupId": null,
          "tags": [
            "page",
            "admin"
          ],
          "meta": {
            "diagramId": "page_activity_list_admin",
            "synthetic": false,
            "source": {
              "scope": "root",
              "raw": "ActivityListPage.Admin.Ready"
            }
          }
        },
        {
          "id": "page.ActivityListPage.admin.Empty",
          "label": "ActivityListPage.Admin.Empty",
          "type": "normal",
          "groupId": null,
          "tags": [
            "page",
            "admin"
          ],
          "meta": {
            "diagramId": "page_activity_list_admin",
            "synthetic": false,
            "source": {
              "scope": "root",
              "raw": "ActivityListPage.Admin.Empty"
            }
          }
        },
        {
          "id": "page.ActivityListPage.admin.Failed",
          "label": "ActivityListPage.Admin.Failed",
          "type": "normal",
          "groupId": null,
          "tags": [
            "page",
            "admin"
          ],
          "meta": {
            "diagramId": "page_activity_list_admin",
            "synthetic": false,
            "source": {
              "scope": "root",
              "raw": "ActivityListPage.Admin.Failed"
            }
          }
        }
      ],
      "transitions": [
        {
          "id": "t.page_activity_list_admin.0001",
          "from": "page.ActivityListPage.admin.Init",
          "to": "page.ActivityListPage.admin.Init",
          "event": "enterPage",
          "roles": [
            "admin"
          ],
          "narrative": {
            "summary": "以管理員視角進入活動列表",
            "taskDescription": "導向 /activities 時以 Admin 呈現，初始化列表頁並顯示 Admin 導覽列（含管理後台入口）。"
          },
          "validations": [
            {
              "id": "v.t.page_activity_list_admin.0001.01",
              "type": "url-equals",
              "description": "進入 `/activities` 時 Header 顯示「活動/我的活動/管理後台/登出」；不顯示「註冊」。",
              "expected": "/activities"
            }
          ],
          "intent": {
            "category": "action",
            "summary": "enterPage"
          },
          "meta": {
            "diagramId": "page_activity_list_admin",
            "source": {
              "raw": "[*] --> ActivityListPage.Admin.Init : enterPage"
            }
          }
        },
        {
          "id": "t.page_activity_list_admin.0002",
          "from": "page.ActivityListPage.admin.Init",
          "to": "page.ActivityListPage.admin.Ready",
          "event": "loadActivities",
          "roles": [
            "admin"
          ],
          "narrative": {
            "summary": "載入公開活動列表（Admin）",
            "taskDescription": "呼叫活動列表 API，成功後顯示活動清單並呈現報名狀態。"
          },
          "validations": [
            {
              "id": "v.t.page_activity_list_admin.0002.01",
              "type": "semantic-check",
              "description": "API 成功回傳 `published/full` 活動；UI 顯示報名狀態（可報名/已報名/額滿）且與資料一致。",
              "expected": null
            }
          ],
          "intent": {
            "category": "action",
            "summary": "loadActivities"
          },
          "meta": {
            "diagramId": "page_activity_list_admin",
            "source": {
              "raw": "ActivityListPage.Admin.Init --> ActivityListPage.Admin.Ready : loadActivities"
            }
          }
        },
        {
          "id": "t.page_activity_list_admin.0003",
          "from": "page.ActivityListPage.admin.Init",
          "to": "page.ActivityListPage.admin.Empty",
          "event": "loadEmpty",
          "roles": [
            "admin"
          ],
          "narrative": {
            "summary": "載入後無公開活動（Admin）",
            "taskDescription": "活動列表 API 成功但無資料時切換到 Empty 狀態。"
          },
          "validations": [
            {
              "id": "v.t.page_activity_list_admin.0003.01",
              "type": "semantic-check",
              "description": "Empty 狀態仍顯示管理後台入口；導覽規則一致。",
              "expected": null
            }
          ],
          "intent": {
            "category": "action",
            "summary": "loadEmpty"
          },
          "meta": {
            "diagramId": "page_activity_list_admin",
            "source": {
              "raw": "ActivityListPage.Admin.Init --> ActivityListPage.Admin.Empty : loadEmpty"
            }
          }
        },
        {
          "id": "t.page_activity_list_admin.0004",
          "from": "page.ActivityListPage.admin.Init",
          "to": "page.ActivityListPage.admin.Failed",
          "event": "loadFailed",
          "roles": [
            "admin"
          ],
          "narrative": {
            "summary": "載入活動列表失敗（Admin）",
            "taskDescription": "活動列表 API 失敗時顯示錯誤狀態並提供重試入口；仍可前往管理後台。"
          },
          "validations": [
            {
              "id": "v.t.page_activity_list_admin.0004.01",
              "type": "semantic-check",
              "description": "Failed 狀態顯示錯誤與重試入口；仍可前往管理後台。",
              "expected": null
            }
          ],
          "intent": {
            "category": "action",
            "summary": "loadFailed"
          },
          "meta": {
            "diagramId": "page_activity_list_admin",
            "source": {
              "raw": "ActivityListPage.Admin.Init --> ActivityListPage.Admin.Failed : loadFailed"
            }
          }
        }
      ],
      "connectors": [
        {
          "id": "c.page_entry.contains.page_activity_list_admin",
          "type": "contains",
          "from": {
            "diagramId": "page_entry",
            "stateId": null
          },
          "to": {
            "diagramId": "page_activity_list_admin",
            "stateId": null
          },
          "narrative": {
            "summary": "Entry 與 Activity List（Admin）存在階層關係",
            "taskDescription": "建立 parent/child 關聯，表示 page_activity_list_admin 受 page_entry 統轄。"
          },
          "validations": [],
          "meta": {
            "reason": "derived from parentDiagramId"
          }
        },
        {
          "id": "c.page_activity_list_admin.invokes.page_activity_detail_admin.s.page_ActivityListPage_admin_Ready.to.page_ActivityDetailPage_admin_Init",
          "type": "invokes",
          "from": {
            "diagramId": "page_activity_list_admin",
            "stateId": "page.ActivityListPage.admin.Ready"
          },
          "to": {
            "diagramId": "page_activity_detail_admin",
            "stateId": null
          },
          "narrative": {
            "summary": "以管理員視角開啟活動詳情",
            "taskDescription": "在列表 Ready 狀態點擊活動，導航到 /activities/:activityId 並進入詳情頁（Admin）初始化狀態。"
          },
          "validations": [
            {
              "id": "v.c.page_activity_list_admin.invokes.page_activity_detail_admin.01",
              "type": "semantic-check",
              "description": "導向詳情；Admin 在詳情頁可進行報名/取消（若規則允許）。",
              "expected": null
            }
          ],
          "meta": {
            "reason": "openActivity | navigate /activities/:activityId",
            "action": "openActivity",
            "navigateTarget": "/activities/:activityId"
          }
        },
        {
          "id": "c.page_activity_list_admin.invokes.page_activity_list_admin.s.page_ActivityListPage_admin_Empty.to.page_ActivityListPage_admin_Init",
          "type": "invokes",
          "from": {
            "diagramId": "page_activity_list_admin",
            "stateId": "page.ActivityListPage.admin.Empty"
          },
          "to": {
            "diagramId": "page_activity_list_admin",
            "stateId": "page.ActivityListPage.admin.Init"
          },
          "narrative": {
            "summary": "重新整理活動列表（Admin）",
            "taskDescription": "在 Empty 狀態觸發 refresh 導航到 /activities，並回到 Init 重新載入流程。"
          },
          "validations": [
            {
              "id": "v.c.page_activity_list_admin.invokes.page_activity_list_admin.01",
              "type": "semantic-check",
              "description": "重新載入列表。",
              "expected": null
            }
          ],
          "meta": {
            "reason": "refresh | navigate /activities",
            "action": "refresh",
            "navigateTarget": "/activities"
          }
        },
        {
          "id": "c.page_activity_list_admin.invokes.page_activity_list_admin.s.page_ActivityListPage_admin_Failed.to.page_ActivityListPage_admin_Init",
          "type": "invokes",
          "from": {
            "diagramId": "page_activity_list_admin",
            "stateId": "page.ActivityListPage.admin.Failed"
          },
          "to": {
            "diagramId": "page_activity_list_admin",
            "stateId": "page.ActivityListPage.admin.Init"
          },
          "narrative": {
            "summary": "重試載入活動列表（Admin）",
            "taskDescription": "在 Failed 狀態觸發 retryLoad 導航到 /activities，並回到 Init 重新載入。"
          },
          "validations": [
            {
              "id": "v.c.page_activity_list_admin.invokes.page_activity_list_admin.02",
              "type": "semantic-check",
              "description": "重試可恢復。",
              "expected": null
            }
          ],
          "meta": {
            "reason": "retryLoad | navigate /activities",
            "action": "retryLoad",
            "navigateTarget": "/activities"
          }
        }
      ],
      "meta": {
        "pageName": "ActivityListPage",
        "featureName": null,
        "entryStateId": "page.ActivityListPage.admin.Init"
      }
    },
    {
      "id": "page_activity_detail_guest",
      "name": "Activity Detail Page (Guest)",
      "level": "page",
      "parentDiagramId": "page_entry",
      "roles": [
        "guest"
      ],
      "variant": {
        "kind": "standalone",
        "baseDiagramId": null,
        "deltaDiagramIdsByRole": {},
        "appliesToRoles": []
      },
      "source": {
        "type": "mermaid",
        "sectionTitle": "⑦ Activity Detail Page - Guest",
        "order": 7
      },
      "groups": [],
      "states": [
        {
          "id": "page.ActivityDetailPage.guest.Init",
          "label": "ActivityDetailPage.Guest.Init",
          "type": "start",
          "groupId": null,
          "tags": [
            "page",
            "guest"
          ],
          "meta": {
            "diagramId": "page_activity_detail_guest",
            "synthetic": false,
            "source": {
              "scope": "root",
              "raw": "ActivityDetailPage.Guest.Init"
            }
          }
        },
        {
          "id": "page.ActivityDetailPage.guest.Ready",
          "label": "ActivityDetailPage.Guest.Ready",
          "type": "normal",
          "groupId": null,
          "tags": [
            "page",
            "guest"
          ],
          "meta": {
            "diagramId": "page_activity_detail_guest",
            "synthetic": false,
            "source": {
              "scope": "root",
              "raw": "ActivityDetailPage.Guest.Ready"
            }
          }
        },
        {
          "id": "page.ActivityDetailPage.guest.NotFound",
          "label": "ActivityDetailPage.Guest.NotFound",
          "type": "normal",
          "groupId": null,
          "tags": [
            "page",
            "guest"
          ],
          "meta": {
            "diagramId": "page_activity_detail_guest",
            "synthetic": false,
            "source": {
              "scope": "root",
              "raw": "ActivityDetailPage.Guest.NotFound"
            }
          }
        },
        {
          "id": "page.ActivityDetailPage.guest.Failed",
          "label": "ActivityDetailPage.Guest.Failed",
          "type": "normal",
          "groupId": null,
          "tags": [
            "page",
            "guest"
          ],
          "meta": {
            "diagramId": "page_activity_detail_guest",
            "synthetic": false,
            "source": {
              "scope": "root",
              "raw": "ActivityDetailPage.Guest.Failed"
            }
          }
        }
      ],
      "transitions": [
        {
          "id": "t.page_activity_detail_guest.0001",
          "from": "page.ActivityDetailPage.guest.Init",
          "to": "page.ActivityDetailPage.guest.Init",
          "event": "enterPage",
          "roles": [
            "guest"
          ],
          "narrative": {
            "summary": "以訪客視角進入活動詳情",
            "taskDescription": "導向 /activities/:activityId 時以 Guest 呈現，初始化詳情頁並顯示登入後可報名提示。"
          },
          "validations": [
            {
              "id": "v.t.page_activity_detail_guest.0001.01",
              "type": "semantic-check",
              "description": "進入 `/activities/:activityId` 時以 Guest 呈現；頁面僅顯示活動資訊與「登入後可報名」提示，不顯示「取消報名」。",
              "expected": null
            }
          ],
          "intent": {
            "category": "action",
            "summary": "enterPage"
          },
          "meta": {
            "diagramId": "page_activity_detail_guest",
            "source": {
              "raw": "[*] --> ActivityDetailPage.Guest.Init : enterPage"
            }
          }
        },
        {
          "id": "t.page_activity_detail_guest.0002",
          "from": "page.ActivityDetailPage.guest.Init",
          "to": "page.ActivityDetailPage.guest.Ready",
          "event": "loadActivity",
          "roles": [
            "guest"
          ],
          "narrative": {
            "summary": "載入活動詳情",
            "taskDescription": "呼叫活動詳情 API，成功後顯示完整活動資訊與剩餘名額。"
          },
          "validations": [
            {
              "id": "v.t.page_activity_detail_guest.0002.01",
              "type": "semantic-check",
              "description": "API 成功回傳活動詳情；UI 顯示 title/description/date/location/deadline/capacity/目前報名人數/status/剩餘名額；若 status=full 顯示「已額滿」。",
              "expected": null
            }
          ],
          "intent": {
            "category": "action",
            "summary": "loadActivity"
          },
          "meta": {
            "diagramId": "page_activity_detail_guest",
            "source": {
              "raw": "ActivityDetailPage.Guest.Init --> ActivityDetailPage.Guest.Ready : loadActivity"
            }
          }
        },
        {
          "id": "t.page_activity_detail_guest.0003",
          "from": "page.ActivityDetailPage.guest.Init",
          "to": "page.ActivityDetailPage.guest.NotFound",
          "event": "loadNotFound",
          "roles": [
            "guest"
          ],
          "narrative": {
            "summary": "活動不存在",
            "taskDescription": "若詳情 API 回 404，顯示 NotFound 狀態並提供返回列表入口。"
          },
          "validations": [
            {
              "id": "v.t.page_activity_detail_guest.0003.01",
              "type": "semantic-check",
              "description": "API 回傳 404（活動不存在）；UI 顯示找不到活動的明確訊息。",
              "expected": null
            }
          ],
          "intent": {
            "category": "action",
            "summary": "loadNotFound"
          },
          "meta": {
            "diagramId": "page_activity_detail_guest",
            "source": {
              "raw": "ActivityDetailPage.Guest.Init --> ActivityDetailPage.Guest.NotFound : loadNotFound"
            }
          }
        },
        {
          "id": "t.page_activity_detail_guest.0004",
          "from": "page.ActivityDetailPage.guest.Init",
          "to": "page.ActivityDetailPage.guest.Failed",
          "event": "loadFailed",
          "roles": [
            "guest"
          ],
          "narrative": {
            "summary": "載入活動詳情失敗",
            "taskDescription": "詳情 API 失敗時顯示 Failed 狀態並提供重試入口。"
          },
          "validations": [
            {
              "id": "v.t.page_activity_detail_guest.0004.01",
              "type": "semantic-check",
              "description": "API 失敗（例如 5xx）時顯示 Failed 狀態與可重試入口。",
              "expected": null
            }
          ],
          "intent": {
            "category": "action",
            "summary": "loadFailed"
          },
          "meta": {
            "diagramId": "page_activity_detail_guest",
            "source": {
              "raw": "ActivityDetailPage.Guest.Init --> ActivityDetailPage.Guest.Failed : loadFailed"
            }
          }
        }
      ],
      "connectors": [
        {
          "id": "c.page_entry.contains.page_activity_detail_guest",
          "type": "contains",
          "from": {
            "diagramId": "page_entry",
            "stateId": null
          },
          "to": {
            "diagramId": "page_activity_detail_guest",
            "stateId": null
          },
          "narrative": {
            "summary": "Entry 與 Activity Detail（Guest）存在階層關係",
            "taskDescription": "建立 parent/child 關聯，表示 page_activity_detail_guest 受 page_entry 統轄。"
          },
          "validations": [],
          "meta": {
            "reason": "derived from parentDiagramId"
          }
        },
        {
          "id": "c.page_activity_detail_guest.invokes.page_activity_list_guest.s.page_ActivityDetailPage_guest_Ready.to.page_ActivityListPage_guest_Init",
          "type": "invokes",
          "from": {
            "diagramId": "page_activity_detail_guest",
            "stateId": "page.ActivityDetailPage.guest.Ready"
          },
          "to": {
            "diagramId": "page_activity_list_guest",
            "stateId": "page.ActivityListPage.guest.Init"
          },
          "narrative": {
            "summary": "返回活動列表（Guest）",
            "taskDescription": "在詳情 Ready 狀態觸發 backToList 導航到 /activities，並回到活動列表（Guest）初始化狀態。"
          },
          "validations": [
            {
              "id": "v.c.page_activity_detail_guest.invokes.page_activity_list_guest.01",
              "type": "url-equals",
              "description": "返回列表後仍以 Guest 呈現；Header 不出現 Member/Admin 專屬入口。",
              "expected": "/activities"
            }
          ],
          "meta": {
            "reason": "backToList | navigate /activities",
            "action": "backToList",
            "navigateTarget": "/activities"
          }
        },
        {
          "id": "c.page_activity_detail_guest.invokes.page_login.s.page_ActivityDetailPage_guest_Ready.to.page_LoginPage_guest_Init",
          "type": "invokes",
          "from": {
            "diagramId": "page_activity_detail_guest",
            "stateId": "page.ActivityDetailPage.guest.Ready"
          },
          "to": {
            "diagramId": "page_login",
            "stateId": "page.LoginPage.guest.Init"
          },
          "narrative": {
            "summary": "導向登入並保留 returnTo",
            "taskDescription": "在詳情 Ready 狀態觸發 requireLoginReturnToDetail 導航到 /login，並保留 returnTo=/activities/:activityId。"
          },
          "validations": [
            {
              "id": "v.c.page_activity_detail_guest.invokes.page_login.01",
              "type": "url-equals",
              "description": "點擊「登入後可報名」或相同行為時導向 `/login` 並保留 returnTo=`/activities/:activityId`；未登入下嘗試報名 API 需回 401。",
              "expected": "/login"
            }
          ],
          "meta": {
            "reason": "requireLoginReturnToDetail | navigate /login",
            "action": "requireLoginReturnToDetail",
            "navigateTarget": "/login"
          }
        },
        {
          "id": "c.page_activity_detail_guest.invokes.page_activity_list_guest.s.page_ActivityDetailPage_guest_NotFound.to.page_ActivityListPage_guest_Init",
          "type": "invokes",
          "from": {
            "diagramId": "page_activity_detail_guest",
            "stateId": "page.ActivityDetailPage.guest.NotFound"
          },
          "to": {
            "diagramId": "page_activity_list_guest",
            "stateId": "page.ActivityListPage.guest.Init"
          },
          "narrative": {
            "summary": "NotFound 狀態返回列表",
            "taskDescription": "在 NotFound 狀態觸發 backToList 導航到 /activities 並回到列表初始化狀態。"
          },
          "validations": [
            {
              "id": "v.c.page_activity_detail_guest.invokes.page_activity_list_guest.02",
              "type": "semantic-check",
              "description": "NotFound 狀態下可返回列表；避免停留在不可操作狀態。",
              "expected": null
            }
          ],
          "meta": {
            "reason": "backToList | navigate /activities",
            "action": "backToList",
            "navigateTarget": "/activities"
          }
        },
        {
          "id": "c.page_activity_detail_guest.invokes.page_activity_detail_guest.s.page_ActivityDetailPage_guest_Failed.to.page_ActivityDetailPage_guest_Init",
          "type": "invokes",
          "from": {
            "diagramId": "page_activity_detail_guest",
            "stateId": "page.ActivityDetailPage.guest.Failed"
          },
          "to": {
            "diagramId": "page_activity_detail_guest",
            "stateId": "page.ActivityDetailPage.guest.Init"
          },
          "narrative": {
            "summary": "重試載入活動詳情",
            "taskDescription": "在 Failed 狀態觸發 retryLoad 導航到 /activities/:activityId，並回到 Init 重新載入流程。"
          },
          "validations": [
            {
              "id": "v.c.page_activity_detail_guest.invokes.page_activity_detail_guest.01",
              "type": "semantic-check",
              "description": "重試會重新呼叫詳情 API；成功後進入 Ready/NotFound。",
              "expected": null
            }
          ],
          "meta": {
            "reason": "retryLoad | navigate /activities/:activityId",
            "action": "retryLoad",
            "navigateTarget": "/activities/:activityId"
          }
        }
      ],
      "meta": {
        "pageName": "ActivityDetailPage",
        "featureName": null,
        "entryStateId": "page.ActivityDetailPage.guest.Init"
      }
    },
    {
      "id": "page_activity_detail_member",
      "name": "Activity Detail Page (Member)",
      "level": "page",
      "parentDiagramId": "page_entry",
      "roles": [
        "member"
      ],
      "variant": {
        "kind": "standalone",
        "baseDiagramId": null,
        "deltaDiagramIdsByRole": {},
        "appliesToRoles": []
      },
      "source": {
        "type": "mermaid",
        "sectionTitle": "⑧ Activity Detail Page - Member",
        "order": 8
      },
      "groups": [],
      "states": [
        {
          "id": "page.ActivityDetailPage.member.Init",
          "label": "ActivityDetailPage.Member.Init",
          "type": "start",
          "groupId": null,
          "tags": [
            "page",
            "member"
          ],
          "meta": {
            "diagramId": "page_activity_detail_member",
            "synthetic": false,
            "source": {
              "scope": "root",
              "raw": "ActivityDetailPage.Member.Init"
            }
          }
        },
        {
          "id": "page.ActivityDetailPage.member.Ready",
          "label": "ActivityDetailPage.Member.Ready",
          "type": "normal",
          "groupId": null,
          "tags": [
            "page",
            "member"
          ],
          "meta": {
            "diagramId": "page_activity_detail_member",
            "synthetic": false,
            "source": {
              "scope": "root",
              "raw": "ActivityDetailPage.Member.Ready"
            }
          }
        },
        {
          "id": "page.ActivityDetailPage.member.NotFound",
          "label": "ActivityDetailPage.Member.NotFound",
          "type": "normal",
          "groupId": null,
          "tags": [
            "page",
            "member"
          ],
          "meta": {
            "diagramId": "page_activity_detail_member",
            "synthetic": false,
            "source": {
              "scope": "root",
              "raw": "ActivityDetailPage.Member.NotFound"
            }
          }
        },
        {
          "id": "page.ActivityDetailPage.member.Failed",
          "label": "ActivityDetailPage.Member.Failed",
          "type": "normal",
          "groupId": null,
          "tags": [
            "page",
            "member"
          ],
          "meta": {
            "diagramId": "page_activity_detail_member",
            "synthetic": false,
            "source": {
              "scope": "root",
              "raw": "ActivityDetailPage.Member.Failed"
            }
          }
        }
      ],
      "transitions": [
        {
          "id": "t.page_activity_detail_member.0001",
          "from": "page.ActivityDetailPage.member.Init",
          "to": "page.ActivityDetailPage.member.Init",
          "event": "enterPage",
          "roles": [
            "member"
          ],
          "narrative": {
            "summary": "以會員視角進入活動詳情",
            "taskDescription": "進入詳情時顯示 Member 導覽，並依活動/報名狀態呈現正確 CTA。"
          },
          "validations": [
            {
              "id": "v.t.page_activity_detail_member.0001.01",
              "type": "semantic-check",
              "description": "進入詳情時 Header 顯示 Member 導覽；頁面依規則顯示「報名/取消報名/已額滿/已截止/已結束」其中之一，且不重複出現相同 CTA。",
              "expected": null
            }
          ],
          "intent": {
            "category": "action",
            "summary": "enterPage"
          },
          "meta": {
            "diagramId": "page_activity_detail_member",
            "source": {
              "raw": "[*] --> ActivityDetailPage.Member.Init : enterPage"
            }
          }
        },
        {
          "id": "t.page_activity_detail_member.0002",
          "from": "page.ActivityDetailPage.member.Init",
          "to": "page.ActivityDetailPage.member.Ready",
          "event": "loadActivity",
          "roles": [
            "member"
          ],
          "narrative": {
            "summary": "載入活動詳情（含報名狀態）",
            "taskDescription": "呼叫詳情 API 取得活動資訊與使用者報名狀態，並在 UI 呈現剩餘名額與 CTA。"
          },
          "validations": [
            {
              "id": "v.t.page_activity_detail_member.0002.01",
              "type": "semantic-check",
              "description": "API 成功回傳詳情與使用者報名狀態；UI 顯示剩餘名額與是否已報名；若 `now > deadline` 禁止報名/取消並顯示原因。",
              "expected": null
            }
          ],
          "intent": {
            "category": "action",
            "summary": "loadActivity"
          },
          "meta": {
            "diagramId": "page_activity_detail_member",
            "source": {
              "raw": "ActivityDetailPage.Member.Init --> ActivityDetailPage.Member.Ready : loadActivity"
            }
          }
        },
        {
          "id": "t.page_activity_detail_member.0003",
          "from": "page.ActivityDetailPage.member.Init",
          "to": "page.ActivityDetailPage.member.NotFound",
          "event": "loadNotFound",
          "roles": [
            "member"
          ],
          "narrative": {
            "summary": "活動不存在（Member）",
            "taskDescription": "詳情 API 回 404 時顯示 NotFound 狀態並提供回列表入口。"
          },
          "validations": [
            {
              "id": "v.t.page_activity_detail_member.0003.01",
              "type": "semantic-check",
              "description": "API 回 404；UI 顯示找不到活動。",
              "expected": null
            }
          ],
          "intent": {
            "category": "action",
            "summary": "loadNotFound"
          },
          "meta": {
            "diagramId": "page_activity_detail_member",
            "source": {
              "raw": "ActivityDetailPage.Member.Init --> ActivityDetailPage.Member.NotFound : loadNotFound"
            }
          }
        },
        {
          "id": "t.page_activity_detail_member.0004",
          "from": "page.ActivityDetailPage.member.Init",
          "to": "page.ActivityDetailPage.member.Failed",
          "event": "loadFailed",
          "roles": [
            "member"
          ],
          "narrative": {
            "summary": "載入活動詳情失敗（Member）",
            "taskDescription": "詳情 API 失敗時顯示 Failed 狀態並提供重試入口。"
          },
          "validations": [
            {
              "id": "v.t.page_activity_detail_member.0004.01",
              "type": "semantic-check",
              "description": "API 失敗顯示 Failed 與重試入口。",
              "expected": null
            }
          ],
          "intent": {
            "category": "action",
            "summary": "loadFailed"
          },
          "meta": {
            "diagramId": "page_activity_detail_member",
            "source": {
              "raw": "ActivityDetailPage.Member.Init --> ActivityDetailPage.Member.Failed : loadFailed"
            }
          }
        }
      ],
      "connectors": [
        {
          "id": "c.page_entry.contains.page_activity_detail_member",
          "type": "contains",
          "from": {
            "diagramId": "page_entry",
            "stateId": null
          },
          "to": {
            "diagramId": "page_activity_detail_member",
            "stateId": null
          },
          "narrative": {
            "summary": "Entry 與 Activity Detail（Member）存在階層關係",
            "taskDescription": "建立 parent/child 關聯，表示 page_activity_detail_member 受 page_entry 統轄。"
          },
          "validations": [],
          "meta": {
            "reason": "derived from parentDiagramId"
          }
        },
        {
          "id": "c.page_activity_detail_member.invokes.page_activity_list_member.s.page_ActivityDetailPage_member_Ready.to.page_ActivityListPage_member_Init",
          "type": "invokes",
          "from": {
            "diagramId": "page_activity_detail_member",
            "stateId": "page.ActivityDetailPage.member.Ready"
          },
          "to": {
            "diagramId": "page_activity_list_member",
            "stateId": "page.ActivityListPage.member.Init"
          },
          "narrative": {
            "summary": "返回活動列表（Member）",
            "taskDescription": "在詳情 Ready 狀態觸發 backToList 導航到 /activities，並回到活動列表（Member）初始化狀態。"
          },
          "validations": [
            {
              "id": "v.c.page_activity_detail_member.invokes.page_activity_list_member.01",
              "type": "url-equals",
              "description": "返回列表後仍為 Member；列表顯示「已報名/額滿/可報名」一致。",
              "expected": "/activities"
            }
          ],
          "meta": {
            "reason": "backToList | navigate /activities",
            "action": "backToList",
            "navigateTarget": "/activities"
          }
        },
        {
          "id": "c.page_activity_detail_member.invokes.page_activity_list_member.s.page_ActivityDetailPage_member_NotFound.to.page_ActivityListPage_member_Init",
          "type": "invokes",
          "from": {
            "diagramId": "page_activity_detail_member",
            "stateId": "page.ActivityDetailPage.member.NotFound"
          },
          "to": {
            "diagramId": "page_activity_list_member",
            "stateId": "page.ActivityListPage.member.Init"
          },
          "narrative": {
            "summary": "NotFound 狀態返回列表（Member）",
            "taskDescription": "在 NotFound 狀態觸發 backToList 導航到 /activities，並回到活動列表（Member）初始化狀態。"
          },
          "validations": [
            {
              "id": "v.c.page_activity_detail_member.invokes.page_activity_list_member.02",
              "type": "semantic-check",
              "description": "NotFound 狀態下可回列表。",
              "expected": null
            }
          ],
          "meta": {
            "reason": "backToList | navigate /activities",
            "action": "backToList",
            "navigateTarget": "/activities"
          }
        },
        {
          "id": "c.page_activity_detail_member.invokes.page_activity_detail_member.s.page_ActivityDetailPage_member_Failed.to.page_ActivityDetailPage_member_Init",
          "type": "invokes",
          "from": {
            "diagramId": "page_activity_detail_member",
            "stateId": "page.ActivityDetailPage.member.Failed"
          },
          "to": {
            "diagramId": "page_activity_detail_member",
            "stateId": "page.ActivityDetailPage.member.Init"
          },
          "narrative": {
            "summary": "重試載入活動詳情（Member）",
            "taskDescription": "在 Failed 狀態觸發 retryLoad 導航到 /activities/:activityId，並回到 Init 重新載入。"
          },
          "validations": [
            {
              "id": "v.c.page_activity_detail_member.invokes.page_activity_detail_member.01",
              "type": "semantic-check",
              "description": "重試可恢復。",
              "expected": null
            }
          ],
          "meta": {
            "reason": "retryLoad | navigate /activities/:activityId",
            "action": "retryLoad",
            "navigateTarget": "/activities/:activityId"
          }
        }
      ],
      "meta": {
        "pageName": "ActivityDetailPage",
        "featureName": null,
        "entryStateId": "page.ActivityDetailPage.member.Init"
      }
    },
    {
      "id": "page_activity_detail_admin",
      "name": "Activity Detail Page (Admin)",
      "level": "page",
      "parentDiagramId": "page_entry",
      "roles": [
        "admin"
      ],
      "variant": {
        "kind": "standalone",
        "baseDiagramId": null,
        "deltaDiagramIdsByRole": {},
        "appliesToRoles": []
      },
      "source": {
        "type": "mermaid",
        "sectionTitle": "⑨ Activity Detail Page - Admin",
        "order": 9
      },
      "groups": [],
      "states": [
        {
          "id": "page.ActivityDetailPage.admin.Init",
          "label": "ActivityDetailPage.Admin.Init",
          "type": "start",
          "groupId": null,
          "tags": [
            "page",
            "admin"
          ],
          "meta": {
            "diagramId": "page_activity_detail_admin",
            "synthetic": false,
            "source": {
              "scope": "root",
              "raw": "ActivityDetailPage.Admin.Init"
            }
          }
        },
        {
          "id": "page.ActivityDetailPage.admin.Ready",
          "label": "ActivityDetailPage.Admin.Ready",
          "type": "normal",
          "groupId": null,
          "tags": [
            "page",
            "admin"
          ],
          "meta": {
            "diagramId": "page_activity_detail_admin",
            "synthetic": false,
            "source": {
              "scope": "root",
              "raw": "ActivityDetailPage.Admin.Ready"
            }
          }
        },
        {
          "id": "page.ActivityDetailPage.admin.NotFound",
          "label": "ActivityDetailPage.Admin.NotFound",
          "type": "normal",
          "groupId": null,
          "tags": [
            "page",
            "admin"
          ],
          "meta": {
            "diagramId": "page_activity_detail_admin",
            "synthetic": false,
            "source": {
              "scope": "root",
              "raw": "ActivityDetailPage.Admin.NotFound"
            }
          }
        },
        {
          "id": "page.ActivityDetailPage.admin.Failed",
          "label": "ActivityDetailPage.Admin.Failed",
          "type": "normal",
          "groupId": null,
          "tags": [
            "page",
            "admin"
          ],
          "meta": {
            "diagramId": "page_activity_detail_admin",
            "synthetic": false,
            "source": {
              "scope": "root",
              "raw": "ActivityDetailPage.Admin.Failed"
            }
          }
        }
      ],
      "transitions": [
        {
          "id": "t.page_activity_detail_admin.0001",
          "from": "page.ActivityDetailPage.admin.Init",
          "to": "page.ActivityDetailPage.admin.Init",
          "event": "enterPage",
          "roles": [
            "admin"
          ],
          "narrative": {
            "summary": "以管理員視角進入活動詳情",
            "taskDescription": "進入詳情時顯示 Admin 導覽（含管理後台），並依規則呈現報名/取消/提示 CTA。"
          },
          "validations": [
            {
              "id": "v.t.page_activity_detail_admin.0001.01",
              "type": "semantic-check",
              "description": "進入詳情時 Header 顯示 Admin 導覽（包含管理後台入口）；頁面依規則顯示報名/取消/額滿/截止/結束提示；CTA 不重複。",
              "expected": null
            }
          ],
          "intent": {
            "category": "action",
            "summary": "enterPage"
          },
          "meta": {
            "diagramId": "page_activity_detail_admin",
            "source": {
              "raw": "[*] --> ActivityDetailPage.Admin.Init : enterPage"
            }
          }
        },
        {
          "id": "t.page_activity_detail_admin.0002",
          "from": "page.ActivityDetailPage.admin.Init",
          "to": "page.ActivityDetailPage.admin.Ready",
          "event": "loadActivity",
          "roles": [
            "admin"
          ],
          "narrative": {
            "summary": "載入活動詳情（Admin）",
            "taskDescription": "呼叫詳情 API 取得活動資訊與 Admin 的報名狀態，並更新 UI。"
          },
          "validations": [
            {
              "id": "v.t.page_activity_detail_admin.0002.01",
              "type": "semantic-check",
              "description": "API 成功回傳詳情與 Admin 的報名狀態；UI 顯示剩餘名額與是否已報名。",
              "expected": null
            }
          ],
          "intent": {
            "category": "action",
            "summary": "loadActivity"
          },
          "meta": {
            "diagramId": "page_activity_detail_admin",
            "source": {
              "raw": "ActivityDetailPage.Admin.Init --> ActivityDetailPage.Admin.Ready : loadActivity"
            }
          }
        },
        {
          "id": "t.page_activity_detail_admin.0003",
          "from": "page.ActivityDetailPage.admin.Init",
          "to": "page.ActivityDetailPage.admin.NotFound",
          "event": "loadNotFound",
          "roles": [
            "admin"
          ],
          "narrative": {
            "summary": "活動不存在（Admin）",
            "taskDescription": "詳情 API 回 404 時顯示 NotFound 並提供回列表入口。"
          },
          "validations": [
            {
              "id": "v.t.page_activity_detail_admin.0003.01",
              "type": "semantic-check",
              "description": "API 回 404；UI 顯示找不到活動。",
              "expected": null
            }
          ],
          "intent": {
            "category": "action",
            "summary": "loadNotFound"
          },
          "meta": {
            "diagramId": "page_activity_detail_admin",
            "source": {
              "raw": "ActivityDetailPage.Admin.Init --> ActivityDetailPage.Admin.NotFound : loadNotFound"
            }
          }
        },
        {
          "id": "t.page_activity_detail_admin.0004",
          "from": "page.ActivityDetailPage.admin.Init",
          "to": "page.ActivityDetailPage.admin.Failed",
          "event": "loadFailed",
          "roles": [
            "admin"
          ],
          "narrative": {
            "summary": "載入活動詳情失敗（Admin）",
            "taskDescription": "詳情 API 失敗時顯示 Failed 並可重試。"
          },
          "validations": [
            {
              "id": "v.t.page_activity_detail_admin.0004.01",
              "type": "semantic-check",
              "description": "API 失敗顯示 Failed。",
              "expected": null
            }
          ],
          "intent": {
            "category": "action",
            "summary": "loadFailed"
          },
          "meta": {
            "diagramId": "page_activity_detail_admin",
            "source": {
              "raw": "ActivityDetailPage.Admin.Init --> ActivityDetailPage.Admin.Failed : loadFailed"
            }
          }
        }
      ],
      "connectors": [
        {
          "id": "c.page_entry.contains.page_activity_detail_admin",
          "type": "contains",
          "from": {
            "diagramId": "page_entry",
            "stateId": null
          },
          "to": {
            "diagramId": "page_activity_detail_admin",
            "stateId": null
          },
          "narrative": {
            "summary": "Entry 與 Activity Detail（Admin）存在階層關係",
            "taskDescription": "建立 parent/child 關聯，表示 page_activity_detail_admin 受 page_entry 統轄。"
          },
          "validations": [],
          "meta": {
            "reason": "derived from parentDiagramId"
          }
        },
        {
          "id": "c.page_activity_detail_admin.invokes.page_activity_list_admin.s.page_ActivityDetailPage_admin_Ready.to.page_ActivityListPage_admin_Init",
          "type": "invokes",
          "from": {
            "diagramId": "page_activity_detail_admin",
            "stateId": "page.ActivityDetailPage.admin.Ready"
          },
          "to": {
            "diagramId": "page_activity_list_admin",
            "stateId": "page.ActivityListPage.admin.Init"
          },
          "narrative": {
            "summary": "返回活動列表（Admin）",
            "taskDescription": "在詳情 Ready 狀態觸發 backToList 導航到 /activities，並回到活動列表（Admin）初始化狀態。"
          },
          "validations": [
            {
              "id": "v.c.page_activity_detail_admin.invokes.page_activity_list_admin.01",
              "type": "url-equals",
              "description": "返回列表仍為 Admin。",
              "expected": "/activities"
            }
          ],
          "meta": {
            "reason": "backToList | navigate /activities",
            "action": "backToList",
            "navigateTarget": "/activities"
          }
        },
        {
          "id": "c.page_activity_detail_admin.invokes.page_activity_list_admin.s.page_ActivityDetailPage_admin_NotFound.to.page_ActivityListPage_admin_Init",
          "type": "invokes",
          "from": {
            "diagramId": "page_activity_detail_admin",
            "stateId": "page.ActivityDetailPage.admin.NotFound"
          },
          "to": {
            "diagramId": "page_activity_list_admin",
            "stateId": "page.ActivityListPage.admin.Init"
          },
          "narrative": {
            "summary": "NotFound 返回列表（Admin）",
            "taskDescription": "在 NotFound 狀態觸發 backToList 導航到 /activities，並回到活動列表（Admin）初始化狀態。"
          },
          "validations": [
            {
              "id": "v.c.page_activity_detail_admin.invokes.page_activity_list_admin.02",
              "type": "semantic-check",
              "description": "NotFound 可回列表。",
              "expected": null
            }
          ],
          "meta": {
            "reason": "backToList | navigate /activities",
            "action": "backToList",
            "navigateTarget": "/activities"
          }
        },
        {
          "id": "c.page_activity_detail_admin.invokes.page_activity_detail_admin.s.page_ActivityDetailPage_admin_Failed.to.page_ActivityDetailPage_admin_Init",
          "type": "invokes",
          "from": {
            "diagramId": "page_activity_detail_admin",
            "stateId": "page.ActivityDetailPage.admin.Failed"
          },
          "to": {
            "diagramId": "page_activity_detail_admin",
            "stateId": "page.ActivityDetailPage.admin.Init"
          },
          "narrative": {
            "summary": "重試載入活動詳情（Admin）",
            "taskDescription": "在 Failed 狀態觸發 retryLoad 導航到 /activities/:activityId，並回到 Init 重新載入。"
          },
          "validations": [
            {
              "id": "v.c.page_activity_detail_admin.invokes.page_activity_detail_admin.01",
              "type": "semantic-check",
              "description": "重試可恢復。",
              "expected": null
            }
          ],
          "meta": {
            "reason": "retryLoad | navigate /activities/:activityId",
            "action": "retryLoad",
            "navigateTarget": "/activities/:activityId"
          }
        }
      ],
      "meta": {
        "pageName": "ActivityDetailPage",
        "featureName": null,
        "entryStateId": "page.ActivityDetailPage.admin.Init"
      }
    }
  ],
  "hierarchy": {
    "roots": [
      "page_entry"
    ],
    "childrenByDiagramId": {
      "page_entry": [
        "page_activity_detail_admin",
        "page_activity_detail_guest",
        "page_activity_detail_member",
        "page_activity_list_admin",
        "page_activity_list_guest",
        "page_activity_list_member",
        "page_login",
        "page_register"
      ],
      "page_login": [],
      "page_register": [],
      "page_activity_list_guest": [],
      "page_activity_list_member": [],
      "page_activity_list_admin": [],
      "page_activity_detail_guest": [],
      "page_activity_detail_member": [],
      "page_activity_detail_admin": []
    }
  },
  "meta": {
    "validation": {
      "issues": [],
      "fixes": [
        {
          "path": "root.version",
          "message": "upgraded version from '1.0' to '2.0'"
        },
        {
          "path": "diagram.page_entry.connectors.c.page_entry.invokes.page_activity_list_guest.s.page_Entry_Init.to.page_ActivityListPage_guest_Init.to.stateId",
          "message": "cleared missing to.stateId"
        },
        {
          "path": "diagram.page_entry.connectors.c.page_entry.invokes.page_login.s.page_Entry_Init.to.page_LoginPage_guest_Init.to.stateId",
          "message": "cleared missing to.stateId"
        },
        {
          "path": "diagram.page_entry.connectors.c.page_entry.invokes.page_register.s.page_Entry_Init.to.page_RegisterPage_guest_Init.to.stateId",
          "message": "cleared missing to.stateId"
        },
        {
          "path": "diagram.page_login.connectors.c.page_login.invokes.feature_auth_login.s.page_LoginPage_guest_Ready.to.feature_AuthLoginFeature_Init",
          "message": "removed connector referencing missing diagram(s) from='page_login' to='feature_auth_login'"
        },
        {
          "path": "diagram.page_login.connectors.c.page_login.invokes.page_register.s.page_LoginPage_guest_Ready.to.page_RegisterPage_guest_Init.to.stateId",
          "message": "cleared missing to.stateId"
        },
        {
          "path": "diagram.page_login.connectors.c.page_login.invokes.page_activity_list_guest.s.page_LoginPage_guest_Ready.to.page_ActivityListPage_guest_Init.to.stateId",
          "message": "cleared missing to.stateId"
        },
        {
          "path": "diagram.page_register.connectors.c.page_register.invokes.feature_auth_register.s.page_RegisterPage_guest_Ready.to.feature_AuthRegisterFeature_Init",
          "message": "removed connector referencing missing diagram(s) from='page_register' to='feature_auth_register'"
        },
        {
          "path": "diagram.page_register.connectors.c.page_register.invokes.page_activity_list_guest.s.page_RegisterPage_guest_Ready.to.page_ActivityListPage_guest_Init.to.stateId",
          "message": "cleared missing to.stateId"
        },
        {
          "path": "diagram.page_activity_list_guest.connectors.c.page_activity_list_guest.invokes.page_activity_detail_guest.s.page_ActivityListPage_guest_Ready.to.page_ActivityDetailPage_guest_Init.to.stateId",
          "message": "cleared missing to.stateId"
        },
        {
          "path": "diagram.page_activity_list_member.connectors.c.page_activity_list_member.invokes.page_activity_detail_member.s.page_ActivityListPage_member_Ready.to.page_ActivityDetailPage_member_Init.to.stateId",
          "message": "cleared missing to.stateId"
        },
        {
          "path": "diagram.page_activity_list_member.connectors.c.page_activity_list_member.invokes.page_my_activities_member.s.page_ActivityListPage_member_Ready.to.page_MyActivitiesPage_member_Init",
          "message": "removed connector referencing missing diagram(s) from='page_activity_list_member' to='page_my_activities_member'"
        },
        {
          "path": "diagram.page_activity_list_member.connectors.c.page_activity_list_member.invokes.feature_logout.s.page_ActivityListPage_member_Ready.to.feature_LogoutFeature_Init",
          "message": "removed connector referencing missing diagram(s) from='page_activity_list_member' to='feature_logout'"
        },
        {
          "path": "diagram.page_activity_list_member.connectors.c.page_activity_list_member.invokes.page_my_activities_member.s.page_ActivityListPage_member_Empty.to.page_MyActivitiesPage_member_Init",
          "message": "removed connector referencing missing diagram(s) from='page_activity_list_member' to='page_my_activities_member'"
        },
        {
          "path": "diagram.page_activity_list_member.connectors.c.page_activity_list_member.invokes.feature_logout.s.page_ActivityListPage_member_Empty.to.feature_LogoutFeature_Init",
          "message": "removed connector referencing missing diagram(s) from='page_activity_list_member' to='feature_logout'"
        },
        {
          "path": "diagram.page_activity_list_admin.connectors.c.page_activity_list_admin.invokes.page_activity_detail_admin.s.page_ActivityListPage_admin_Ready.to.page_ActivityDetailPage_admin_Init.to.stateId",
          "message": "cleared missing to.stateId"
        },
        {
          "path": "diagram.page_activity_list_admin.connectors.c.page_activity_list_admin.invokes.page_my_activities_admin.s.page_ActivityListPage_admin_Ready.to.page_MyActivitiesPage_admin_Init",
          "message": "removed connector referencing missing diagram(s) from='page_activity_list_admin' to='page_my_activities_admin'"
        },
        {
          "path": "diagram.page_activity_list_admin.connectors.c.page_activity_list_admin.invokes.page_admin_activity_list.s.page_ActivityListPage_admin_Ready.to.page_AdminActivityListPage_Init",
          "message": "removed connector referencing missing diagram(s) from='page_activity_list_admin' to='page_admin_activity_list'"
        },
        {
          "path": "diagram.page_activity_list_admin.connectors.c.page_activity_list_admin.invokes.feature_logout.s.page_ActivityListPage_admin_Ready.to.feature_LogoutFeature_Init",
          "message": "removed connector referencing missing diagram(s) from='page_activity_list_admin' to='feature_logout'"
        },
        {
          "path": "diagram.page_activity_list_admin.connectors.c.page_activity_list_admin.invokes.page_admin_activity_list.s.page_ActivityListPage_admin_Empty.to.page_AdminActivityListPage_Init",
          "message": "removed connector referencing missing diagram(s) from='page_activity_list_admin' to='page_admin_activity_list'"
        },
        {
          "path": "diagram.page_activity_list_admin.connectors.c.page_activity_list_admin.invokes.feature_logout.s.page_ActivityListPage_admin_Empty.to.feature_LogoutFeature_Init",
          "message": "removed connector referencing missing diagram(s) from='page_activity_list_admin' to='feature_logout'"
        },
        {
          "path": "diagram.page_activity_detail_member.connectors.c.page_activity_detail_member.invokes.feature_register_for_activity.s.page_ActivityDetailPage_member_Ready.to.feature_RegisterForActivityFeature_Init",
          "message": "removed connector referencing missing diagram(s) from='page_activity_detail_member' to='feature_register_for_activity'"
        },
        {
          "path": "diagram.page_activity_detail_member.connectors.c.page_activity_detail_member.invokes.feature_cancel_registration.s.page_ActivityDetailPage_member_Ready.to.feature_CancelRegistrationFeature_Init",
          "message": "removed connector referencing missing diagram(s) from='page_activity_detail_member' to='feature_cancel_registration'"
        },
        {
          "path": "diagram.page_activity_detail_member.connectors.c.page_activity_detail_member.invokes.feature_logout.s.page_ActivityDetailPage_member_Ready.to.feature_LogoutFeature_Init",
          "message": "removed connector referencing missing diagram(s) from='page_activity_detail_member' to='feature_logout'"
        },
        {
          "path": "diagram.page_activity_detail_admin.connectors.c.page_activity_detail_admin.invokes.feature_register_for_activity.s.page_ActivityDetailPage_admin_Ready.to.feature_RegisterForActivityFeature_Init",
          "message": "removed connector referencing missing diagram(s) from='page_activity_detail_admin' to='feature_register_for_activity'"
        },
        {
          "path": "diagram.page_activity_detail_admin.connectors.c.page_activity_detail_admin.invokes.feature_cancel_registration.s.page_ActivityDetailPage_admin_Ready.to.feature_CancelRegistrationFeature_Init",
          "message": "removed connector referencing missing diagram(s) from='page_activity_detail_admin' to='feature_cancel_registration'"
        },
        {
          "path": "diagram.page_activity_detail_admin.connectors.c.page_activity_detail_admin.invokes.page_admin_activity_list.s.page_ActivityDetailPage_admin_Ready.to.page_AdminActivityListPage_Init",
          "message": "removed connector referencing missing diagram(s) from='page_activity_detail_admin' to='page_admin_activity_list'"
        },
        {
          "path": "diagram.page_activity_detail_admin.connectors.c.page_activity_detail_admin.invokes.feature_logout.s.page_ActivityDetailPage_admin_Ready.to.feature_LogoutFeature_Init",
          "message": "removed connector referencing missing diagram(s) from='page_activity_detail_admin' to='feature_logout'"
        },
        {
          "path": "diagram.page_entry.connectors.c.page_entry.contains.page_activity_list_member",
          "message": "added missing contains connector"
        },
        {
          "path": "diagram.page_entry.connectors.c.page_entry.contains.page_activity_list_admin",
          "message": "added missing contains connector"
        },
        {
          "path": "diagram.page_entry.connectors.c.page_entry.contains.page_activity_detail_guest",
          "message": "added missing contains connector"
        },
        {
          "path": "diagram.page_entry.connectors.c.page_entry.contains.page_activity_detail_member",
          "message": "added missing contains connector"
        },
        {
          "path": "diagram.page_entry.connectors.c.page_entry.contains.page_activity_detail_admin",
          "message": "added missing contains connector"
        },
        {
          "path": "root.hierarchy",
          "message": "re-derived from diagrams.parentDiagramId"
        }
      ]
    }
  }
}
